<!DOCTYPE html>
<!-- saved from url=(0089)https://damonvjanis.medium.com/archive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b -->
<html lang="en" data-rh="lang"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>(Archive) Phoenix Deployments on GCP with Nginx | by Damon Janis | Medium</title><meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=1"><meta data-rh="true" name="theme-color" content="#000000"><meta data-rh="true" name="twitter:app:name:iphone" content="Medium"><meta data-rh="true" name="twitter:app:id:iphone" content="828256236"><meta data-rh="true" property="al:ios:app_name" content="Medium"><meta data-rh="true" property="al:ios:app_store_id" content="828256236"><meta data-rh="true" property="al:android:package" content="com.medium.reader"><meta data-rh="true" property="fb:app_id" content="542599432471018"><meta data-rh="true" property="og:site_name" content="Medium"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-06-12T12:33:40.779Z"><meta data-rh="true" name="title" content="(Archive) Phoenix Deployments on GCP with Nginx | by Damon Janis | Medium"><meta data-rh="true" property="og:title" content="(Archive) Phoenix Deployments on GCP with Nginx"><meta data-rh="true" property="al:android:url" content="medium://p/911730f84d3b"><meta data-rh="true" property="al:ios:url" content="medium://p/911730f84d3b"><meta data-rh="true" property="al:android:app_name" content="Medium"><meta data-rh="true" name="description" content="There are A LOT of different ways to deploy Elixir/Phoenix applications. I want to fill a gap in the current literature: how do you deploy a Phoenix web app to a single Linux server optimizing for…"><meta data-rh="true" property="og:description" content="Another way to deploy Elixir apps"><meta data-rh="true" property="og:url" content="https://damonvjanis.medium.com/archive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b"><meta data-rh="true" property="al:web:url" content="https://damonvjanis.medium.com/archive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b"><meta data-rh="true" property="og:image" content="https://miro.medium.com/max/1200/1*bVu7g4dHlgtGYO78RWMi9g.jpeg"><meta data-rh="true" property="article:author" content="https://damonvjanis.medium.com"><meta data-rh="true" name="author" content="Damon Janis"><meta data-rh="true" name="robots" content="index,follow,max-image-preview:large"><meta data-rh="true" name="referrer" content="unsafe-url"><meta data-rh="true" property="twitter:title" content="(Archive) Phoenix Deployments on GCP with Nginx"><meta data-rh="true" name="twitter:site" content="@Medium"><meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/911730f84d3b"><meta data-rh="true" property="twitter:description" content="Another way to deploy Elixir apps"><meta data-rh="true" name="twitter:image:src" content="https://miro.medium.com/max/1200/1*bVu7g4dHlgtGYO78RWMi9g.jpeg"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="twitter:label1" content="Reading time"><meta data-rh="true" name="twitter:data1" content="25 min read"><meta data-rh="true" name="twitter:tile:template:testing" content="2"><meta data-rh="true" name="twitter:tile:image" content="https://miro.medium.com/max/1200/1*bVu7g4dHlgtGYO78RWMi9g.jpeg"><meta data-rh="true" name="twitter:tile:info1:text" content="Damon Janis"><meta data-rh="true" name="twitter:tile:info1:icon" content="User"><meta data-rh="true" name="twitter:tile:info2:text" content="2021-06-12T12:33:40.779Z"><meta data-rh="true" name="twitter:tile:info2:icon" content="Calendar"><meta data-rh="true" name="twitter:cta" content="Read on Medium"><link data-rh="true" rel="icon" href="https://miro.medium.com/1*m-R_BkNf1Qjr1YbyOIJY2w.png"><link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium" href="https://damonvjanis.medium.com/osd.xml"><link data-rh="true" rel="apple-touch-icon" sizes="152x152" href="https://miro.medium.com/fit/c/152/152/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"><link data-rh="true" rel="apple-touch-icon" sizes="120x120" href="https://miro.medium.com/fit/c/120/120/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"><link data-rh="true" rel="apple-touch-icon" sizes="76x76" href="https://miro.medium.com/fit/c/76/76/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"><link data-rh="true" rel="apple-touch-icon" sizes="60x60" href="https://miro.medium.com/fit/c/60/60/1*sHhtYhaCe2Uc3IU0IgKwIQ.png"><link data-rh="true" rel="mask-icon" href="https://cdn-static-1.medium.com/_/fp/icons/Medium-Avatar-500x500.svg" color="#171717"><link data-rh="true" rel="preconnect" href="https://glyph.medium.com/" crossorigin=""><link data-rh="true" id="glyph_preload_link" rel="preload" as="style" type="text/css" href="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/unbound.css"><link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css" href="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/unbound.css"><link data-rh="true" rel="author" href="https://damonvjanis.medium.com/"><link data-rh="true" rel="canonical" href="https://damonvjanis.medium.com/archive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b"><link data-rh="true" rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/911730f84d3b"><script async="" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/branch-latest.min.js"></script><script async="" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/analytics.js"></script><script async="" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/shim.js"></script><script data-rh="true" type="application/ld+json">{"@context":"http:\u002F\u002Fschema.org","@type":"NewsArticle","image":["https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F1200\u002F1*bVu7g4dHlgtGYO78RWMi9g.jpeg"],"url":"https:\u002F\u002Fdamonvjanis.medium.com\u002Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b","dateCreated":"2021-06-02T12:41:23.325Z","datePublished":"2021-06-02T12:41:23.325Z","dateModified":"2022-05-24T21:54:07.377Z","headline":"(Archive) Phoenix Deployments on GCP with Nginx - Damon Janis - Medium","name":"(Archive) Phoenix Deployments on GCP with Nginx - Damon Janis - Medium","description":"There are A LOT of different ways to deploy Elixir\u002FPhoenix applications. I want to fill a gap in the current literature: how do you deploy a Phoenix web app to a single Linux server optimizing for…","identifier":"911730f84d3b","author":{"@type":"Person","name":"Damon Janis","url":"https:\u002F\u002Fdamonvjanis.medium.com"},"creator":["Damon Janis"],"publisher":{"@type":"Organization","name":"Medium","url":"https:\u002F\u002Fdamonvjanis.medium.com\u002F","logo":{"@type":"ImageObject","width":308,"height":60,"url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F616\u002F1*OMF3fSqH8t4xBJ9-6oZDZw.png"}},"mainEntityOfPage":"https:\u002F\u002Fdamonvjanis.medium.com\u002Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b"}</script><style type="text/css" data-fela-rehydration="586" data-fela-type="STATIC">html{box-sizing:border-box}*, *:before, *:after{box-sizing:inherit}body{margin:0;padding:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);position:relative;min-height:100vh}h1, h2, h3, h4, h5, h6, dl, dd, ol, ul, menu, figure, blockquote, p, pre, form{margin:0}menu, ol, ul{padding:0;list-style:none;list-style-image:none}main{display:block}a{color:inherit;text-decoration:none}a, button, input{-webkit-tap-highlight-color:transparent}img, svg{vertical-align:middle}button{background:transparent;overflow:visible}button, input, optgroup, select, textarea{margin:0}:root{--reach-tabs:1;--reach-menu-button:1}#speechify-root{font-family:Sohne, sans-serif}div[data-popper-reference-hidden="true"]{visibility:hidden;pointer-events:none}</style><style type="text/css" data-fela-rehydration="586" data-fela-type="KEYFRAME">@-webkit-keyframes k1{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}@-moz-keyframes k1{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}@keyframes k1{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}</style><style type="text/css" data-fela-rehydration="586" data-fela-type="RULE">.a{font-family:medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif}.b{font-weight:400}.c{background-color:rgba(255, 255, 255, 1)}.l{display:block}.m{margin:auto}.n{max-width:1504px}.o{display:flex}.u{justify-content:space-between}.ag{height:100%}.al{padding:0 24px}.am{box-shadow:0px -2px 10px rgba(0, 0, 0, 0.15)}.an{height:56px}.ao{align-items:center}.ap{position:fixed}.aq{top:0}.ar{right:0}.as{left:0}.at{z-index:500}.au{color:inherit}.av{fill:inherit}.aw{font-size:inherit}.ax{border:inherit}.ay{font-family:inherit}.az{letter-spacing:inherit}.ba{font-weight:inherit}.bb{padding:0}.bc{margin:0}.bg:disabled{cursor:default}.bh:disabled{color:rgba(117, 117, 117, 1)}.bi:disabled{fill:rgba(117, 117, 117, 1)}.bj{height:25px}.bk{fill:rgba(41, 41, 41, 1)}.bl{text-align:center}.bm{font-family:sohne, "Helvetica Neue", Helvetica, Arial, sans-serif}.bn{font-size:14px}.bo{line-height:20px}.bp{color:rgba(242, 242, 242, 1)}.bq{padding:7px 16px 9px}.br{fill:rgba(242, 242, 242, 1)}.bs{background:rgba(242, 242, 242, 1)}.bt{border-color:rgba(242, 242, 242, 1)}.bz:disabled{cursor:inherit !important}.ca:disabled{opacity:0.1}.cb:disabled:hover{background:rgba(25, 25, 25, 1)}.cc:disabled:hover{border-color:rgba(25, 25, 25, 1)}.cd{border-radius:99em}.ce{width:100%}.cf{border-width:1px}.cg{border-style:solid}.ch{box-sizing:border-box}.ci{display:inline-block}.cj{text-decoration:none}.ck{margin-left:16px}.cl{display:none}.cn{color:rgba(117, 117, 117, 1)}.co{color:rgba(26, 137, 23, 1)}.cp{fill:rgba(26, 137, 23, 1)}.cs:disabled{color:rgba(163, 208, 162, 0.5)}.ct:disabled{fill:rgba(163, 208, 162, 0.5)}.cz{height:100vh}.da{flex-direction:column}.db{position:sticky}.dc{height:23px}.dd{padding-bottom:35px}.de{fill:rgba(117, 117, 117, 1)}.df{padding-left:28px}.dg{transition:all 0.2s ease-in-out}.dk{margin-right:28px}.dm{font-size:16px}.dn{line-height:24px}.do{position:relative}.dp{margin:0px 0px 35px 28px }.dq{width:24px}.dr{border:0}.ds{height:1px}.dt{background-color:rgba(230, 230, 230, 1)}.du{padding:0 24px 24px}.dv{height:64px}.dw path{fill:rgba(168, 168, 168, 1)}.dx{justify-content:center}.dy{flex:1}.dz{border:none}.ea{background:transparent}.eb{box-shadow:0px 2px 10px rgba(0, 0, 0, 0.15)}.ec{z-index:600}.ed{bottom:0}.ee{justify-content:space-around}.ef{height:16px}.eg{background-color:rgba(237, 237, 237, 1)}.em{min-width:0}.en{flex:1 1 auto}.eo{padding:0 32px}.ep{border-left:1px solid rgba(230, 230, 230, 1)}.eq{min-height:100vh}.er{width:394px}.fm{margin-left:auto}.fn{margin-right:auto}.fo{max-width:728px}.fz{align-items:flex-start}.ga{margin-right:16px}.gb{box-shadow:inset 0 0 0 1px rgba(0, 0, 0, 0.05)}.gc{border-radius:50%}.gd{height:48px}.ge{width:48px}.gf{position:absolute}.gg{background-color:rgba(242, 242, 242, 1)}.gh{color:rgba(41, 41, 41, 1)}.gi{margin-bottom:4px}.gj{flex-direction:row}.gk{padding-left:12px}.gp{font-size:13px}.gq{color:rgba(255, 255, 255, 1)}.gr{padding:0px 8px 1px}.gs{fill:rgba(255, 255, 255, 1)}.gt{background:rgba(26, 137, 23, 1)}.gu{border-color:rgba(26, 137, 23, 1)}.gx:disabled{opacity:0.3}.gy:disabled:hover{background:rgba(26, 137, 23, 1)}.gz:disabled:hover{border-color:rgba(26, 137, 23, 1)}.ha{flex-wrap:wrap}.hb{padding:0 8px}.hf{padding-right:4px}.hg{flex:0 0 auto}.hh{padding:8px 2px}.hj{margin:0 4px 0 28px}.hk{display:inline-flex}.hl{padding-top:24px}.ho{padding-right:12px}.hp{background:rgba(255, 255, 255, 1)}.hq{border:1px solid rgba(230, 230, 230, 1)}.hr{border-radius:4px}.hs{box-shadow:0 1px 4px rgba(230, 230, 230, 1)}.ht{max-height:100vh}.hu{overflow-y:auto}.hv{top:calc(100vh + 100px)}.hw{bottom:calc(100vh + 100px)}.hx{width:10px}.hy{pointer-events:none}.hz{word-break:break-word}.ia{word-wrap:break-word}.ib:after{display:block}.ic:after{content:""}.id:after{clear:both}.ie{line-height:1.23}.if{letter-spacing:0}.ig{font-style:normal}.ih{font-weight:700}.jc{margin-bottom:-0.27em}.jd{max-width:5472px}.jh{clear:both}.jj{cursor:zoom-in}.jk{z-index:auto}.jm{max-width:100%}.jn{height:auto}.jo{margin-top:10px}.jr{text-decoration:underline}.js{line-height:1.18}.jt{letter-spacing:-0.022em}.ju{font-weight:600}.kp{margin-bottom:-0.31em}.kq{line-height:1.58}.kr{letter-spacing:-0.004em}.ks{font-family:source-serif-pro, Georgia, Cambria, "Times New Roman", Times, serif}.lk{margin-bottom:-0.46em}.ll{padding-left:30px}.lm{line-height:40px}.ln{letter-spacing:-0.009em}.lo{font-weight:300}.lp{font-size:28px}.ma{box-shadow:inset 3px 0 0 0 rgba(41, 41, 41, 1)}.mb{padding-left:23px}.mc{margin-left:-20px}.md{font-style:italic}.mm{line-height:28px}.mn{letter-spacing:-0.003em}.mr{list-style-type:disc}.ms{margin-left:30px}.mt{padding-left:0px}.mu{font-size:18px}.nd{list-style-type:decimal}.ne{line-height:1.31}.nu{margin-bottom:-0.37em}.nv{padding:2px 4px}.nw{font-size:75%}.nx> strong{font-family:inherit}.ny{font-family:Menlo, Monaco, "Courier New", Courier, monospace}.od{padding:20px}.oe{overflow-x:auto}.of{border-radius:0}.og{margin-top:-0.09em}.oh{margin-bottom:-0.09em}.oi{white-space:pre-wrap}.oo{max-width:766px}.op{overflow:hidden}.oq{padding-bottom:100%}.or{height:0}.os{padding:16px 0 0}.ot{border-top:none}.ou{height:52px}.ov{max-height:52px}.ow{box-sizing:content-box}.ox{position:static}.oy{z-index:1}.oz{flex:1 0 auto}.pb{max-width:155px}.pe{margin-right:5px}.ph{-webkit-user-select:none}.pi{cursor:progress}.pl{opacity:0.25}.pm{outline:0}.pn{user-select:none}.po> svg{pointer-events:none}.pz{margin-left:24px}.qa{margin-top:0px}.qb{cursor:pointer}.qc{padding:4px 0}.qf path{fill:rgba(117, 117, 117, 1)}.qh{margin:0 20px}.qi{background-color:rgba(250, 250, 250, 1)}.qj{padding-bottom:4px}.qk{padding-top:32px}.ql{font-weight:500}.qr{text-overflow:ellipsis}.qs{display:-webkit-box}.qt{-webkit-line-clamp:1}.qu{-webkit-box-orient:vertical}.qv{word-break:break-all}.qx{margin-left:8px}.qy{stroke:rgba(242, 242, 242, 1)}.qz{height:36px}.ra{width:36px}.rb{padding-top:5px}.rc{padding-top:25px}.rd{padding-bottom:96px}.re{padding-left:16px}.rf{padding-top:40px}.rg{padding-right:16px}.rw{background:rgba(25, 25, 25, 1)}.rx{border-color:rgba(25, 25, 25, 1)}.sa{padding-bottom:80px}.sb{padding-bottom:26px}.tl{flex-grow:0}.tm{padding-bottom:8px}.tn{margin-bottom:24px}.to{margin-right:24px}.tp{flex:1 0 0%}.tq{margin-bottom:8px}.tr{margin-right:8px}.ts{height:20px}.tt{width:20px}.tu{max-height:20px}.tv{max-height:60px}.tw{-webkit-line-clamp:3}.tx{width:56px}.ty{border-radius:2px}.tz{padding:30px 0}.ua{margin-bottom:0}.ub{min-width:100vw}.uc{background-color:rgba(0, 0, 0, 1)}.uh{max-width:1192px}.uk:disabled{color:rgba(255, 255, 255, 0.6)}.ul:disabled{fill:rgba(255, 255, 255, 0.45)}.um{height:22px}.un{margin-top:20px}.uo{color:rgba(255, 255, 255, 0.95)}.uq{margin-right:20px}.ur{background-color:rgba(255, 255, 255, 0.4)}.us{margin:28px 0 20px}.ut{padding-bottom:0px}.uu{border-bottom:none}.uv{margin-top:40px}.uw{border-radius:20px}.ux{width:inherit}.uy{outline:none}.uz{padding:10px 20px 10px 0}.va{background-color:transparent}.vb::placeholder{color:rgba(117, 117, 117, 1)}.vc{padding:7px 7px 6px 8px}.vd{height:88px}.ve{width:88px}.vf{margin-top:16px}.vg{margin-top:4px}.vh{margin-top:12px}.vi{margin-top:24px}.vj{margin-bottom:40px}.vk{width:auto}.vl{padding:24px 0}.vm{margin-right:6px}.vn{font-size:11px}.vo{line-height:16px}.bd:hover{cursor:pointer}.be:hover{color:rgba(25, 25, 25, 1)}.bf:hover{fill:rgba(25, 25, 25, 1)}.bu:hover{background:rgba(242, 242, 242, 1)}.bv:hover{border-color:rgba(242, 242, 242, 1)}.bw:hover{cursor:wait}.bx:hover{color:rgba(242, 242, 242, 1)}.by:hover{fill:rgba(242, 242, 242, 1)}.cq:hover{color:rgba(15, 115, 12, 1)}.cr:hover{fill:rgba(15, 115, 12, 1)}.dh:hover{color:rgba(41, 41, 41, 1)}.di:hover{fill:rgba(41, 41, 41, 1)}.gv:hover{background:rgba(15, 115, 12, 1)}.gw:hover{border-color:rgba(15, 115, 12, 1)}.hi:hover path{fill:rgba(8, 8, 8, 1)}.pk:hover{fill:rgba(117, 117, 117, 1)}.qd:hover{fill:rgba(8, 8, 8, 1)}.qe:hover p{color:rgba(8, 8, 8, 1)}.ry:hover{background:rgba(8, 8, 8, 1)}.rz:hover{border-color:rgba(41, 41, 41, 1)}.ui:hover{color:rgba(255, 255, 255, 1)}.uj:hover{fill:rgba(255, 255, 255, 0.9)}.up:hover{text-decoration:underline}.jl:focus{transform:scale(1.01)}.pj:focus{fill:rgba(117, 117, 117, 1)}.qg:focus path{fill:rgba(8, 8, 8, 1)}.pp:active{border-style:none}</style><style type="text/css" data-fela-rehydration="586" data-fela-type="RULE" media="all and (min-width: 1080px)">.d{display:none}.t{flex-direction:row}.z{width:80px}.ab{min-height:100vh}.ac{flex-shrink:1}.ae{border-right:1px solid rgba(230, 230, 230, 1)}.cu{display:block}.cv{text-align:center}.cw{padding:40px 0}.el{margin-bottom:0}.ex{margin-bottom:40px}.fe{margin:0 32px}.ff{max-width:692px}.fl{padding:0 16px}.fx{margin-bottom:32px}.fy{margin-top:56px}.he{display:inline-flex}.iy{font-size:32px}.iz{margin-top:0.6em}.ja{line-height:40px}.jb{letter-spacing:-0.016em}.jg{margin-top:40px}.kl{font-size:20px}.km{margin-top:2.37em}.kn{line-height:24px}.ko{letter-spacing:0}.lh{margin-top:0.86em}.li{line-height:32px}.lj{letter-spacing:-0.003em}.lu{margin-top:1.75em}.lz{margin-top:2.48em}.mk{font-size:21px}.ml{margin-top:2em}.mq{margin-top:0.94em}.mz{margin-top:1.14em}.nc{margin-top:2.14em}.nr{font-size:22px}.ns{margin-top:3.14em}.nt{line-height:28px}.on{margin-top:1.91em}.pw{margin-top:0px}.py{display:inline-block}.qq{max-height:24px}.rl{margin:0}.rq{white-space:normal}.rv{margin:0 0 0 12px}.so{width:calc(100% + 64px)}.sp{margin-left:-32px}.sq{margin-right:-32px}.th{padding-left:32px}.ti{padding-right:32px}.tj{flex-basis:50%}.tk{max-width:50%}.ug{margin:0 64px}</style><style type="text/css" data-fela-rehydration="586" data-fela-type="RULE" media="all and (max-width: 1079.98px)">.e{display:none}.jp{margin-left:auto}.jq{text-align:center}.pv{margin-top:0px}.px{display:inline-block}</style><style type="text/css" data-fela-rehydration="586" data-fela-type="RULE" media="all and (max-width: 903.98px)">.f{display:none}.pd{display:inline-block}.pu{margin-top:0px}</style><style type="text/css" data-fela-rehydration="586" data-fela-type="RULE" media="all and (max-width: 727.98px)">.g{display:none}.cm{display:block}.pc{display:inline-block}.ps{margin-top:0px}.pt{margin-right:0px}.ud{padding:24px 0}</style><style type="text/css" data-fela-rehydration="586" data-fela-type="RULE" media="all and (max-width: 551.98px)">.h{display:none}.p{flex-direction:column}.v{width:auto}.ah{display:block}.eh{margin-bottom:56px}.et{margin-bottom:80px}.ey{margin:0 24px}.fh{padding:0 8px}.fp{margin-bottom:24px}.fq{margin-top:32px}.gl{display:inline-block}.hm{display:flex}.ii{font-size:32px}.ij{margin-top:0.64em}.ik{line-height:40px}.il{letter-spacing:-0.016em}.jv{font-size:16px}.jw{margin-top:2.07em}.jx{line-height:20px}.jy{letter-spacing:0}.kt{font-size:18px}.ku{margin-top:0.67em}.kv{line-height:28px}.kw{letter-spacing:-0.003em}.lq{margin-top:1.08em}.lv{margin-top:2em}.me{margin-top:1.56em}.mv{margin-top:1.34em}.nf{font-size:20px}.ng{margin-top:1.9em}.nh{line-height:24px}.nz{margin-top:40px}.oj{margin-top:1.41em}.pf{margin-left:0px}.pq{margin-top:0px}.pr{margin-right:0px}.qm{max-height:20px}.rh{margin:0}.rm{white-space:pre-line}.rr{margin:10px 0 0 0}.sc{width:calc(100% + 24px)}.sd{margin-left:-12px}.se{margin-right:-12px}.sr{padding-left:12px}.ss{padding-right:12px}.st{flex-basis:100%}.su{max-width:100%}</style><style type="text/css" data-fela-rehydration="586" data-fela-type="RULE" media="all and (min-width: 904px) and (max-width: 1079.98px)">.i{display:none}.s{flex-direction:column}.y{width:auto}.ak{display:block}.ek{margin-bottom:56px}.ew{margin-bottom:40px}.fc{margin:0 32px}.fd{max-width:692px}.fk{padding:0 16px}.fv{margin-bottom:24px}.fw{margin-top:32px}.go{display:inline-block}.hd{display:inline-flex}.iu{font-size:32px}.iv{margin-top:0.6em}.iw{line-height:40px}.ix{letter-spacing:-0.016em}.jf{margin-top:40px}.kh{font-size:20px}.ki{margin-top:2.37em}.kj{line-height:24px}.kk{letter-spacing:0}.le{margin-top:0.86em}.lf{line-height:32px}.lg{letter-spacing:-0.003em}.lt{margin-top:1.75em}.ly{margin-top:2.48em}.mi{font-size:21px}.mj{margin-top:2em}.mp{margin-top:0.94em}.my{margin-top:1.14em}.nb{margin-top:2.14em}.no{font-size:22px}.np{margin-top:3.14em}.nq{line-height:28px}.oc{margin-top:56px}.om{margin-top:1.91em}.qp{max-height:24px}.rk{margin:0}.rp{white-space:normal}.ru{margin:0 0 0 12px}.sl{width:calc(100% + 64px)}.sm{margin-left:-32px}.sn{margin-right:-32px}.td{padding-left:32px}.te{padding-right:32px}.tf{flex-basis:50%}.tg{max-width:50%}.uf{margin:0 64px}</style><style type="text/css" data-fela-rehydration="586" data-fela-type="RULE" media="all and (min-width: 728px) and (max-width: 903.98px)">.j{display:none}.r{flex-direction:column}.x{width:auto}.aj{display:block}.ej{margin-bottom:56px}.ev{margin-bottom:40px}.fa{margin:0 32px}.fb{max-width:692px}.fj{padding:0 16px}.ft{margin-bottom:24px}.fu{margin-top:32px}.gn{display:inline-block}.hc{display:inline-flex}.iq{font-size:32px}.ir{margin-top:0.6em}.is{line-height:40px}.it{letter-spacing:-0.016em}.je{margin-top:40px}.kd{font-size:20px}.ke{margin-top:2.37em}.kf{line-height:24px}.kg{letter-spacing:0}.lb{margin-top:0.86em}.lc{line-height:32px}.ld{letter-spacing:-0.003em}.ls{margin-top:1.75em}.lx{margin-top:2.48em}.mg{font-size:21px}.mh{margin-top:2em}.mo{margin-top:0.94em}.mx{margin-top:1.14em}.na{margin-top:2.14em}.nl{font-size:22px}.nm{margin-top:3.14em}.nn{line-height:28px}.ob{margin-top:56px}.ol{margin-top:1.91em}.qo{max-height:24px}.rj{margin:0}.ro{white-space:normal}.rt{margin:0 0 0 12px}.si{width:calc(100% + 64px)}.sj{margin-left:-32px}.sk{margin-right:-32px}.sz{padding-left:32px}.ta{padding-right:32px}.tb{flex-basis:50%}.tc{max-width:50%}.ue{margin:0 48px}</style><style type="text/css" data-fela-rehydration="586" data-fela-type="RULE" media="all and (min-width: 552px) and (max-width: 727.98px)">.k{display:none}.q{flex-direction:column}.w{width:auto}.ai{display:block}.ei{margin-bottom:56px}.eu{margin-bottom:80px}.ez{margin:0 24px}.fi{padding:0 8px}.fr{margin-bottom:24px}.fs{margin-top:32px}.gm{display:inline-block}.hn{display:flex}.im{font-size:32px}.in{margin-top:0.64em}.io{line-height:40px}.ip{letter-spacing:-0.016em}.jz{font-size:16px}.ka{margin-top:2.07em}.kb{line-height:20px}.kc{letter-spacing:0}.kx{font-size:18px}.ky{margin-top:0.67em}.kz{line-height:28px}.la{letter-spacing:-0.003em}.lr{margin-top:1.08em}.lw{margin-top:2em}.mf{margin-top:1.56em}.mw{margin-top:1.34em}.ni{font-size:20px}.nj{margin-top:1.9em}.nk{line-height:24px}.oa{margin-top:40px}.ok{margin-top:1.41em}.pg{margin-left:0px}.qn{max-height:20px}.ri{margin:0}.rn{white-space:pre-line}.rs{margin:10px 0 0 0}.sf{width:calc(100% + 64px)}.sg{margin-left:-32px}.sh{margin-right:-32px}.sv{padding-left:32px}.sw{padding-right:32px}.sx{flex-basis:50%}.sy{max-width:50%}</style><style type="text/css" data-fela-rehydration="586" data-fela-type="RULE" media="print">.pa{display:none}</style><style type="text/css" data-fela-rehydration="586" data-fela-type="RULE" media="all and (min-width: 7000px)">.af{width:224px}.cx{text-align:left}.cy{padding:40px 24px}.dj{display:none}.dl{display:block}.fg{margin:0 auto}</style><style type="text/css" data-fela-rehydration="586" data-fela-type="RULE" media="all and (max-width: 1239.98px)">.es{width:280px}</style><style type="text/css" data-fela-rehydration="586" data-fela-type="RULE" media="(prefers-reduced-motion: no-preference)">.ji{transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1)}</style><style type="text/css" data-fela-rehydration="586" data-fela-type="RULE" media="(orientation: landscape) and (max-width: 903.98px)">.qw{max-height:none}</style><script data-rh="true">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-24232453-2', 'auto');
ga('send', 'pageview');</script><script type="text/javascript" data-rh="true">(function(b,r,a,n,c,h,_,s,d,k){if(!b[n]||!b[n]._q){for(;s<_.length;)c(h,_[s++]);d=r.createElement(a);d.async=1;d.src="https://cdn.branch.io/branch-latest.min.js";k=r.getElementsByTagName(a)[0];k.parentNode.insertBefore(d,k);b[n]=h}})(window,document,"script","branch",function(b,r){b[r]=function(){b._q.push([r,arguments])}},{_q:[],_v:1},"addListener applyCode autoAppIndex banner closeBanner closeJourney creditHistory credits data deepview deepviewCta first getCode init link logout redeem referrals removeListener sendSMS setBranchViewData setIdentity track validateCode trackCommerceEvent logEvent".split(" "), 0);
branch.init('key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm', {metadata: {}, 'no_journeys': true, 'disable_exit_animation': true, 'disable_entry_animation': true, 'tracking_disabled': null}, function(err, data) {});</script><script data-rh="true">(function(l,e,a,p) {
                if (window.Sprig) return;
                window.Sprig = function(){S._queue.push(arguments)}
                var S = window.Sprig;S.appId = a;S._queue = [];window.UserLeap=S;
                a=l.createElement('script');
                a.async=1;a.src=e+'?id='+S.appId;
                p=l.getElementsByTagName('script')[0];
                p.parentNode.insertBefore(a, p);
              })(document, 'https://cdn.sprig.com/shim.js', 'WISfSM8eD3');
                    Sprig('setUserId', 'sprig-anon-0e26837a-947d-45fc-b14d-b9de3b70255d')
                    Sprig('setEmail', 'n/a')</script></head><body><div id="root"><div class="a b c"><div class="d e f g h i j k"></div><script>document.domain = document.domain;</script><div><script>if (window.self !== window.top) window.location = "about:blank"</script></div><div class="l c"><div class="m n l"><div class="o p q r s t u"><div class="v w x y z ab ac ae af"><nav class="ag"><div class="ah ai aj ak d"><div class="al am an o ao u ap aq ar as at c"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Homepage" href="https://medium.com/?source=---three_column_layout_nav----------------------------------" rel="noopener follow"><svg viewBox="0 0 1043.63 592.71" class="bj bk"><g data-name="Layer 2"><g data-name="Layer 1"><path d="M588.67 296.36c0 163.67-131.78 296.35-294.33 296.35S0 460 0 296.36 131.78 0 294.34 0s294.33 132.69 294.33 296.36M911.56 296.36c0 154.06-65.89 279-147.17 279s-147.17-124.94-147.17-279 65.88-279 147.16-279 147.17 124.9 147.17 279M1043.63 296.36c0 138-23.17 249.94-51.76 249.94s-51.75-111.91-51.75-249.94 23.17-249.94 51.75-249.94 51.76 111.9 51.76 249.94"></path></g></g></svg></a><div class="o ao"><div class="ck cl cm"><span class="bm b bn bo cn"><a class="co cp aw ax ay az ba bb bc bd cq cr bg cs ct" href="https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F911730f84d3b&amp;%7Efeature=LoOpenInAppButton&amp;%7Echannel=ShowPostUnderUser&amp;%7Estage=mobileNavBar&amp;source=---three_column_layout_nav----------------------------------" rel="noopener follow">Open in app</a></span></div><div class="o ao"><div class="h k aj ak d"><p class="bm b bn bo co"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b&amp;source=post_page---three_column_layout_nav-----------------------three_column_layout_nav-----------" rel="noopener follow">Sign In</a></span></p></div><div class="ck l oz"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b&amp;source=post_page---three_column_layout_nav-----------------------three_column_layout_nav-----------" rel="noopener follow"><button class="bm b bn bo gq bq gs rw rx ry rz bd bz ca cb cc cd ce cf cg ch ci cj">Get started</button></a></span></div></div><div class="xq l"></div></div></div><div class="an l"></div></div><div class="ag h k j i cu"><div class="cz o da u db aq at c"><div class="cv cw cx cy"><a aria-label="Homepage" href="https://medium.com/?source=---three_column_layout_nav----------------------------------" rel="noopener follow"><svg viewBox="0 0 1043.63 592.71" class="dc bk"><g data-name="Layer 2"><g data-name="Layer 1"><path d="M588.67 296.36c0 163.67-131.78 296.35-294.33 296.35S0 460 0 296.36 131.78 0 294.34 0s294.33 132.69 294.33 296.36M911.56 296.36c0 154.06-65.89 279-147.17 279s-147.17-124.94-147.17-279 65.88-279 147.16-279 147.17 124.9 147.17 279M1043.63 296.36c0 138-23.17 249.94-51.76 249.94s-51.75-111.91-51.75-249.94 23.17-249.94 51.75-249.94 51.76 111.9 51.76 249.94"></path></g></g></svg></a></div><div class="l"><div class="dd l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/?source=---three_column_layout_nav----------------------------------" rel="noopener follow"><div class="o do"><div class="cn de o df dg dh di"><div class="l dj dk"><div><div class="ci" aria-hidden="false" aria-describedby="1" aria-labelledby="1"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-label="Home"><path d="M4.5 10.75v10.5c0 .14.11.25.25.25h5c.14 0 .25-.11.25-.25v-5.5c0-.14.11-.25.25-.25h3.5c.14 0 .25.11.25.25v5.5c0 .14.11.25.25.25h5c.14 0 .25-.11.25-.25v-10.5M22 9l-9.1-6.83a1.5 1.5 0 0 0-1.8 0L2 9" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path></svg></div></div></div><div class="cl dl dk" aria-hidden="true"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-label="Home"><path d="M4.5 10.75v10.5c0 .14.11.25.25.25h5c.14 0 .25-.11.25-.25v-5.5c0-.14.11-.25.25-.25h3.5c.14 0 .25.11.25.25v5.5c0 .14.11.25.25.25h5c.14 0 .25-.11.25-.25v-10.5M22 9l-9.1-6.83a1.5 1.5 0 0 0-1.8 0L2 9" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"></path></svg></div><div class="cl dl bm b dm dn">Home</div></div></div></a></div><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fme%2Fnotifications&amp;source=---three_column_layout_nav-----------------------notifications_sidenav-----------" rel="noopener follow"><div class="dd l"><div class="o do"><div class="cn de o df dg dh di"><div class="l dj dk"><div><div class="ci" aria-hidden="false" aria-describedby="2" aria-labelledby="2"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-label="Notifications"><path d="M15 18.5a3 3 0 1 1-6 0" stroke="currentColor" stroke-linecap="round"></path><path d="M5.5 10.53V9a6.5 6.5 0 0 1 13 0v1.53c0 1.42.56 2.78 1.57 3.79l.03.03c.26.26.4.6.4.97v2.93c0 .14-.11.25-.25.25H3.75a.25.25 0 0 1-.25-.25v-2.93c0-.37.14-.71.4-.97l.03-.03c1-1 1.57-2.37 1.57-3.79z" stroke="currentColor" stroke-linejoin="round"></path></svg></div></div></div><div class="cl dl dk" aria-hidden="true"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-label="Notifications"><path d="M15 18.5a3 3 0 1 1-6 0" stroke="currentColor" stroke-linecap="round"></path><path d="M5.5 10.53V9a6.5 6.5 0 0 1 13 0v1.53c0 1.42.56 2.78 1.57 3.79l.03.03c.26.26.4.6.4.97v2.93c0 .14-.11.25-.25.25H3.75a.25.25 0 0 1-.25-.25v-2.93c0-.37.14-.71.4-.97l.03-.03c1-1 1.57-2.37 1.57-3.79z" stroke="currentColor" stroke-linejoin="round"></path></svg></div><div class="cl dl bm b dm dn">Notifications</div></div></div></div></a></span><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fme%2Flists&amp;source=---three_column_layout_nav-----------------------lists_sidenav-----------" rel="noopener follow"><div class="dd l"><div class="o do"><div class="cn de o df dg dh di"><div class="l dj dk"><div><div class="ci" aria-hidden="false" aria-describedby="3" aria-labelledby="3"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-label="Lists"><path d="M4.5 6.25V21c0 .2.24.32.4.2l5.45-4.09a.25.25 0 0 1 .3 0l5.45 4.09c.16.12.4 0 .4-.2V6.25a.25.25 0 0 0-.25-.25H4.75a.25.25 0 0 0-.25.25z" stroke="currentColor" stroke-linecap="round"></path><path d="M8 6V3.25c0-.14.11-.25.25-.25h11.5c.14 0 .25.11.25.25V16.5" stroke="currentColor" stroke-linecap="round"></path></svg></div></div></div><div class="cl dl dk" aria-hidden="true"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-label="Lists"><path d="M4.5 6.25V21c0 .2.24.32.4.2l5.45-4.09a.25.25 0 0 1 .3 0l5.45 4.09c.16.12.4 0 .4-.2V6.25a.25.25 0 0 0-.25-.25H4.75a.25.25 0 0 0-.25.25z" stroke="currentColor" stroke-linecap="round"></path><path d="M8 6V3.25c0-.14.11-.25.25-.25h11.5c.14 0 .25.11.25.25V16.5" stroke="currentColor" stroke-linecap="round"></path></svg></div><div class="cl dl bm b dm dn">Lists</div></div></div></div></a></span><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fme%2Fstories%2Fdrafts&amp;source=---three_column_layout_nav-----------------------stories_sidenav-----------" rel="noopener follow"><div class="dd l"><div class="o do"><div class="cn de o df dg dh di"><div class="l dj dk"><div><div class="ci" aria-hidden="false" aria-describedby="4" aria-labelledby="4"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-label="Stories"><path d="M4.75 21.5h14.5c.14 0 .25-.11.25-.25V2.75a.25.25 0 0 0-.25-.25H4.75a.25.25 0 0 0-.25.25v18.5c0 .14.11.25.25.25z" stroke="currentColor"></path><path d="M8 8.5h8M8 15.5h5M8 12h8" stroke="currentColor" stroke-linecap="round"></path></svg></div></div></div><div class="cl dl dk" aria-hidden="true"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-label="Stories"><path d="M4.75 21.5h14.5c.14 0 .25-.11.25-.25V2.75a.25.25 0 0 0-.25-.25H4.75a.25.25 0 0 0-.25.25v18.5c0 .14.11.25.25.25z" stroke="currentColor"></path><path d="M8 8.5h8M8 15.5h5M8 12h8" stroke="currentColor" stroke-linecap="round"></path></svg></div><div class="cl dl bm b dm dn">Stories</div></div></div></div></a></span><div class="dp dq l"><hr class="dr ds dt bc" aria-hidden="true"></div><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fnew-story&amp;source=---three_column_layout_nav-----------------------new_post_sidenav-----------" rel="noopener follow"><div class="dd l"><div class="o do"><div class="cn de o df dg dh di"><div class="l dj dk"><div><div class="ci" aria-hidden="false" aria-describedby="5" aria-labelledby="5"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-label="Write"><path d="M14 4a.5.5 0 0 0 0-1v1zm7 6a.5.5 0 0 0-1 0h1zm-7-7H4v1h10V3zM3 4v16h1V4H3zm1 17h16v-1H4v1zm17-1V10h-1v10h1zm-1 1a1 1 0 0 0 1-1h-1v1zM3 20a1 1 0 0 0 1 1v-1H3zM4 3a1 1 0 0 0-1 1h1V3z" fill="currentColor"></path><path d="M17.5 4.5l-8.46 8.46a.25.25 0 0 0-.06.1l-.82 2.47c-.07.2.12.38.31.31l2.47-.82a.25.25 0 0 0 .1-.06L19.5 6.5m-2-2l2.32-2.32c.1-.1.26-.1.36 0l1.64 1.64c.1.1.1.26 0 .36L19.5 6.5m-2-2l2 2" stroke="currentColor"></path></svg></div></div></div><div class="cl dl dk" aria-hidden="true"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-label="Write"><path d="M14 4a.5.5 0 0 0 0-1v1zm7 6a.5.5 0 0 0-1 0h1zm-7-7H4v1h10V3zM3 4v16h1V4H3zm1 17h16v-1H4v1zm17-1V10h-1v10h1zm-1 1a1 1 0 0 0 1-1h-1v1zM3 20a1 1 0 0 0 1 1v-1H3zM4 3a1 1 0 0 0-1 1h1V3z" fill="currentColor"></path><path d="M17.5 4.5l-8.46 8.46a.25.25 0 0 0-.06.1l-.82 2.47c-.07.2.12.38.31.31l2.47-.82a.25.25 0 0 0 .1-.06L19.5 6.5m-2-2l2.32-2.32c.1-.1.26-.1.36 0l1.64 1.64c.1.1.1.26 0 .36L19.5 6.5m-2-2l2 2" stroke="currentColor"></path></svg></div><div class="cl dl bm b dm dn">Write</div></div></div></div></a></span></div><div class="du dv o ao"></div></div></div><div class="ah ai aj ak d"><div class="l ap ar ed as at c"><div class="eb an do ec"><div class="ag o u"><a class="o dx ao dy" href="https://medium.com/?source=---three_column_layout_nav----------------------------------" rel="noopener follow"><svg width="24" height="24" fill="none" aria-label="home"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.72 2.93a.45.45 0 0 1 .56 0l.34-.43-.34.43 9.37 7.5a.56.56 0 1 0 .7-.86l-9.38-7.5a1.55 1.55 0 0 0-1.94 0l-9.38 7.5a.56.56 0 0 0 .7.86l9.37-7.5zm7.17 9.13v-1.4l.91.69a.5.5 0 0 1 .2.4V20a2 2 0 0 1-2 2h-4a.5.5 0 0 1-.5-.5V17a1 1 0 0 0-1-1h-1a1 1 0 0 0-1 1v4.5a.5.5 0 0 1-.5.5H6a2 2 0 0 1-2-2v-8.25a.5.5 0 0 1 .2-.4l.91-.68V20c0 .5.4.89.89.89h3.39V17a2.11 2.11 0 0 1 2.11-2.11h1A2.11 2.11 0 0 1 14.61 17v3.89H18a.89.89 0 0 0 .89-.89v-7.95z" fill="#A8A8A8"></path></svg></a><a class="o dx ao dy" href="https://medium.com/search?source=---three_column_layout_nav----------------------------------" rel="noopener follow"><svg width="25" height="24" fill="none" aria-label="search"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.8 10.69a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0zm6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73a8.05 8.05 0 0 0-5.94-13.5z" fill="#A8A8A8"></path></svg></a><button aria-label="write new post" class="dz ea bb dy o ao dx"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b&amp;source=post_page---three_column_layout_nav-----------------------lo_home_nav-----------" rel="noopener follow"><div class="l do"><img alt="" class="l ch gc xr dq gg" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_dmbNkD5D-u45r44go_cf0g.png" width="24" height="24" loading="lazy" role="presentation"><div class="gb gc l xr dq gf aq"></div></div></a></span></button></div></div></div></div></nav></div><main class="eh ei ej ek el em l en"><div class="l"><div class="pa" role="dialog" aria-modal="true" tabindex="-1"><div class="vr vs ce ag ap vt vu qb vv hy vw" aria-hidden="true" role="presentation"></div><div class="vx ap vy vz wa vr ag ch wb wc wd we wf wg wh wi wj wk wl wm wn" aria-hidden="true"></div></div><div class="et eu ev ew ex l"><div class="o dx"><div class="em ce ey ez fa fb fc fd fe ff fg"><article><div class="l"><div class="fh fi fj fk fl fm fn ce fo ch l"></div><div class="l"><header class="pw-post-byline-header fp fq fr fs ft fu fv fw fx fy l"><div class="o fz u"><div class="o"><div class="ga l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener follow" href="https://damonvjanis.medium.com/?source=post_page-----911730f84d3b--------------------------------"><div class="l do"><img alt="Damon Janis" class="l ch gc gd ge gg" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_gDcDYew1ntSXqHIkMQs4Dw.jpeg" width="48" height="48" loading="lazy"><div class="gb gc l gd ge gf aq"></div></div></a></div><div class="l"><div class="pw-author bm b dm dn gh"><div class="gi o gj"><div><div class="ci" aria-hidden="false" aria-describedby="6" aria-labelledby="6"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener follow" href="https://damonvjanis.medium.com/?source=post_page-----911730f84d3b--------------------------------">Damon Janis</a></div></div><div class="gk gl gm gn go d"><span><button class="bm b gp bo gq gr gs gt gu gv gw bd bz gx gy gz cd cf cg ch ci cj">Follow</button></span></div></div></div><div class="o ao ha"><p class="pw-published-date bm b bn bo cn"><span>Jun 2, 2021</span></p><div class="hb ci" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bm b bn bo cn">·</span></span></div><div class="pw-reading-time bm b bn bo cn">25 min read</div><div class="hb ci" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bm b bn bo cn">·</span></span></div><div class="ch hk ao"><div class="l oz"><div class="o dx"><div class="rh ri rj rk rl jm em ce"><div><div class="ci ce" aria-hidden="false"><button class="bb qb dz o ao yn yo"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="yp yq yr ys"><path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zm2.8 8.51l-3.69 2.46a.62.62 0 0 1-.96-.5V5.53a.62.62 0 0 1 .96-.51l3.7 2.46a.62.62 0 0 1 0 1.02z" fill="#292929"></path></svg><p class="bm b bn bo co">Listen</p></button></div></div></div></div></div></div></div></div></div><div class="o ao"><div class="h k hc hd he"><div class="hf l hg"><div><div class="ci" aria-hidden="false" aria-describedby="7" aria-labelledby="7"><button class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Share on twitter"><span class="ci hh dw hi"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M20 5.34c-.67.41-1.4.7-2.18.87a3.45 3.45 0 0 0-5.02-.1 3.49 3.49 0 0 0-1.02 2.47c0 .28.03.54.07.8a9.91 9.91 0 0 1-7.17-3.66 3.9 3.9 0 0 0-.5 1.74 3.6 3.6 0 0 0 1.56 2.92 3.36 3.36 0 0 1-1.55-.44V10c0 1.67 1.2 3.08 2.8 3.42-.3.06-.6.1-.94.12l-.62-.06a3.5 3.5 0 0 0 3.24 2.43 7.34 7.34 0 0 1-4.36 1.49l-.81-.05a9.96 9.96 0 0 0 5.36 1.56c6.4 0 9.91-5.32 9.9-9.9v-.5c.69-.49 1.28-1.1 1.74-1.81-.63.3-1.3.48-2 .56A3.33 3.33 0 0 0 20 5.33" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="hf l hg"><div><div class="ci" aria-hidden="false" aria-describedby="8" aria-labelledby="8"><button class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Share on facebook"><span class="ci hh dw hi"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M19.75 12.04c0-4.3-3.47-7.79-7.75-7.79a7.77 7.77 0 0 0-5.9 12.84 7.77 7.77 0 0 0 4.69 2.63v-5.49h-1.9v-2.2h1.9v-1.62c0-1.88 1.14-2.9 2.8-2.9.8 0 1.49.06 1.69.08v1.97h-1.15c-.91 0-1.1.43-1.1 1.07v1.4h2.17l-.28 2.2h-1.88v5.52a7.77 7.77 0 0 0 6.7-7.71" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="hf l hg"><div><div class="ci" aria-hidden="false" aria-describedby="9" aria-labelledby="9"><button class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Share on linkedin"><span class="ci hh dw hi"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M19.75 5.39v13.22a1.14 1.14 0 0 1-1.14 1.14H5.39a1.14 1.14 0 0 1-1.14-1.14V5.39a1.14 1.14 0 0 1 1.14-1.14h13.22a1.14 1.14 0 0 1 1.14 1.14zM8.81 10.18H6.53v7.3H8.8v-7.3zM9 7.67a1.31 1.31 0 0 0-1.3-1.32h-.04a1.32 1.32 0 0 0 0 2.64A1.31 1.31 0 0 0 9 7.71v-.04zm8.46 5.37c0-2.2-1.4-3.05-2.78-3.05a2.6 2.6 0 0 0-2.3 1.18h-.07v-1h-2.14v7.3h2.28V13.6a1.51 1.51 0 0 1 1.36-1.63h.09c.72 0 1.26.45 1.26 1.6v3.91h2.28l.02-4.43z" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="l hg"><div><div class="ci" aria-hidden="false" aria-describedby="10" aria-labelledby="10"><button class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hh dw hi"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.57 14.67c0-.57.13-1.11.38-1.6l.02-.02v-.02l.02-.02c0-.02 0-.02.02-.02.12-.26.3-.52.57-.8L7.78 9v-.02l.01-.02c.44-.41.91-.7 1.44-.85a4.87 4.87 0 0 0-1.19 2.36A5.04 5.04 0 0 0 8 11.6L6.04 13.6c-.19.19-.32.4-.38.65a2 2 0 0 0 0 .9c.08.2.2.4.38.57l1.29 1.31c.27.28.62.42 1.03.42.42 0 .78-.14 1.06-.42l1.23-1.25.79-.78 1.15-1.16c.08-.09.19-.22.28-.4.1-.2.15-.42.15-.67 0-.16-.02-.3-.06-.45l-.02-.02v-.02l-.07-.14s0-.03-.04-.06l-.06-.13-.02-.02c0-.02 0-.03-.02-.05a.6.6 0 0 0-.14-.16l-.48-.5c0-.04.02-.1.04-.15l.06-.12 1.17-1.14.09-.09.56.57c.02.04.08.1.16.18l.05.04.03.06.04.05.03.04.04.06.1.14.02.02c0 .02.01.03.03.04l.1.2v.02c.1.16.2.38.3.68a1 1 0 0 1 .04.25 3.2 3.2 0 0 1 .02 1.33 3.49 3.49 0 0 1-.95 1.87l-.66.67-.97.97-1.56 1.57a3.4 3.4 0 0 1-2.47 1.02c-.97 0-1.8-.34-2.49-1.03l-1.3-1.3a3.55 3.55 0 0 1-1-2.51v-.01h-.02v.02zm5.39-3.43c0-.19.02-.4.07-.63.13-.74.44-1.37.95-1.87l.66-.67.97-.98 1.56-1.56c.68-.69 1.5-1.03 2.47-1.03.97 0 1.8.34 2.48 1.02l1.3 1.32a3.48 3.48 0 0 1 1 2.48c0 .58-.11 1.11-.37 1.6l-.02.02v.02l-.02.04c-.14.27-.35.54-.6.8L16.23 15l-.01.02-.01.02c-.44.42-.92.7-1.43.83a4.55 4.55 0 0 0 1.23-3.52L18 10.38c.18-.21.3-.42.35-.65a2.03 2.03 0 0 0-.01-.9 1.96 1.96 0 0 0-.36-.58l-1.3-1.3a1.49 1.49 0 0 0-1.06-.42c-.42 0-.77.14-1.06.4l-1.2 1.27-.8.8-1.16 1.15c-.08.08-.18.21-.29.4a1.66 1.66 0 0 0-.08 1.12l.02.03v.02l.06.14s.01.03.05.06l.06.13.02.02.01.02.01.02c.05.08.1.13.14.16l.47.5c0 .04-.02.09-.04.15l-.06.12-1.15 1.15-.1.08-.56-.56a2.3 2.3 0 0 0-.18-.19c-.02-.01-.02-.03-.02-.04l-.02-.02a.37.37 0 0 1-.1-.12c-.03-.03-.05-.04-.05-.06l-.1-.15-.02-.02-.02-.04-.08-.17v-.02a5.1 5.1 0 0 1-.28-.69 1.03 1.03 0 0 1-.04-.26c-.06-.23-.1-.46-.1-.7v.01z" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="hj o ao"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F911730f84d3b&amp;operation=register&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b&amp;source=--------------------------bookmark_header-----------" rel="noopener follow"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" class="au de aw ax ay az ba hh bc qb xt xu xv"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="xs" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="#292929"></path></svg></button></a></span></div></div><div class="ck hk"><div><div class="ci" aria-hidden="false" aria-describedby="11" aria-labelledby="11"></div></div></div></div></div><div class="hl hm hn j i d"><div class="ga l"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F911730f84d3b&amp;operation=register&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b&amp;source=--------------------------bookmark_header-----------" rel="noopener follow"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" class="au de aw hq ay az ba xw bc qb cd o ao xx xy xv"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="xs" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="#292929"></path></svg><p class="bm b bn bo cn">Save</p></button></a></span></div><div class="ho l hg"><div><div class="ci" aria-hidden="false" aria-describedby="12" aria-labelledby="12"><button class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Share on twitter"><span class="ci hh dw hi"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M20 5.34c-.67.41-1.4.7-2.18.87a3.45 3.45 0 0 0-5.02-.1 3.49 3.49 0 0 0-1.02 2.47c0 .28.03.54.07.8a9.91 9.91 0 0 1-7.17-3.66 3.9 3.9 0 0 0-.5 1.74 3.6 3.6 0 0 0 1.56 2.92 3.36 3.36 0 0 1-1.55-.44V10c0 1.67 1.2 3.08 2.8 3.42-.3.06-.6.1-.94.12l-.62-.06a3.5 3.5 0 0 0 3.24 2.43 7.34 7.34 0 0 1-4.36 1.49l-.81-.05a9.96 9.96 0 0 0 5.36 1.56c6.4 0 9.91-5.32 9.9-9.9v-.5c.69-.49 1.28-1.1 1.74-1.81-.63.3-1.3.48-2 .56A3.33 3.33 0 0 0 20 5.33" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="ho l hg"><div><div class="ci" aria-hidden="false" aria-describedby="13" aria-labelledby="13"><button class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Share on facebook"><span class="ci hh dw hi"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M19.75 12.04c0-4.3-3.47-7.79-7.75-7.79a7.77 7.77 0 0 0-5.9 12.84 7.77 7.77 0 0 0 4.69 2.63v-5.49h-1.9v-2.2h1.9v-1.62c0-1.88 1.14-2.9 2.8-2.9.8 0 1.49.06 1.69.08v1.97h-1.15c-.91 0-1.1.43-1.1 1.07v1.4h2.17l-.28 2.2h-1.88v5.52a7.77 7.77 0 0 0 6.7-7.71" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="ho l hg"><div><div class="ci" aria-hidden="false" aria-describedby="14" aria-labelledby="14"><button class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Share on linkedin"><span class="ci hh dw hi"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M19.75 5.39v13.22a1.14 1.14 0 0 1-1.14 1.14H5.39a1.14 1.14 0 0 1-1.14-1.14V5.39a1.14 1.14 0 0 1 1.14-1.14h13.22a1.14 1.14 0 0 1 1.14 1.14zM8.81 10.18H6.53v7.3H8.8v-7.3zM9 7.67a1.31 1.31 0 0 0-1.3-1.32h-.04a1.32 1.32 0 0 0 0 2.64A1.31 1.31 0 0 0 9 7.71v-.04zm8.46 5.37c0-2.2-1.4-3.05-2.78-3.05a2.6 2.6 0 0 0-2.3 1.18h-.07v-1h-2.14v7.3h2.28V13.6a1.51 1.51 0 0 1 1.36-1.63h.09c.72 0 1.26.45 1.26 1.6v3.91h2.28l.02-4.43z" fill="#A8A8A8"></path></svg></span></button></div></div></div><div class="l hg"><div><div class="ci" aria-hidden="false" aria-describedby="15" aria-labelledby="15"><button class="au av aw ax ay az ba bb bc bd be bf bg bh bi"><span class="ci hh dw hi"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M3.57 14.67c0-.57.13-1.11.38-1.6l.02-.02v-.02l.02-.02c0-.02 0-.02.02-.02.12-.26.3-.52.57-.8L7.78 9v-.02l.01-.02c.44-.41.91-.7 1.44-.85a4.87 4.87 0 0 0-1.19 2.36A5.04 5.04 0 0 0 8 11.6L6.04 13.6c-.19.19-.32.4-.38.65a2 2 0 0 0 0 .9c.08.2.2.4.38.57l1.29 1.31c.27.28.62.42 1.03.42.42 0 .78-.14 1.06-.42l1.23-1.25.79-.78 1.15-1.16c.08-.09.19-.22.28-.4.1-.2.15-.42.15-.67 0-.16-.02-.3-.06-.45l-.02-.02v-.02l-.07-.14s0-.03-.04-.06l-.06-.13-.02-.02c0-.02 0-.03-.02-.05a.6.6 0 0 0-.14-.16l-.48-.5c0-.04.02-.1.04-.15l.06-.12 1.17-1.14.09-.09.56.57c.02.04.08.1.16.18l.05.04.03.06.04.05.03.04.04.06.1.14.02.02c0 .02.01.03.03.04l.1.2v.02c.1.16.2.38.3.68a1 1 0 0 1 .04.25 3.2 3.2 0 0 1 .02 1.33 3.49 3.49 0 0 1-.95 1.87l-.66.67-.97.97-1.56 1.57a3.4 3.4 0 0 1-2.47 1.02c-.97 0-1.8-.34-2.49-1.03l-1.3-1.3a3.55 3.55 0 0 1-1-2.51v-.01h-.02v.02zm5.39-3.43c0-.19.02-.4.07-.63.13-.74.44-1.37.95-1.87l.66-.67.97-.98 1.56-1.56c.68-.69 1.5-1.03 2.47-1.03.97 0 1.8.34 2.48 1.02l1.3 1.32a3.48 3.48 0 0 1 1 2.48c0 .58-.11 1.11-.37 1.6l-.02.02v.02l-.02.04c-.14.27-.35.54-.6.8L16.23 15l-.01.02-.01.02c-.44.42-.92.7-1.43.83a4.55 4.55 0 0 0 1.23-3.52L18 10.38c.18-.21.3-.42.35-.65a2.03 2.03 0 0 0-.01-.9 1.96 1.96 0 0 0-.36-.58l-1.3-1.3a1.49 1.49 0 0 0-1.06-.42c-.42 0-.77.14-1.06.4l-1.2 1.27-.8.8-1.16 1.15c-.08.08-.18.21-.29.4a1.66 1.66 0 0 0-.08 1.12l.02.03v.02l.06.14s.01.03.05.06l.06.13.02.02.01.02.01.02c.05.08.1.13.14.16l.47.5c0 .04-.02.09-.04.15l-.06.12-1.15 1.15-.1.08-.56-.56a2.3 2.3 0 0 0-.18-.19c-.02-.01-.02-.03-.02-.04l-.02-.02a.37.37 0 0 1-.1-.12c-.03-.03-.05-.04-.05-.06l-.1-.15-.02-.02-.02-.04-.08-.17v-.02a5.1 5.1 0 0 1-.28-.69 1.03 1.03 0 0 1-.04-.26c-.06-.23-.1-.46-.1-.7v.01z" fill="#A8A8A8"></path></svg></span></button></div></div></div></div></header><span class="l"></span><section><div><div class="gf as hv hw hx hy"></div><div class="hz ia ib ic id"><div class=""><h1 id="2e9b" class="pw-post-title ie if ig bm ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc gh" data-selectable-paragraph="">(Archive) Phoenix Deployments on GCP with Nginx</h1></div><figure class="fq fs je jf jg jh fm fn paragraph-image"><div role="button" tabindex="0" class="ji jj do jk ce jl"><div class="fm fn jd"><picture><source data-testid="og" srcset="https://miro.medium.com/max/640/1*bVu7g4dHlgtGYO78RWMi9g.jpeg 640w, https://miro.medium.com/max/720/1*bVu7g4dHlgtGYO78RWMi9g.jpeg 720w, https://miro.medium.com/max/750/1*bVu7g4dHlgtGYO78RWMi9g.jpeg 750w, https://miro.medium.com/max/786/1*bVu7g4dHlgtGYO78RWMi9g.jpeg 786w, https://miro.medium.com/max/828/1*bVu7g4dHlgtGYO78RWMi9g.jpeg 828w, https://miro.medium.com/max/1100/1*bVu7g4dHlgtGYO78RWMi9g.jpeg 1100w, https://miro.medium.com/max/1400/1*bVu7g4dHlgtGYO78RWMi9g.jpeg 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="ce jm jn c" width="700" height="467" loading="eager" role="presentation" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_bVu7g4dHlgtGYO78RWMi9g.jpeg"></picture></div></div><figcaption class="jo bl fo fm fn jp jq bm b bn bo cn" data-selectable-paragraph="">Kubernetes (kidding) — Photo credit <a class="au jr" href="https://unsplash.com/@jpvalery?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Jp Valery</a> on <a class="au jr" href="https://unsplash.com/s/photos/burning-cash?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h2 id="2dcc" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">Another way to deploy Elixir apps</h2><p id="4dba" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">There are <a class="au jr" href="https://alchemist.camp/articles/elixir-releases-deployment-render" rel="noopener ugc nofollow" target="_blank">A</a> <a class="au jr" href="https://www.cogini.com/blog/best-practices-for-deploying-elixir-apps/" rel="noopener ugc nofollow" target="_blank">LOT</a> <a class="au jr" href="https://hashrocket.com/blog/posts/automate-your-elixir-deployments-part-1-ansible" rel="noopener ugc nofollow" target="_blank">of</a> <a class="au jr" href="https://hashrocket.com/blog/posts/automate-your-elixir-deployments-part-2-distillery-edeliver" rel="noopener ugc nofollow" target="_blank">different</a> <a class="au jr" href="https://dev.to/jonlunsford/deploying-elixir-1-of-3-building-releases-with-mix-1o4a" rel="noopener ugc nofollow" target="_blank">ways</a> <a class="au jr" href="https://blog.carbonfive.com/how-to-deploy-elixir-releases-with-ansible/" rel="noopener ugc nofollow" target="_blank">to</a> <a class="au jr" href="https://blog.carbonfive.com/cross-platform-elixir-releases-with-docker/" rel="noopener ugc nofollow" target="_blank">deploy</a> <a class="au jr" href="https://www.digitalocean.com/community/tutorials/how-to-automate-elixir-phoenix-deployment-with-distillery-and-edeliver-on-ubuntu-16-04" rel="noopener ugc nofollow" target="_blank">Elixir/Phoenix</a> <a class="au jr" href="https://cloud.google.com/community/tutorials/elixir-phoenix-on-kubernetes-google-container-engine" rel="noopener ugc nofollow" target="_blank">applications</a>. I want to fill a gap in the current literature: how do you deploy a Phoenix web app to a single Linux server optimizing for cost effectiveness, control, and simplicity, while using modern Elixir tools like releases to achieve zero-downtime deploys without hot code upgrading?</p><blockquote class="ll"><p id="47b3" class="lm ln ig bm lo lp lq lr ls lt lu lk cn" data-selectable-paragraph="">I’m going to walk through a deployment strategy that can take you start-to-finish with a full-featured Phoenix web app running on a free-forever <a class="au jr" href="https://cloud.google.com/free" rel="noopener ugc nofollow" target="_blank">Google Cloud Platform Compute Engine instance</a>.</p></blockquote><p id="356f" class="pw-post-body-paragraph kq kr ig ks b kt lv kv kw kx lw kz la kd lx lc ld kh ly lf lg kl lz li lj lk hz gh" data-selectable-paragraph="">This setup is completely free, and when you have more traffic the cost of scaling on raw GCP instances is a lot cheaper than on platform-as-a-service offerings (<a class="au jr" href="https://hexdocs.pm/phoenix/heroku.html#content" rel="noopener ugc nofollow" target="_blank">Heroku</a>, <a class="au jr" href="https://hexdocs.pm/phoenix/gigalixir.html#content" rel="noopener ugc nofollow" target="_blank">Gigalixir</a>, <a class="au jr" href="https://render.com/docs/deploy-phoenix" rel="noopener ugc nofollow" target="_blank">Render</a>, etc). And, you’re in full control of the system so you don’t have to work around any fixed limitations. Scaling can be as simple as upgrading the specs of the instance when it can’t keep up anymore.</p><blockquote class="ma mb mc"><p id="af5a" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">My heretical belief is that the biggest risk to the reliability / availability of your app is developers changing code and running tasks, NOT the remote chance of hardware failure. Don’t be dumb — back up your database. But otherwise, the biggest way to reduce infrastructure-related downtime is keeping your server environment and deployment processes dead simple and <strong class="ks ih">fast</strong> so that devs won’t make mistakes and can restore things quickly when they do.</p></blockquote><p id="5475" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">One of the great things about Elixir and Phoenix is that you can get <a class="au jr" href="https://www.cogini.com/blog/benchmarking-phoenix-on-digital-ocean/" rel="noopener ugc nofollow" target="_blank">a LOT of milage out of very limited hardware</a>, so there’s a good chance that your hosting with this strategy will stay free for a very long time, and incredibly cheap for even longer. And it will be wicked fast, reliable, and observable.</p><h2 id="6769" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">What we’re optimizing for</h2><ul class=""><li id="5778" class="mm mn ig ks b kt ku kx ky kd mo kh mp kl mq lk mr ms mt mu gh" data-selectable-paragraph="">Absolutely 100% free to start, cheap to scale</li><li id="48d9" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk mr ms mt mu gh" data-selectable-paragraph="">No Docker, Ansible, Distillery, or other build/deploy tools</li><li id="f346" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk mr ms mt mu gh" data-selectable-paragraph="">Single server setup</li><li id="d7c2" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk mr ms mt mu gh" data-selectable-paragraph="">Fault-tolerant at server level, e.g. if the server crashes or restarts the app will come back up automatically</li><li id="142d" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk mr ms mt mu gh" data-selectable-paragraph="">Secure (enough, this can be an infinite rabbit hole)</li><li id="a9cd" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk mr ms mt mu gh" data-selectable-paragraph=""><em class="md">Fast</em> no-downtime deployments and rollbacks, without hot code reloading</li><li id="e5e0" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk mr ms mt mu gh" data-selectable-paragraph="">Full control and visibility, leveraging raw Linux built-in tools</li></ul><h2 id="b5c5" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">Free without the compromises (except your time of course)</h2><p id="f574" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">I really like the level of control and flexibility that this approach provides. You’ll end up feeling a lot more comfortable with the raw basics of how your server runs and how to hook in and introspect when there are problems. It takes some time to set up, and there might be some new Linux skills that you’ll need to pick up along the way. This is a long guide, but stick with me and I think you’ll be really happy with the result! (or bookmark it and come back the next time you need to spin up a side project)</p><h2 id="0d29" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">Overview</h2><blockquote class="ma mb mc"><p id="bb2d" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">This is a quick outline of what we’ll be doing, so you can decide whether it looks interesting before we get into the weeds.</p></blockquote><ol class=""><li id="619f" class="mm mn ig ks b kt me kx mf kd na kh nb kl nc lk nd ms mt mu gh" data-selectable-paragraph="">Get a domain</li><li id="706c" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Log into Google Cloud Platform and provision an F1-Micro Compute Engine instance</li><li id="6439" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Make the IP address of the instance static</li><li id="1ec2" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Add your SSH key to metadata in Compute Engine settings so you can connect to the instance</li><li id="8495" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Set up an ssh alias on your dev machine so it’s easy to access the server</li><li id="ae77" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Enable swap memory on the instance</li><li id="85a7" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Install Erlang, Elixir, Node, and Postgres</li><li id="932d" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Set a secure password for Postgres</li><li id="171c" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Configure Postgres to allow remote connections</li><li id="8cd0" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Connect to your remote Git repo where your project lives</li><li id="1778" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Get your app secrets onto the server</li><li id="c7cb" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Install Nginx + Certbot for SSL</li><li id="9b5a" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Configure Nginx to reverse proxy requests to your app</li><li id="8d8e" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Build a deployment shell script for some basic CI checks and allowing incremental release versions and no-downtime deployments</li><li id="4ee8" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Create systemd services to ensure app starts up if server crashes and resets</li><li id="14a3" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Commit and push a change. Then deploy using a single command on your dev machine!</li><li id="e8d7" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Attach to journald to watch logs</li><li id="2961" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Bonus 1: Secure your data against the possibility of eventual hardware failure by creating another Google account with a free instance and set up automated backups using cron</li><li id="c831" class="mm mn ig ks b kt mv kx mw kd mx kh my kl mz lk nd ms mt mu gh" data-selectable-paragraph="">Bonus 2: Rollback script</li></ol><h1 id="a79a" class="ne jt ig bm ju nf ng nh jy ni nj nk kc nl nm nn kg no np nq kk nr ns nt ko nu gh" data-selectable-paragraph="">The Details!</h1><h2 id="5a19" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">1 — Get a domain</h2><p id="d645" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">If you want this whole thing to be <em class="md">super free</em>, you can get a domain from <a class="au jr" href="https://freenom.com/" rel="noopener ugc nofollow" target="_blank">https://freenom.com</a> and get a full-fledged domain with DNS and the works for free. The downside is that you’re limited to one of five super random top level domains (<code class="gg nv nw nx ny b">.ml</code>, <code class="gg nv nw nx ny b">.gq</code> etc), but it’s a great way to get the name you want before committing the cash to buy the <code class="gg nv nw nx ny b">.com</code> version. Once you have a domain, go to the DNS settings page — we’ll be adding some records later on.</p><h2 id="449f" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">2 — Provision an F1-Micro Compute Engine instance</h2><p id="4e0b" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">You can access the <a class="au jr" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">Google Cloud Platform console</a> using any Google account you own (typically a Gmail address). For the sake of separation (and security), I like to create a new gmail address with the name of my project in it so that the account is fully isolated (e.g. <code class="gg nv nw nx ny b">damon.my.app@gmail.com</code>).</p><p id="e225" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">If you access the console with a new account, you may need to activate the free trial before it will let you do much. Go ahead and activate it, and put in a card if prompted. Don’t worry — you won’t be charged for this server even after the trial runs out.</p><p id="5eca" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Once you’re in the console, click on the top-left menu icon and then select <em class="md">Compute Engine -&gt; VM Instances</em>. If it’s your first time, it may take a minute to start. When it’s ready, click the “Create” button. Configure with the following options and then create:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="0df8" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph=""><strong class="ny ih">Name:</strong> whatever you want<br><strong class="ny ih">Region:</strong> double check <a class="au jr" href="https://cloud.google.com/free" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/free</a> to make sure the region you want is listed in the Compute Engine section<br><strong class="ny ih">Series:</strong> N1<strong class="ny ih"><br>Machine Type:</strong> f1-micro<br><strong class="ny ih">Boot Disk:</strong> <br>  <strong class="ny ih">Operating System:</strong> Ubuntu<br>  <strong class="ny ih">Version:</strong> 20.04 LTS<br>  <strong class="ny ih">Boot Disk Type:</strong> Standard persistent disk, 30GB<br><strong class="ny ih">Firewall:</strong> allow both HTTP and HTTPS traffic</span></pre><h2 id="2a39" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">3 — Make the IP address of the instance static</h2><p id="79de" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">Click the triple lines icon in the top left to bring up the menu, then go to <em class="md">VPC Network -&gt; External IP addresses</em>. There should be a single row, belonging to the instance you just created. Change the <strong class="ks ih">Type</strong> from “ephemeral” to “static” and give it a name of your choosing. Copy the IP address (should look something like <code class="gg nv nw nx ny b">34.69.61.31</code>), since you’ll need it in the next steps.</p><p id="aae7" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">In the DNS settings for your domain, create <code class="gg nv nw nx ny b">A</code> records for both <code class="gg nv nw nx ny b">&lt;your_domain&gt;.com</code> and <code class="gg nv nw nx ny b">www.&lt;your_domain&gt;.com</code> that point to that IP address.</p><h2 id="c63d" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">4 — Add your SSH key</h2><p id="21fe" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">Click the triple lines icon again in the top left and go to <em class="md">Compute Engine -&gt; Metadata</em>. Click on the tab <strong class="ks ih">SSH Keys</strong>. Then click the “Add SSH Keys” button.</p><p id="e01e" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">To get an SSH key from your dev machine to paste into the field, run <code class="gg nv nw nx ny b">cat ~/.ssh/id_rsa.pub</code> in your local terminal. If you don’t get output, create an ssh key by following <a class="au jr" href="https://www.digitalocean.com/docs/droplets/how-to/add-ssh-keys/create-with-openssh/" rel="noopener ugc nofollow" target="_blank">these instructions</a> and then run the command again and paste the result into the field in GCP and hit “Save”.</p><h2 id="45e8" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">5 — Set up SSH alias</h2><p id="ebc8" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">To connect to the server, we could run <code class="gg nv nw nx ny b">ssh &lt;IP Address from step 3&gt;</code>, but it’s going to get tiresome to type in the IP all the time (especially if you have lots of these servers). So instead, we’ll set up an alias so that we can type in <code class="gg nv nw nx ny b">ssh my_app</code> and have it connect automatically.</p><p id="a3ce" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">On your dev machine, enter <code class="gg nv nw nx ny b">vim ~/.ssh/config</code> (which will create or open the file). Put the following code in the file, making sure that the first block goes at the very top before anything else already in there, and that the second block goes at the very bottom below anything else:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="543e" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">Host my_app<br> Hostname <!-- -->&lt;IP address from step 3&gt;<br> User &lt;your local user name&gt;</span><span id="f010" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph="">Host *<br> AddKeysToAgent yes<br> UseKeychain yes<br> IdentityFile ~/.ssh/id_rsa</span></pre><blockquote class="ma mb mc"><p id="7049" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">Note: if you aren’t familiar with <code class="gg nv nw nx ny b"><em class="ig">vim</em></code>, just use the arrow keys to navigate and <a class="au jr" href="https://coderwall.com/p/adv71w/basic-vim-commands-for-getting-started" rel="noopener ugc nofollow" target="_blank">learn how to switch between insert mode and command mode, and saving and exiting</a>.</p></blockquote><p id="48a8" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Replace the IP and user with your info and remove the comments. Save and quit, and now you should be able to connect to your server with the command <code class="gg nv nw nx ny b">ssh my_app</code>. Nice! If you connect successfully to the instance, congrats! You’re now connected and in full control of your free server. If you didn’t connect successfully, you may need to look up how to add your ssh key to <code class="gg nv nw nx ny b">ssh-agent</code>.</p><p id="a831" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">When you added your key to the metadata, a Linux user account was created on the server that matches the name of your local user account. This user has <code class="gg nv nw nx ny b">sudo</code> privileges, isn’t the root user, and is passwordless (can only be accessed with the SSH keys in metadata), all of which make this user a pretty good choice for the user account responsible for deploying the app. Assuming you’re the only developer deploying code for now this setup is plenty secure, but as you add developers and complexity you might think about creating a dedicated user for deployment with more restricted permissions.</p><h2 id="dac5" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">6 — Enable swap memory on the instance</h2><p id="1164" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">This server is TINY — it only has .6GB of RAM. When you compile a Phoenix application on it for the first time on it, there’s a good chance that it will freeze up on you by running out of resources. But, since we get a 30GB spinner for free along with it, we can <a class="au jr" href="https://www.digitalocean.com/community/tutorials/how-to-add-swap-space-on-ubuntu-20-04" rel="noopener ugc nofollow" target="_blank">safely enable swap memory</a> which will allow the server to push past the limit (albeit with slower memory) once it exceeds available RAM. To create 1GB of swap space, run the following on the server:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="b856" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo fallocate -l 1G /swapfile</span></pre><p id="386c" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Next make sure the file can only be read by the root user:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="a7ea" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo chmod 600 /swapfile</span></pre><p id="880a" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Next we’ll mark the file as swap:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="0446" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo mkswap /swapfile</span></pre><p id="145b" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">And enable it:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="0f43" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo swapon /swapfile</span></pre><p id="c1b8" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">And make it permanent to survive restarts:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="5a0c" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">echo ‘/swapfile none swap sw 0 0’ | sudo tee -a /etc/fstab</span></pre><p id="c411" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">To verify that it worked, run the handy command <code class="gg nv nw nx ny b">top</code> which will give you a little dashboard of the resource consumption on the server. You should see a line like the following: <code class="gg nv nw nx ny b">MiB Swap: 1024.0 total</code>. Press ctrl+c to exit.</p><p id="6c56" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">There is a lot to learn about swap, and if you want to read more you can <a class="au jr" href="https://www.digitalocean.com/community/tutorials/how-to-add-swap-space-on-ubuntu-20-04" rel="noopener ugc nofollow" target="_blank">start here</a>. These commands and the default configuration that comes with them are fine for our purposes here.</p><h2 id="f84e" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">7 — Install Erlang, Elixir, Node, and Postgres</h2><p id="c3b0" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">In case these instructions get stale, follow the <a class="au jr" href="https://elixir-lang.org/install.html" rel="noopener ugc nofollow" target="_blank">official Elixir install guide for Ubuntu here</a>. Install Erlang and Elixir using the following:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="bc87" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">wget <a class="au jr" href="https://packages.erlang-solutions.com/erlang-solutions_2.0_all.deb" rel="noopener ugc nofollow" target="_blank">https://packages.erlang-solutions.com/erlang-solutions_2.0_all.deb</a> &amp;&amp; sudo dpkg -i erlang-solutions_2.0_all.deb</span><span id="7342" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph="">sudo apt update</span><span id="db5a" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph="">sudo apt install esl-erlang</span><span id="6496" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph="">sudo apt install elixir</span></pre><p id="cc1f" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Now let’s get Node and NPM:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="a89d" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo apt install nodejs npm</span></pre><p id="08e4" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">And now Postgres:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="b9b7" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo apt install postgresql postgresql-contrib</span></pre><h2 id="951d" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">8 — Set a secure password for Postgres</h2><p id="3f5d" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">Now that Postgres is installed, we’ll want to change the password to something secure. Later, we’ll be opening the database port on the server to the web (alert: security tradeoff!), so the password has to be rock solid. Generate a random password with a tool like<a class="au jr" href="https://passwordsgenerator.net/" rel="noopener ugc nofollow" target="_blank"> https://passwordsgenerator.net</a> and paste it into a safe place. Log into Postgres with the default postgres user:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="3851" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo -u postgres psql</span></pre><p id="53c6" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">And update the password:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="bff2" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">\password postgres</span><span id="d61a" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph="">(paste the password you generated and hit enter)</span><span id="feb6" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph="">(now put \q and hit enter to quit)</span></pre><h2 id="a53b" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">9 — Configure Postgres to allow remote connections</h2><p id="4d3d" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">It’s often helpful to be able to access your database with a GUI on your development machine. I use <a class="au jr" href="https://eggerapps.at/postico/" rel="noopener ugc nofollow" target="_blank">Postico</a>, but <a class="au jr" href="https://tableplus.com/" rel="noopener ugc nofollow" target="_blank">TablePlus</a> and <a class="au jr" href="https://www.pgadmin.org/" rel="noopener ugc nofollow" target="_blank">pgAdmin</a> work great too. But before you can use one of these to connect to your database, you’ll need to adjust the firewall in GCP and alter some Postgres settings to open the database port (<code class="gg nv nw nx ny b">5432</code>) to the outside world.</p><p id="b64e" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Back in the GCP console, open the navigation menu and go to <em class="md">VPC network -&gt; Firewall</em>. Click the “Create Firewall Rule” button up top. Alter the following settings and click “Create”:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="1bdc" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph=""><strong class="ny ih">Name:</strong> whatever you want, something like "database"<strong class="ny ih"><br>Targets:</strong> All instances in the network<br><strong class="ny ih">Source IP Ranges:</strong> 0.0.0.0/0<br><strong class="ny ih">tcp:</strong> Check box, and enter 5432 in field</span></pre><p id="29ec" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Security note: the more secure way to open the firewall is to restrict the <code class="gg nv nw nx ny b">Targets</code> to just your instance so you don’t add instances later without remembering the port is open by default on all of them now. Also you could restrict the <code class="gg nv nw nx ny b">Source IP Ranges</code> to just your own IP or the IP of a VPN that you can access, so that the port is only open to you (instead of the whole internet). However, if your Postgres password is secure and your database doesn’t hold extremely sensitive data, this configuration will probably be fine till you’re ready to really tighten security as you scale.</p><p id="68be" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Now we’ll open up the Postgres server itself to allow connections beyond<code class="gg nv nw nx ny b">localhost</code>. Find your <code class="gg nv nw nx ny b">postgresql.conf</code> file by running:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="330f" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo find / -name "postgresql.conf"</span></pre><p id="4597" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Mine is at <code class="gg nv nw nx ny b">/etc/postgresql/12/main/postgresql.conf</code></p><p id="7cc3" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Open the file to edit it:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="c94a" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo vim &lt;the file path you found&gt;</span></pre><p id="c06f" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Replace the line <code class="gg nv nw nx ny b">listen_addresses = 'localhost'</code> with <code class="gg nv nw nx ny b">listen_addresses = '*'</code>.</p><p id="a99b" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Find your <code class="gg nv nw nx ny b">pg_hba.conf</code> file using <code class="gg nv nw nx ny b">sudo find / -name "pg_hba.conf"</code> (mine is <code class="gg nv nw nx ny b">/etc/postgresql/12/main/pg_hba.conf</code>) and open to edit:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="644b" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo vim &lt;the file path you found&gt;</span></pre><p id="d774" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Add the following lines at the very end of the file:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="2a22" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">host    all             all             0.0.0.0/0               md5<br>host    all             all             ::/0                    md5</span></pre><p id="8fba" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Now, restart postgres: <code class="gg nv nw nx ny b">sudo systemctl restart postgresql</code></p><p id="74b0" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Verify that you can connect with Postico or whatever app you use. Here’s an example of what it should look like. This will connect you to the <code class="gg nv nw nx ny b">postgres</code> database which doesn’t have anything in it which is fine. Later, we’ll run <code class="gg nv nw nx ny b">MIX_ENV=prod mix ecto.create</code> to actually create the DB for our app, and we’ll tweak these settings in Postico so we can connect to that specific database.</p><figure class="nz oa ob oc fy jh fm fn paragraph-image"><div role="button" tabindex="0" class="ji jj do jk ce jl"><div class="fm fn oo"><picture><source data-testid="og" srcset="https://miro.medium.com/max/640/1*X9zic5p0-EzZCw-tJmPPtA.png 640w, https://miro.medium.com/max/720/1*X9zic5p0-EzZCw-tJmPPtA.png 720w, https://miro.medium.com/max/750/1*X9zic5p0-EzZCw-tJmPPtA.png 750w, https://miro.medium.com/max/786/1*X9zic5p0-EzZCw-tJmPPtA.png 786w, https://miro.medium.com/max/828/1*X9zic5p0-EzZCw-tJmPPtA.png 828w, https://miro.medium.com/max/1100/1*X9zic5p0-EzZCw-tJmPPtA.png 1100w, https://miro.medium.com/max/1400/1*X9zic5p0-EzZCw-tJmPPtA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"><img alt="" class="ce jm jn c" width="700" height="381" loading="lazy" role="presentation" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_X9zic5p0-EzZCw-tJmPPtA.png"></picture></div></div></figure><h2 id="2c37" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">10 — Connect to your remote Git repo where your project lives</h2><p id="4dc2" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">Finally, we’re ready to put some code on this server! I’ve created an <a class="au jr" href="https://github.com/damonvjanis/optimized_nginx/" rel="noopener ugc nofollow" target="_blank">empty Phoenix repository</a> on GitHub that you’re welcome to fork and follow along. There are only a few changes I made to the default stuff that <code class="gg nv nw nx ny b">mix phx.new</code> generated, and you can see all of those changes in this tiny <a class="au jr" href="https://github.com/damonvjanis/optimized_nginx/pull/1/files" rel="noopener ugc nofollow" target="_blank">pull request</a>. It’s just a couple of tweaks to config, and ignoring secrets files. We’ll be creating some secrets files locally on our development machine, adding prod secrets to them, and then copying them up to our server in subsequent steps. Once you’ve forked the project, on your server run the following:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="ce1f" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">git clone https://github.com/&lt;YOUR_GITHUB_USERNAME/optimized_nginx</span></pre><blockquote class="ma mb mc"><p id="e88f" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">Note: your fork will be a public repo so there aren’t any authentication considerations, but if you’re using a private repo you’ll want to <a class="au jr" href="https://www.digitalocean.com/docs/droplets/how-to/add-ssh-keys/create-with-openssh/" rel="noopener ugc nofollow" target="_blank">generate an SSH key</a> on the server and add it to your user account in GitHub, BitBucket, or wherever the repo lives. Then, make sure to run the <code class="gg nv nw nx ny b"><em class="ig">git clone</em></code> command using ssh, otherwise you’ll be prompted for account credentials every time you deploy and it’ll interrupt the smooth deployment process we’ll be setting up later.</p></blockquote><p id="e8b9" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Now, on your dev machine, open up the project (if you’re using the example repo fork just clone it locally) and create <code class="gg nv nw nx ny b">config/prod.secret.exs</code>. We need some database credentials and some endpoint instructions to start the server with a dynamic port. You can use the following, but be sure to generate a <code class="gg nv nw nx ny b">secret_key_base</code> and paste in your prod database password that you generated in step 8.</p><figure class="nz oa ob oc fy jh"><div class="m op l do"><div class="oq or l"></div></div></figure><h2 id="f310" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">11 — Get your app secrets onto the server</h2><p id="6593" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">The next step is to move the <code class="gg nv nw nx ny b">prod.secret.exs</code> file that you just created up to the server, using <code class="gg nv nw nx ny b">scp</code> (which stands for “secure copy”). It works just like the <code class="gg nv nw nx ny b">ssh my_app</code> command that we use to connect to the server, but you specify a local path and a remote path and it will transfer files up to the server (or down <em class="md">from</em> the server). Close the SSH session to the server by typing <code class="gg nv nw nx ny b">exit</code>, and enter the following in your local shell:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="14a2" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">scp config/prod.secret.exs my_app:~/optimized_nginx/config/</span></pre><p id="0fc9" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Now connect to the server again with <code class="gg nv nw nx ny b">ssh my_app</code>, and cd into the <code class="gg nv nw nx ny b">optimized_nginx</code> directory. Let’s make sure that our config between the app and database is successful by running the following:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="a7bd" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">MIX_ENV=prod mix deps.get</span><span id="759c" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph="">MIX_ENV=prod mix ecto.create</span></pre><p id="c5b7" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">It may take a few minutes to compile this first time, the VM is not very powerful. Once it’s done though, sweet! You’ve got a database. Make sure to update your Postico config with the database name, <code class="gg nv nw nx ny b">my_app</code> in this case and make sure you can connect.</p><h2 id="b2f2" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">12 — Install Nginx + Certbot for SSL</h2><p id="29b0" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">You absolutely need to secure your website, using SSL. And, the LetsEncrypt project makes it free and painless to set up with the Certbot package.</p><p id="d5af" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">It’s possible to get a <a class="au jr" href="https://www.theerlangelist.com/article/operating_via_development" rel="noopener ugc nofollow" target="_blank">LetsEncrypt cert using only Elixir</a>, eliminating the need to set up a web server to reverse proxy requests to the built-in Cowboy web server that Phoenix uses. I really love this concept of Elixir-only, but using that approach I couldn’t find a way to achieve zero downtime deployments on a single-server setup so we’ll fudge here and go the reverse proxy route.</p><blockquote class="ma mb mc"><p id="20cf" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">Our zero downtime deployment strategy is to spin up our app with the new version of the code, while the old version of the code is still running but on a separate port (<code class="gg nv nw nx ny b"><em class="ig">4000</em></code> or <code class="gg nv nw nx ny b"><em class="ig">4001</em></code>). Then, we reload the reverse proxy so that it starts directing requests to the port where the new code is running.</p></blockquote><p id="a727" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">So instead of the pure Elixir approach, we’re going to use the extremely-fast web server Nginx to listen on port 80 and 443 and handle SSL concerns. Nginx will reverse-proxy requests to Cowboy on port <code class="gg nv nw nx ny b">4000</code> and <code class="gg nv nw nx ny b">4001</code> where our app will be listening. As a bonus, the Certbot package for LetsEncrypt makes it super easy to set up an SSL cert when you’re using Nginx. On your server, run the following:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="1ee2" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo apt install nginx</span></pre><p id="011d" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">This command installs Nginx and starts the server. If you visit <code class="gg nv nw nx ny b">http://&lt;your_domain&gt;.com</code>, you should now see the default Nginx page. Nice! Now let’s open the Nginx site configuration:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="fd35" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo vim /etc/nginx/sites-available/default</span></pre><p id="a592" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Find the line <code class="gg nv nw nx ny b">server_name: _;</code> and replace it with <code class="gg nv nw nx ny b">server_name &lt;your_domain&gt;.com www.&lt;your_domain&gt;.com;</code>. Save and quit. This change allows Certbot to identify the correct domain when it attempts to create a certificate.</p><p id="7988" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Next, let’s install Certbot (and the nginx extension for it):</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="098e" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo apt install certbot python3-certbot-nginx</span></pre><p id="1c4e" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">And now let’s run it to create our SSL certificate:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="13ea" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo certbot --nginx -d <!-- -->&lt;your_domain&gt;.com -d www.&lt;your_domain&gt;.com</span></pre><p id="4894" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">You’ll be prompted to enter your email address, agree to some terms, and share your email address (you don’t have to). If everything is successful, it’ll ask you to enter <code class="gg nv nw nx ny b">1</code>or <code class="gg nv nw nx ny b">2</code> to choose whether to redirect to HTTPS. Unless you have a reason not to, choose 2 👍. Next, let’s test to make sure the auto-renew works:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="bdc7" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo certbot renew --dry-run</span></pre><blockquote class="ma mb mc"><p id="8856" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">If it works, it means that your certificate will renew automatically in the background every 90 days without any intervention, staying free and up-to-date forever without thought. Beautiful!</p></blockquote><h2 id="9ff0" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">13 — Configure Nginx to reverse proxy requests to your app</h2><p id="3944" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">As exciting as it is to see the Nginx default static page, what we <em class="md">really</em> want is to see the *Phoenix* default static page 😉. Let’s instruct Nginx to forward requests to port 4000, get Phoenix running, and make sure it all works. Open the Nginx site config file again:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="a9dd" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo vim /etc/nginx/sites-available/default</span></pre><p id="70d6" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Above the first <code class="gg nv nw nx ny b">server { ...</code> block, put the following:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="9fe9" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">upstream phoenix {<br>    server 127.0.0.1:4000;<br>}</span></pre><p id="a449" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">And then within the first <code class="gg nv nw nx ny b">server { ...</code> block, find the <code class="gg nv nw nx ny b">location / { ...</code> block and replace it completely with the following:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="6cd3" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">if ($host = www.&lt;your_domain&gt;.com) {<br>  return 301 $scheme://&lt;your_domain&gt;.com$request_uri;<br>}</span><span id="16d7" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph="">location /.well-known {<br>  alias /var/www/.well-known;<br>}</span><span id="5212" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph="">location / {<br>  allow all;</span><span id="4cf9" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph="">  # Proxy Headers<br>  proxy_http_version 1.1;<br>  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>  proxy_set_header Host $http_host;<br>  proxy_set_header X-Cluster-Client-Ip $remote_addr;</span><span id="7be2" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph="">  # WebSockets<br>  proxy_set_header Upgrade $http_upgrade;<br>  proxy_set_header Connection "upgrade";</span><span id="d93c" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph=""># Proxies to whatever you set in the 'upstream phoenix {...' block<br>  proxy_pass http://phoenix;<br>}</span></pre><p id="df8e" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Most of this reverse proxy config comes from <a class="au jr" href="https://www.digitalocean.com/community/tutorials/how-to-automate-elixir-phoenix-deployment-with-distillery-and-edeliver-on-ubuntu-16-04#step-9-%E2%80%94-setting-up-a-reverse-proxy-on-the-production-server" rel="noopener ugc nofollow" target="_blank">step 9 of this fantastic Digital Ocean guide</a>, and if you want more details you can explore them there. Let’s reload Nginx to update the config:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="b091" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo systemctl reload nginx</span></pre><p id="6fd0" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Now, let’s get Phoenix up and running (don’t worry, more robust deployment is coming) and make sure that requests are proxying to it successfully:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="c6e4" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph=""># get the assets ready<br>cd assets &amp;&amp; npm install &amp;&amp; cd ../<br>npm run deploy --prefix ./assets<br>MIX_ENV=prod mix phx.digest</span><span id="fe6f" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph=""># run the app on port 4000<br>PORT=4000 MIX_ENV=prod mix phx.server</span></pre><p id="9af9" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Now visit <code class="gg nv nw nx ny b">&lt;your_domain&gt;.com</code> and you should see the Phoenix page. Cool!</p><h2 id="ffd7" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">14 — Build a deployment shell script</h2><p id="30c1" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">Now that you have an app running on your custom domain, with a database and SSL, you could decide that it’s good enough and find a quick hack to keep it running, like running Phoenix in the background or manually deploying releases.</p><blockquote class="ma mb mc"><p id="7d68" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">I’m begging you though to stay with me and not try to take a shortcut, because you’ll end up wasting a lot of time fiddling with things. You’ll have to manually start and stop the system, think about database migrations, and you won’t get zero downtime deployments. It’s brittle and if the server ever restarts for required maintenance, your app won’t come back up by itself.</p></blockquote><p id="94b6" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">We’re going to use a simple but powerful tool as the main way to automate and streamline most of the deployment process: a lowly bash script. On the server, <code class="gg nv nw nx ny b">cd</code> to your home directory (<code class="gg nv nw nx ny b">cd ~/</code> or even just <code class="gg nv nw nx ny b">cd</code>), and then create a <code class="gg nv nw nx ny b">deploy.sh</code> file:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="f7bc" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">vim deploy.sh</span></pre><blockquote class="ma mb mc"><p id="bd80" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">We’ll build this file section by section to explain what’s going on, and then I’ll drop the full thing at the end so it’s easy to copy, paste, and modify.</p></blockquote><p id="6151" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">First, we’ll add a <a class="au jr" href="https://linuxize.com/post/bash-shebang/" rel="noopener ugc nofollow" target="_blank">shebang</a> and<a class="au jr" href="https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html" rel="noopener ugc nofollow" target="_blank"> the </a><code class="gg nv nw nx ny b"><a class="au jr" href="https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html" rel="noopener ugc nofollow" target="_blank">set -e</a></code><a class="au jr" href="https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html" rel="noopener ugc nofollow" target="_blank"> directive</a>. The shebang tells the system to use the <code class="gg nv nw nx ny b">bash</code> language to process the script, and the <code class="gg nv nw nx ny b">set -e</code> directive tells the script to immediately exit if any of the commands in it fail (return a non-zero status).</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="5428" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">#!/bin/bash<br>set<strong class="ny ih"> </strong>-e</span></pre><p id="613b" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Next, we’re going to add commands to navigate to the app project, get the latest version, and make sure dependencies are up to date:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="f8d1" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph=""># Update to latest version of code<br>cd /home/&lt;YOUR_USERNAME&gt;/optimized_nginx<br>git fetch<br>git reset --hard origin/master<br>MIX_ENV=prod mix deps.get</span></pre><p id="af84" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Next, we’ll add a couple of optional CI steps, like running tests or enforcing code style with <a class="au jr" href="https://github.com/rrrene/credo" rel="noopener ugc nofollow" target="_blank">Credo</a>. Even though it makes the build process a little slower, we’ll include the tests at least to make sure we can’t deploy code that’s breaking tests:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="b6ac" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph=""># Optional CI steps<br>mix test<br># mix credo --strict (credo is not in example repo, commented out)</span></pre><p id="41e2" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">We’ve got a little problem though: with our secure database password in place on the server, <code class="gg nv nw nx ny b">mix test</code> will fail because it won’t be able to connect. To fix this, let’s update the <code class="gg nv nw nx ny b">mix test</code> line to say <code class="gg nv nw nx ny b">CI=true mix test</code>, and then save and quit so we can get out of the server and back to our local environment. We need to make a couple of code changes locally to support running tests on the server with the prod DB password. First, we’ll create a file <code class="gg nv nw nx ny b">config/test.secret.exs</code> with the following content:</p><figure class="nz oa ob oc fy jh"><div class="m op l do"><div class="oq or l"></div></div></figure><p id="2c7a" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Use <code class="gg nv nw nx ny b">scp</code> to copy the <code class="gg nv nw nx ny b">test.secret.exs</code> file up to the server like we did with the prod secrets file in step 11.</p><blockquote class="ma mb mc"><p id="57ee" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">If you’re using the example repo, this next code change has already been made so you can skip the next three paragraphs and get back to editing <code class="gg nv nw nx ny b"><em class="ig">deploy.sh</em></code>.</p></blockquote><p id="6ae1" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Otherwise, in your <code class="gg nv nw nx ny b">config/test.exs</code> file, put the following at the very bottom, so that it pulls in the secret file only if the <code class="gg nv nw nx ny b">CI</code> environment variable exists (like it does when the deploy script runs <code class="gg nv nw nx ny b">CI=true mix test</code>):</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="933a" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">if System.get_env("CI") do<br>  import_config "test.secret.exs"<br>end</span></pre><p id="c776" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Commit and push the change locally, and then get back on the server with <code class="gg nv nw nx ny b">ssh my_app</code>. You’ll need to run <code class="gg nv nw nx ny b">git pull</code> in the <code class="gg nv nw nx ny b">optimized_nginx</code> directory to get the change.</p><blockquote class="ma mb mc"><p id="af3f" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">Alright, run <code class="gg nv nw nx ny b"><em class="ig">vim deploy.sh</em></code> in the home directory on the server and we’ll keep going.</p></blockquote><p id="7f2d" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Next, we’ll add instructions to compile the app and static assets, setting the <code class="gg nv nw nx ny b">MIX_ENV</code> variable to <code class="gg nv nw nx ny b">prod</code> so we don’t have to specify it on the rest of the mix commands in the script:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="1bd0" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph=""># Build phase<br>export MIX_ENV=prod<br>mix compile<br>npm install --prefix ./assets<br>npm run deploy --prefix ./assets<br>mix phx.digest</span></pre><p id="af1b" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Next, the script will create the release, and place it in a folder named with the current time in unix. That way, each release will be timestamped which makes it easier for us to have an automated rollback script:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="59e3" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph=""># Create release<br>now_in_unix_seconds=$(date +'%s')<br>mix release --path ../releases/${now_in_unix_seconds}</span></pre><p id="991a" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Next, the script will replace some text in a file (that we’ll create in a minute) called <code class="gg nv nw nx ny b">env_vars</code> that will store the latest release name. In the next section, we’ll be writing a <code class="gg nv nw nx ny b">systemd</code> service responsible for starting and stopping our app, and it will look in this <code class="gg nv nw nx ny b">env_vars</code> file to know which release to boot up. Let’s add instructions to replace the <code class="gg nv nw nx ny b">LATEST_RELEASE</code> value in <code class="gg nv nw nx ny b">env_vars</code> using <code class="gg nv nw nx ny b">sed</code>:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="e5b3" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph=""># Update env var file with latest release name<br>sed -i 's/LATEST_RELEASE=.*/LATEST_RELEASE='$now_in_unix_seconds'/g' ../env_vars</span></pre><p id="d32a" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Next, we’ll grab the current value of the <code class="gg nv nw nx ny b">PORT</code> , which is the port number the currently running app is using, and then deduce which port is available (either <code class="gg nv nw nx ny b">4000</code> or <code class="gg nv nw nx ny b">4001</code>):</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="55b9" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph=""># Find the port in use, and the available port<br>if $(curl --output /dev/null --silent --head --fail localhost:4000)<br>then<br>  port_in_use=4000<br>  open_port=4001<br>else<br>  port_in_use=4001<br>  open_port=4000<br>fi</span></pre><p id="a69e" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Next, we need to update the <code class="gg nv nw nx ny b">env.sh</code> file located deep in the folder structure of the release. When the release boots, any calls to <code class="gg nv nw nx ny b">System.get_env</code> and similar won’t find the variables set in the shell like they normally would if you started the app with <code class="gg nv nw nx ny b">mix phx.server</code>, so we can’t just say <code class="gg nv nw nx ny b">PORT=4001 bin/my_app start</code> because it won’t pick up the <code class="gg nv nw nx ny b">PORT</code> variable. But, if we <a class="au jr" href="https://linuxize.com/post/bash-append-to-file/" rel="noopener ugc nofollow" target="_blank">shovel</a> the environment variables into the <code class="gg nv nw nx ny b">&lt;release_name&gt;/releases/&lt;version_number&gt;/env.sh</code> file, the release will pick them up when it starts:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="6f4a" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph=""># Put env vars with new port and set non-conflicting node name<br>echo "export PORT=${open_port}" &gt;&gt; ../releases/${now_in_unix_seconds}/releases/0.1.0/env.sh</span><span id="fc1a" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph="">echo "export RELEASE_NAME=${open_port}" &gt;&gt; ../releases/${now_in_unix_seconds}/releases/0.1.0/env.sh</span></pre><blockquote class="ma mb mc"><p id="2f18" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">In the section above, we’re also setting a <code class="gg nv nw nx ny b"><em class="ig">RELEASE_NAME</em></code> environment variable which sets the name of the node when Erlang boots up. We can’t have two nodes with the same name running simultaneously, so we just set the node name to the same value as the open port to avoid conflicts.</p></blockquote><p id="5d9b" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Next, the script will use <code class="gg nv nw nx ny b">systemctl</code> to start the app on the open port, and then it will use <code class="gg nv nw nx ny b">curl</code> to ping the port every second till it’s alive before the script will continue:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="7564" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph=""># Start app on open port<br>sudo systemctl start my_app@${open_port}</span><span id="0ee8" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph=""># Pause script till app is fully up<br>until $(curl --output /dev/null --silent --head --fail localhost:$open_port); do<br>  printf 'Waiting for app to boot...\n'<br>  sleep 1<br>done</span></pre><p id="7aad" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Next, the script will run the database migrations:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="cb4d" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph=""># Run migrations<br>mix ecto.migrate</span></pre><p id="03dc" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Finally, the script will clean up a bit by telling Nginx to start routing requests to the new port, and then it will stop the old version of the app. It all happens gracefully — requests in flight will finish before the old version is fully down:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="9ebc" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph=""># Update Nginx config to direct requests to app on open port<br>sudo sed -i 's/server 127\.0\.0\.1\:.*/server 127.0.0.1:'$open_port\;'/g' /etc/nginx/sites-available/default</span><span id="6e47" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph=""># Reload Nginx so it gracefully starts routing to new app version<br>sudo systemctl reload nginx</span><span id="36dc" class="gh js jt ig ny b dm oj ok ol om on oh l oi" data-selectable-paragraph=""># Stop previous version of app<br>sudo systemctl stop my_app@${port_in_use}</span></pre><p id="d525" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Whew, we made it!! Lots of command line tools in there like <code class="gg nv nw nx ny b">sed</code>, controlling <code class="gg nv nw nx ny b">systemd</code> services with <code class="gg nv nw nx ny b">systemctl</code>, and some <code class="gg nv nw nx ny b">bash</code> concepts like variables and conditionals. Read more about <code class="gg nv nw nx ny b">sed</code> <a class="au jr" href="https://linuxize.com/post/how-to-use-sed-to-find-and-replace-string-in-files/" rel="noopener ugc nofollow" target="_blank">here</a>, <code class="gg nv nw nx ny b">systemd</code> <a class="au jr" href="https://www.digitalocean.com/community/tutorials/how-to-use-systemctl-to-manage-systemd-services-and-units" rel="noopener ugc nofollow" target="_blank">here</a>, and <code class="gg nv nw nx ny b">bash</code> scripts <a class="au jr" href="https://ryanstutorials.net/bash-scripting-tutorial/bash-variables.php" rel="noopener ugc nofollow" target="_blank">here</a> if you want to get a little more context on these tools. Here’s the file all together:</p><figure class="nz oa ob oc fy jh"><div class="m op l do"><div class="oq or l"></div></div></figure><blockquote class="ma mb mc"><p id="c322" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">This file might feel long or intimidating, but there’s a lot of power and flexibility in the approach. By using a single script to deploy, you’ll know exactly where to go if you want to add any custom steps or adjust things. Want to add more robust logic so that if the app doesn’t start up within some number of seconds, it kills the deploy? Just tweak the pause section. Want to add some static analysis? Great, add it to the CI section. Want to run it without migrations or without tests/CI? Just make a copy with a different name, take out the sections that don’t need to run and voilá! You’re working with the raw tools, so you won’t need to learn a framework or hack around constraints when you do need something custom.</p></blockquote><p id="d14f" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Save and quit, then make the file executable:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="9d3b" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">chmod u+x deploy.sh</span></pre><p id="5336" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">And one last thing, let’s create the <code class="gg nv nw nx ny b">env_vars</code> file that our script references, and populate it with initial data. Run <code class="gg nv nw nx ny b">vim env_vars</code> and put the following in it:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="e69a" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">LATEST_RELEASE=</span></pre><h2 id="d6a3" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">15 — Create systemd services</h2><p id="4c6e" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">Before we can actually run our deploy script, we need to create a <code class="gg nv nw nx ny b">systemd</code> service that starts up the app (basically, to run <code class="gg nv nw nx ny b">&lt;release_name&gt;/bin/my_app start</code>). <code class="gg nv nw nx ny b">deploy.sh</code> expects this service to be available — it calls it when it says <code class="gg nv nw nx ny b">sudo systemctl start my_app@${open_port}</code>.</p><p id="d7fb" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">The reason we need a <code class="gg nv nw nx ny b">systemd</code> service to run that command, instead of just having the deploy script run it, is so that if the app ever exits unexpectedly (for example, if your app runs out of memory or atoms and the BEAM crashes), <code class="gg nv nw nx ny b">systemd</code> will notice and boot the app again in a clean state.</p><blockquote class="ma mb mc"><p id="3e7b" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">Within your Elixir app, you have a supervision tree to manage and monitor when processes crash and reset them — you can think about <code class="gg nv nw nx ny b"><em class="ig">systemd</em></code> like it’s the supervisor for your supervision tree.</p></blockquote><p id="2d41" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">There’s another bonus — by having a <code class="gg nv nw nx ny b">systemd</code> service start the app, the logs that the app produces will be piped out to <code class="gg nv nw nx ny b">journald</code> automatically, which makes it easy to attach to the stream when you want to and it’s also a very standard log interface so it’s easy to connect to third-party logging services.</p><p id="c113" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Let’s go ahead and create a new <code class="gg nv nw nx ny b">systemd</code> service:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="8a93" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo vim /etc/systemd/system/my_app@.service</span></pre><p id="8458" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Add the following contents:</p><figure class="nz oa ob oc fy jh"><div class="m op l do"><div class="oq or l"></div></div></figure><p id="3b48" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">The most significant lines for us are 12 and 14. First, we pull in the <code class="gg nv nw nx ny b">env_vars</code> file we created in the last step, which tells the service what folder the latest release is in, and then on line 14 we actually <code class="gg nv nw nx ny b">start</code> the release.</p><blockquote class="ma mb mc"><p id="efe7" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">The name of this service file is important: adding the <code class="gg nv nw nx ny b"><em class="ig">@</em></code> makes it a “template”, which means that we can run it multiple times with different values after the <code class="gg nv nw nx ny b"><em class="ig">@</em></code> which in our case will be <code class="gg nv nw nx ny b"><em class="ig">4000</em></code> and <code class="gg nv nw nx ny b"><em class="ig">4001</em></code>. This enables us to have two instances of the app running at the same time so that Nginx can gracefully switch routing requests from one to the other, before the old one is shut down. You can read more about running multiple instances of a <code class="gg nv nw nx ny b"><em class="ig">systemd</em></code> service <a class="au jr" href="https://www.stevenrombauts.be/2019/01/run-multiple-instances-of-the-same-systemd-unit/" rel="noopener ugc nofollow" target="_blank">here</a>.</p></blockquote><p id="b176" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">We’re going to create one more <code class="gg nv nw nx ny b">systemd</code> service, which will be responsible for running our deploy script automatically (which will bring the app back online) if the server ever restarts unexpectedly. The file for this one is smaller because it doesn’t have to deal with monitoring and restarting the app if it goes down. Run <code class="gg nv nw nx ny b">sudo vim /etc/systemd/system/my_app_start_on_boot.service</code> and add the following contents:</p><figure class="nz oa ob oc fy jh"><div class="m op l do"><div class="oq or l"></div></div></figure><p id="00ee" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Now, let’s <a class="au jr" href="https://www.linode.com/docs/guides/start-service-at-boot/" rel="noopener ugc nofollow" target="_blank">enable the service</a> so that it knows to run when the server boots:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="c708" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo systemctl enable my_app_start_on_boot</span></pre><p id="9e4e" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">One last thing before we’re done here: we need a way for our app to know at <em class="md">runtime</em> which port to use, but at the point in our deploy script where the available port is discovered, the release has already been built and all of the config has been set at <em class="md">compile</em> time. <a class="au jr" href="https://hexdocs.pm/mix/Mix.Tasks.Release.html#module-runtime-configuration" rel="noopener ugc nofollow" target="_blank">Release runtime configuration</a> to the rescue! If you’re using the example app, you’ll already have this file so feel free to skip to the next step. Otherwise, locally in your project, create the file <code class="gg nv nw nx ny b">config/releases.exs</code>:</p><figure class="nz oa ob oc fy jh"><div class="m op l do"><div class="oq or l"></div></div></figure><p id="2f90" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Commit and push that change so it’s available on your server as well.</p><h2 id="53c3" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">16 — Deploy the app</h2><p id="99cb" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">We’ve come a long way and done a lot of work! We’re finally ready for that sweet sweet payout: running the deploy script and watching the app come to life.</p><blockquote class="ma mb mc"><p id="1b03" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">One of the cool things about <code class="gg nv nw nx ny b"><em class="ig">ssh</em></code> is that you can use it to run a command in your local terminal, but have it execute on the server. Let’s do that. In your local terminal, run the following command:</p></blockquote><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="f95a" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">ssh my_app ./deploy.sh</span></pre><p id="9f3d" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">You’ll see some output as the script works through the various build, CI, release, and booting steps. If all goes well, you should be able to visit <code class="gg nv nw nx ny b">https://&lt;your_domain&gt;.com</code> and see the app running!</p><blockquote class="ll"><p id="b977" class="lm ln ig bm lo lp lq lr ls lt lu lk cn" data-selectable-paragraph="">To really see the magic, commit and push a change locally and then run the command again, and you’ll see it gracefully swap over to the new version without any downtime 🎉🎉🎉.</p></blockquote><p id="caa8" class="pw-post-body-paragraph kq kr ig ks b kt lv kv kw kx lw kz la kd lx lc ld kh ly lf lg kl lz li lj lk hz gh" data-selectable-paragraph="">If you used the example app, you can now visit <code class="gg nv nw nx ny b">https://&lt;your_domain&gt;.com/dashboard/home</code> to see the live dashboard. You might notice some janky stuff with the websockets, which you can resolve by updating your <code class="gg nv nw nx ny b">config/prod.exs</code> file where it references <code class="gg nv nw nx ny b">"example.com"</code> to <code class="gg nv nw nx ny b">"&lt;your_domain&gt;.com"</code>. Push that update, deploy again, and it should stabilize.</p><h2 id="393a" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">17 — Attach to journald to watch logs, and configure to trim</h2><p id="dc6e" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">Logs aren’t the most exciting part of building an app, but you’ll be grateful for them when you’re troubleshooting tough bugs. Because the deploy script uses a <code class="gg nv nw nx ny b">systemd</code> service to actually run the command to start the release, standard output is routed to <code class="gg nv nw nx ny b">journald</code> which stores the logs.</p><blockquote class="ma mb mc"><p id="3ced" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">Just like we used <code class="gg nv nw nx ny b"><em class="ig">systemctl</em></code> to start and stop <code class="gg nv nw nx ny b"><em class="ig">systemd</em></code> services, we use a utility called <code class="gg nv nw nx ny b"><em class="ig">journalctl</em></code> to query and manipulate <code class="gg nv nw nx ny b"><em class="ig">journald</em></code> logs. If you want a deep dive, you can read up <a class="au jr" href="https://www.loggly.com/ultimate-guide/using-journalctl/" rel="noopener ugc nofollow" target="_blank">here</a>, <a class="au jr" href="https://sematext.com/blog/journald-logging-tutorial/" rel="noopener ugc nofollow" target="_blank">here</a>, or <a class="au jr" href="https://www.digitalocean.com/community/tutorials/how-to-use-journalctl-to-view-and-manipulate-systemd-logs" rel="noopener ugc nofollow" target="_blank">here</a>. I’ll just show you a couple of useful commands, to help you get a window into your logs as the app is running in real time, but <code class="gg nv nw nx ny b"><em class="ig">journalctl</em></code> supports a wide variety of querying for more advanced uses.</p></blockquote><p id="8ee8" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">To attach to the journal and “follow” it (basically, as logs come in you see them update in real time), run the following command locally:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="8bf5" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">ssh my_app journalctl -f</span></pre><p id="1e16" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Now, if you visit <code class="gg nv nw nx ny b">&lt;your_domain&gt;.com</code> a few times, you’ll see some logs show up in your terminal. Sweet!</p><p id="2036" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">You can also print out the most recent <code class="gg nv nw nx ny b">n</code> logs, with the following command:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="4617" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">ssh my_app journalctl -n 500</span></pre><p id="7baf" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">You may see some logs in there that don’t have to do with your app — to limit it to just your app you can run this:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="9e24" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">ssh my_app journalctl -n 50 -u my_app@4001</span></pre><p id="0106" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Adding the <code class="gg nv nw nx ny b">-u my_app@&lt;4000 or 4001&gt;</code> limits it to just that “unit”. Your app will always be running on either 4000 or 4001, so if the most recent log for the port you picked looks like the following, try the other one to see the output for the running app.</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="ad82" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">Nov 03 21:43:33 instance-1 systemd[1]: Stopped My App.</span></pre><p id="1ed2" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">One more thing before we stop talking about logs: let’s update the <code class="gg nv nw nx ny b">journald</code> config so that it starts trimming logs at 4GB so that logs don’t eventually consume all available disk space. <code class="gg nv nw nx ny b">ssh my_app</code> to get on the server, then run <code class="gg nv nw nx ny b">sudo vim /etc/systemd/journald.conf</code> to edit the config file. Find the line that has <code class="gg nv nw nx ny b">SystemMaxUse</code>, uncomment it, and add <code class="gg nv nw nx ny b">4G</code> to the end like this:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="628e" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">SystemMaxUse=4G</span></pre><p id="e337" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Save and quit, and then restart <code class="gg nv nw nx ny b">journald</code> like this:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="0829" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo systemctl restart systemd-journald.service</span></pre><h1 id="248e" class="ne jt ig bm ju nf ng nh jy ni nj nk kc nl nm nn kg no np nq kk nr ns nt ko nu gh" data-selectable-paragraph="">You made it! 🙌</h1><p id="d9f0" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">Congratulations, you’re now armed with a fully loaded Phoenix app running on free hardware without the compromises. You can deploy new versions of your code with a single command, achieve zero-downtime deploys without hot code reloading, and tap into the database and logs from your development machine with ease.</p><p id="b650" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">I’ve included a few bonus sections if any of them spark your interest. Thanks for reading, and please reach out to me at damonvjanis@gmail.com if you have any questions or comments.</p><blockquote class="ma mb mc"><p id="125d" class="kq kr md ks b kt me kv kw kx mf kz la mg mh lc ld mi mj lf lg mk ml li lj lk hz gh" data-selectable-paragraph="">If any Elixir wizards want to see if you can figure out how to achieve zero-downtime deploys on a single server without hot code reloading, but also without depending on Nginx, I would love to highlight it! It would also be cool if someone could figure out a more pure Elixir way of starting the release without <code class="gg nv nw nx ny b"><em class="ig">systemd</em></code> but keeping the ability to restart on crash, and easy access to attaching to the logs of the app.</p></blockquote><p id="5e51" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">UPDATE: Ruslan Kenzhebekov emailed me and pointed me to a comment thread he’d had with Sasa Juric (the author of the Site Encrypt library) where Sasa mentioned that he used <code class="gg nv nw nx ny b">iptables</code> switching to achieve zero-downtime deployments without nginx or a reverse proxy. That prompted me to learn (a lot!) and update the <a class="au jr" rel="noopener" href="https://damonvjanis.medium.com/optimizing-for-free-hosting-elixir-deployments-6bfc119a1f44">original article</a> as a result.</p><h2 id="752e" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">Bonus 1: secure your data against the possibility of eventual hardware failure by creating another Google account with a free instance and set up automated backups using cron</h2><p id="ce9b" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">I’m not going to go into exhaustive detail here, and this is not a sophisticated approach, but it can be a starting point.</p><p id="d629" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Follow steps 1–5 of the guide again but with a new Google account, and instead of <code class="gg nv nw nx ny b">my_app</code> name your alias something like <code class="gg nv nw nx ny b">backups</code>. Now that you’ve got your server up and running and you can connect to it, install Postgres:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="86ca" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">sudo apt install postgresql postgresql-contrib</span></pre><p id="484c" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Now hit <code class="gg nv nw nx ny b">cd</code> to make sure you’re in the home directory, and enter <code class="gg nv nw nx ny b">vim .pgpass</code> to create a password file for Postgres. Put the following contents in it, using the values from the server you set up for <code class="gg nv nw nx ny b">my_app</code>:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="48c9" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">#hostname:port:database:username:password<br>&lt;server IP address&gt;:5432:my_app:postgres:&lt;postgres password&gt;</span></pre><p id="5ca9" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Now hit <code class="gg nv nw nx ny b">chmod 600 .pgpass</code> to give the file correct permissions.</p><p id="e095" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Open the <code class="gg nv nw nx ny b">cron</code> configuration file by running <code class="gg nv nw nx ny b">crontab -e</code>, then at the bottom of the file add the following:</p><figure class="nz oa ob oc fy jh"><div class="m op l do"><div class="oq or l"></div></div></figure><p id="5228" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">To make sure that it actually works, instead of waiting an hour for it to run, try running the <code class="gg nv nw nx ny b">pg_dump</code> task like in the file:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="a59b" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">pg_dump -U postgres -h &lt;server IP address&gt; -p 5432 my_app &gt; ~/my_app/my_app_hourly.bak</span></pre><p id="27e7" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">If all goes well, you should see a new folder <code class="gg nv nw nx ny b">my_app/</code> with a backup inside. Sweet!</p><p id="bf08" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">You can learn more about <code class="gg nv nw nx ny b">cron</code> <a class="au jr" href="https://phoenixnap.com/kb/set-up-cron-job-linux" rel="noopener ugc nofollow" target="_blank">here</a>.</p><h2 id="11a1" class="js jt ig bm ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp gh" data-selectable-paragraph="">Bonus 2: Rollback script</h2><p id="4bd5" class="pw-post-body-paragraph kq kr ig ks b kt ku kv kw kx ky kz la kd lb lc ld kh le lf lg kl lh li lj lk hz gh" data-selectable-paragraph="">Here’s a rollback script I wrote, you can put it in your home directory next to <code class="gg nv nw nx ny b">deploy.sh</code> and run it the same way: <code class="gg nv nw nx ny b">ssh my_app ./rollback.sh</code>.</p><figure class="nz oa ob oc fy jh"><div class="m op l do"><div class="oq or l"></div></div></figure><p id="bda5" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Save and quit, then make the file executable:</p><pre class="nz oa ob oc fy od bs oe of dz ny"><span id="6211" class="gh js jt ig ny b dm og oh l oi" data-selectable-paragraph="">chmod u+x rollback.sh</span></pre><p id="a1b1" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">Note: you’ll need to handle rolling back database migrations manually, by running <code class="gg nv nw nx ny b">MIX_ENV=prod mix ecto.rollback</code> within the app directory on the server, if you need to roll back a migration.</p><p id="c592" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">The script will boot up the previous release, and if you need to go back more than one just keep running the script. It’s fast — it only takes a few seconds before the last release is the one running in prod!</p><p id="28e3" class="pw-post-body-paragraph kq kr ig ks b kt me kv kw kx mf kz la kd mh lc ld kh mj lf lg kl ml li lj lk hz gh" data-selectable-paragraph="">And that’s a wrap! Thanks for reading 🙏</p></div></div></section></div></div></article><div class="os o"></div></div></div><div></div><div class="db we xz o dx ya yb"><div class="yc dz uw yd ye o ao c"><div class="o ao gj"><div class="pw-multi-vote-icon do pe pf pg ph"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F911730f84d3b&amp;operation=register&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b&amp;user=Damon+Janis&amp;userId=43709c76c449&amp;source=-----911730f84d3b---------------------clap_footer-----------" rel="noopener follow"><div class="dr qb de yf qd pm bb pn po pp ph"><svg width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.37.83L12 3.28l.63-2.45h-1.26zM13.92 3.95l1.52-2.1-1.18-.4-.34 2.5zM8.59 1.84l1.52 2.11-.34-2.5-1.18.4zM18.52 18.92a4.23 4.23 0 0 1-2.62 1.33l.41-.37c2.39-2.4 2.86-4.95 1.4-7.63l-.91-1.6-.8-1.67c-.25-.56-.19-.98.21-1.29a.7.7 0 0 1 .55-.13c.28.05.54.23.72.5l2.37 4.16c.97 1.62 1.14 4.23-1.33 6.7zm-11-.44l-4.15-4.15a.83.83 0 0 1 1.17-1.17l2.16 2.16a.37.37 0 0 0 .51-.52l-2.15-2.16L3.6 11.2a.83.83 0 0 1 1.17-1.17l3.43 3.44a.36.36 0 0 0 .52 0 .36.36 0 0 0 0-.52L5.29 9.51l-.97-.97a.83.83 0 0 1 0-1.16.84.84 0 0 1 1.17 0l.97.97 3.44 3.43a.36.36 0 0 0 .51 0 .37.37 0 0 0 0-.52L6.98 7.83a.82.82 0 0 1-.18-.9.82.82 0 0 1 .76-.51c.22 0 .43.09.58.24l5.8 5.79a.37.37 0 0 0 .58-.42L13.4 9.67c-.26-.56-.2-.98.2-1.29a.7.7 0 0 1 .55-.13c.28.05.55.23.73.5l2.2 3.86c1.3 2.38.87 4.59-1.29 6.75a4.65 4.65 0 0 1-4.19 1.37 7.73 7.73 0 0 1-4.07-2.25zm3.23-12.5l2.12 2.11c-.41.5-.47 1.17-.13 1.9l.22.46-3.52-3.53a.81.81 0 0 1-.1-.36c0-.23.09-.43.24-.59a.85.85 0 0 1 1.17 0zm7.36 1.7a1.86 1.86 0 0 0-1.23-.84 1.44 1.44 0 0 0-1.12.27c-.3.24-.5.55-.58.89-.25-.25-.57-.4-.91-.47-.28-.04-.56 0-.82.1l-2.18-2.18a1.56 1.56 0 0 0-2.2 0c-.2.2-.33.44-.4.7a1.56 1.56 0 0 0-2.63.75 1.6 1.6 0 0 0-2.23-.04 1.56 1.56 0 0 0 0 2.2c-.24.1-.5.24-.72.45a1.56 1.56 0 0 0 0 2.2l.52.52a1.56 1.56 0 0 0-.75 2.61L7 19a8.46 8.46 0 0 0 4.48 2.45 5.18 5.18 0 0 0 3.36-.5 4.89 4.89 0 0 0 4.2-1.51c2.75-2.77 2.54-5.74 1.43-7.59L18.1 7.68z"></path></svg></div></a></span></div><div class="pw-multi-vote-count l pq pr ps pt pu pv pw"><div><div class="ci" aria-hidden="false" aria-describedby="189" aria-labelledby="189"><p class="bm b gp bo cn"><button class="au av aw ax ay az ba bb bc bd yj bf bg bh bi yk">63<span class="l h g f px py"></span></button></p></div></div></div></div><div class="yg yh yi l"></div><div><div class="ci" aria-hidden="false" aria-describedby="145" aria-labelledby="145"><button class="qb dr qc o ao de qd qe" aria-label="responses"><svg width="24" height="24" viewBox="0 0 24 24" aria-label="responses" class=""><path d="M18 16.8a7.14 7.14 0 0 0 2.24-5.32c0-4.12-3.53-7.48-8.05-7.48C7.67 4 4 7.36 4 11.48c0 4.13 3.67 7.48 8.2 7.48a8.9 8.9 0 0 0 2.38-.32c.23.2.48.39.75.56 1.06.69 2.2 1.04 3.4 1.04.22 0 .4-.11.48-.29a.5.5 0 0 0-.04-.52 6.4 6.4 0 0 1-1.16-2.65v.02zm-3.12 1.06l-.06-.22-.32.1a8 8 0 0 1-2.3.33c-4.03 0-7.3-2.96-7.3-6.59S8.17 4.9 12.2 4.9c4 0 7.1 2.96 7.1 6.6 0 1.8-.6 3.47-2.02 4.72l-.2.16v.26l.02.3a6.74 6.74 0 0 0 .88 2.4 5.27 5.27 0 0 1-2.17-.86c-.28-.17-.72-.38-.94-.59l.01-.02z"></path></svg></button></div></div></div></div><div class="l"></div><footer class="ot ou ov ow o ao ox oy c"><div class="l oz"><div class="o dx"><div class="em ce ey ez fa fb fc fd fe ff fg"><div class="o u pa"><div class="o ao gj"><div class="pb l"><span class="l gl pc pd e d"><div class="o ao gj"><div class="pw-multi-vote-icon do pe pf pg ph"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F911730f84d3b&amp;operation=register&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b&amp;user=Damon+Janis&amp;userId=43709c76c449&amp;source=-----911730f84d3b---------------------clap_footer-----------" rel="noopener follow"><div class="dr qb de yf qd pm bb pn po pp ph"><svg width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.37.83L12 3.28l.63-2.45h-1.26zM13.92 3.95l1.52-2.1-1.18-.4-.34 2.5zM8.59 1.84l1.52 2.11-.34-2.5-1.18.4zM18.52 18.92a4.23 4.23 0 0 1-2.62 1.33l.41-.37c2.39-2.4 2.86-4.95 1.4-7.63l-.91-1.6-.8-1.67c-.25-.56-.19-.98.21-1.29a.7.7 0 0 1 .55-.13c.28.05.54.23.72.5l2.37 4.16c.97 1.62 1.14 4.23-1.33 6.7zm-11-.44l-4.15-4.15a.83.83 0 0 1 1.17-1.17l2.16 2.16a.37.37 0 0 0 .51-.52l-2.15-2.16L3.6 11.2a.83.83 0 0 1 1.17-1.17l3.43 3.44a.36.36 0 0 0 .52 0 .36.36 0 0 0 0-.52L5.29 9.51l-.97-.97a.83.83 0 0 1 0-1.16.84.84 0 0 1 1.17 0l.97.97 3.44 3.43a.36.36 0 0 0 .51 0 .37.37 0 0 0 0-.52L6.98 7.83a.82.82 0 0 1-.18-.9.82.82 0 0 1 .76-.51c.22 0 .43.09.58.24l5.8 5.79a.37.37 0 0 0 .58-.42L13.4 9.67c-.26-.56-.2-.98.2-1.29a.7.7 0 0 1 .55-.13c.28.05.55.23.73.5l2.2 3.86c1.3 2.38.87 4.59-1.29 6.75a4.65 4.65 0 0 1-4.19 1.37 7.73 7.73 0 0 1-4.07-2.25zm3.23-12.5l2.12 2.11c-.41.5-.47 1.17-.13 1.9l.22.46-3.52-3.53a.81.81 0 0 1-.1-.36c0-.23.09-.43.24-.59a.85.85 0 0 1 1.17 0zm7.36 1.7a1.86 1.86 0 0 0-1.23-.84 1.44 1.44 0 0 0-1.12.27c-.3.24-.5.55-.58.89-.25-.25-.57-.4-.91-.47-.28-.04-.56 0-.82.1l-2.18-2.18a1.56 1.56 0 0 0-2.2 0c-.2.2-.33.44-.4.7a1.56 1.56 0 0 0-2.63.75 1.6 1.6 0 0 0-2.23-.04 1.56 1.56 0 0 0 0 2.2c-.24.1-.5.24-.72.45a1.56 1.56 0 0 0 0 2.2l.52.52a1.56 1.56 0 0 0-.75 2.61L7 19a8.46 8.46 0 0 0 4.48 2.45 5.18 5.18 0 0 0 3.36-.5 4.89 4.89 0 0 0 4.2-1.51c2.75-2.77 2.54-5.74 1.43-7.59L18.1 7.68z"></path></svg></div></a></span></div><div class="pw-multi-vote-count l pq pr ps pt pu pv pw"><div><div class="ci" aria-hidden="false" aria-describedby="146" aria-labelledby="146"><p class="bm b gp bo cn"><button class="au av aw ax ay az ba bb bc bd yj bf bg bh bi yk">63<span class="l h g f px py"></span></button></p></div></div></div></div></span><span class="l h g f px py"><div class="o ao gj"><div class="pw-multi-vote-icon do pe pf pg ph"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F911730f84d3b&amp;operation=register&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b&amp;user=Damon+Janis&amp;userId=43709c76c449&amp;source=-----911730f84d3b---------------------clap_footer-----------" rel="noopener follow"><div class="dr qb de yf qd pm bb pn po pp ph"><svg width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.37.83L12 3.28l.63-2.45h-1.26zM13.92 3.95l1.52-2.1-1.18-.4-.34 2.5zM8.59 1.84l1.52 2.11-.34-2.5-1.18.4zM18.52 18.92a4.23 4.23 0 0 1-2.62 1.33l.41-.37c2.39-2.4 2.86-4.95 1.4-7.63l-.91-1.6-.8-1.67c-.25-.56-.19-.98.21-1.29a.7.7 0 0 1 .55-.13c.28.05.54.23.72.5l2.37 4.16c.97 1.62 1.14 4.23-1.33 6.7zm-11-.44l-4.15-4.15a.83.83 0 0 1 1.17-1.17l2.16 2.16a.37.37 0 0 0 .51-.52l-2.15-2.16L3.6 11.2a.83.83 0 0 1 1.17-1.17l3.43 3.44a.36.36 0 0 0 .52 0 .36.36 0 0 0 0-.52L5.29 9.51l-.97-.97a.83.83 0 0 1 0-1.16.84.84 0 0 1 1.17 0l.97.97 3.44 3.43a.36.36 0 0 0 .51 0 .37.37 0 0 0 0-.52L6.98 7.83a.82.82 0 0 1-.18-.9.82.82 0 0 1 .76-.51c.22 0 .43.09.58.24l5.8 5.79a.37.37 0 0 0 .58-.42L13.4 9.67c-.26-.56-.2-.98.2-1.29a.7.7 0 0 1 .55-.13c.28.05.55.23.73.5l2.2 3.86c1.3 2.38.87 4.59-1.29 6.75a4.65 4.65 0 0 1-4.19 1.37 7.73 7.73 0 0 1-4.07-2.25zm3.23-12.5l2.12 2.11c-.41.5-.47 1.17-.13 1.9l.22.46-3.52-3.53a.81.81 0 0 1-.1-.36c0-.23.09-.43.24-.59a.85.85 0 0 1 1.17 0zm7.36 1.7a1.86 1.86 0 0 0-1.23-.84 1.44 1.44 0 0 0-1.12.27c-.3.24-.5.55-.58.89-.25-.25-.57-.4-.91-.47-.28-.04-.56 0-.82.1l-2.18-2.18a1.56 1.56 0 0 0-2.2 0c-.2.2-.33.44-.4.7a1.56 1.56 0 0 0-2.63.75 1.6 1.6 0 0 0-2.23-.04 1.56 1.56 0 0 0 0 2.2c-.24.1-.5.24-.72.45a1.56 1.56 0 0 0 0 2.2l.52.52a1.56 1.56 0 0 0-.75 2.61L7 19a8.46 8.46 0 0 0 4.48 2.45 5.18 5.18 0 0 0 3.36-.5 4.89 4.89 0 0 0 4.2-1.51c2.75-2.77 2.54-5.74 1.43-7.59L18.1 7.68z"></path></svg></div></a></span></div><div class="pw-multi-vote-count l pq pr ps pt pu pv pw"><div><div class="ci" aria-hidden="false" aria-describedby="147" aria-labelledby="147"><p class="bm b gp bo cn"><button class="au av aw ax ay az ba bb bc bd yj bf bg bh bi yk">63</button></p></div></div></div></div></span></div><div class="pz o"><div><div class="ci" aria-hidden="false" aria-describedby="16" aria-labelledby="16"><button class="qb dr qc o ao de qd qe" aria-label="responses"><svg width="24" height="24" viewBox="0 0 24 24" aria-label="responses" class="qa"><path d="M18 16.8a7.14 7.14 0 0 0 2.24-5.32c0-4.12-3.53-7.48-8.05-7.48C7.67 4 4 7.36 4 11.48c0 4.13 3.67 7.48 8.2 7.48a8.9 8.9 0 0 0 2.38-.32c.23.2.48.39.75.56 1.06.69 2.2 1.04 3.4 1.04.22 0 .4-.11.48-.29a.5.5 0 0 0-.04-.52 6.4 6.4 0 0 1-1.16-2.65v.02zm-3.12 1.06l-.06-.22-.32.1a8 8 0 0 1-2.3.33c-4.03 0-7.3-2.96-7.3-6.59S8.17 4.9 12.2 4.9c4 0 7.1 2.96 7.1 6.6 0 1.8-.6 3.47-2.02 4.72l-.2.16v.26l.02.3a6.74 6.74 0 0 0 .88 2.4 5.27 5.27 0 0 1-2.17-.86c-.28-.17-.72-.38-.94-.59l.01-.02z"></path></svg></button></div></div></div></div><div class="o ao"><div class="ci" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="ci" aria-hidden="false" aria-describedby="17" aria-labelledby="17"><button class="au av aw ax ay az ba hh bc bd be bf bg bh bi qf hi qg" aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post"><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" d="M15.22 4.93a.42.42 0 0 1-.12.13h.01a.45.45 0 0 1-.29.08.52.52 0 0 1-.3-.13L12.5 3v7.07a.5.5 0 0 1-.5.5.5.5 0 0 1-.5-.5V3.02l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.8a.42.42 0 0 1 .07.5zm-.1.14zm.88 2h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11a2 2 0 0 1-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.14c.1.1.15.22.15.35a.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9V8.96c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1z" fill="#000"></path></svg></button></div></div></div><div class="qh l hg"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F911730f84d3b&amp;operation=register&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b&amp;source=--------------------------bookmark_footer-----------" rel="noopener follow"><button aria-controls="addToCatalogBookmarkButton" aria-expanded="false" aria-label="Add to list bookmark button" class="au de aw ax ay az ba hh bc qb xt xu xv"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="xs" aria-label="Add to list bookmark button"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="#292929"></path></svg></button></a></span></div></div></div></div></div></div></footer></div><div class="o dx"><div class="em ce ey ez fa fb fc fd fe ff fg"></div></div><div class="l"><div class="l qi pa"><div class="l pa"><div class="qj qk l qi"><div class="o dx"><div class="em ce ey ez fa fb fc fd fe ff fg"><div class="o ao u"><h2 class="bm ql jv jx qm jy jz kb qn kc kd kf qo kg kh kj qp kk kl kn qq ko op qr qs qt qu qv qw gh"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener follow" href="https://damonvjanis.medium.com/?source=post_page-----911730f84d3b--------------------------------">More from Damon Janis</a></h2><div class="qx o"><span><button class="bm b bn bo gq bq gs gt gu gv gw bd bz gx gy gz cd cf cg ch ci cj">Follow</button></span><div class="qx l"><div><div><div class="ci" aria-hidden="false" aria-describedby="175" aria-labelledby="175"><div class="l"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F415029f5502a&amp;operation=register&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b&amp;newsletterV3=43709c76c449&amp;newsletterV3Id=415029f5502a&amp;user=Damon+Janis&amp;userId=43709c76c449&amp;source=-----911730f84d3b---------------------subscribe_user-----------" rel="noopener follow"><button class="bm b bn bo gq bb gs gt gu gv gw bd bz gx gy gz cd cf cg ch ci cj" aria-label="Subscribe"><svg width="38" height="38" viewBox="0 0 38 38" fill="none" class="ym qz ra"><rect x="26.25" y="9.25" width="0.5" height="6.5" rx="0.25"></rect><rect x="29.75" y="12.25" width="0.5" height="6.5" rx="0.25" transform="rotate(90 29.75 12.25)"></rect><path d="M19.5 12.5h-7a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1v-5"></path><path d="M11.5 14.5L19 20l4-3"></path></svg></button></a></span></div></div></div></div></div></div></div><div class="rb wo l"><p class="bm b bn bo cn">Elixir dev building for the web with Phoenix</p></div></div></div></div></div><div class="rc l"><span><article><div class="fm fn ow l"><div class="o dx"><div class="em ce ey ez fa fb fc fd fe ff fg"><div class="ce ag"><div class="l"><div class="ao o"><div></div><div class="ce o yy"><div class="o"></div><div class="l hg"><span class="bm b bn bo cn"><div class="o ao"><a class="" rel="noopener follow" href="https://damonvjanis.medium.com/optimizing-for-free-hosting-elixir-deployments-6bfc119a1f44?source=post_page-----911730f84d3b----0----------------------------"><p class="bm b bn bo cn"><span>Nov 9, 2020</span></p></a></div></span></div></div></div><div class="vh l"><div class="l"><div class="l do"><div class="we"><div class="l"><div><div class="o"><div class="l en hz"><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Post Preview Title" rel="noopener follow" href="https://damonvjanis.medium.com/optimizing-for-free-hosting-elixir-deployments-6bfc119a1f44?source=post_page-----911730f84d3b----0----------------------------"><div class="zb zc zd ze zf l"><h2 class="bm ih jv jx zg zh jy jz kb zi zj kc nl nn zk zl kg no nq zm zn kk nr nt zo zp ko op qr qs qu qw gh">Optimizing for Free Hosting — Elixir Deployments</h2></div><div class="h k aj ak cu"><p class="ks b dm dn op zq qr qs tw qu qw if gh">Another way to deploy Elixir apps UPDATE: This article now uses an all-Elixir deployment strategy, instead of the Nginx reverse proxy strategy it had originally. UPDATE 2: If you followed this guide before August 19th, 2021, you’ll need to update the instance type of your Google Cloud server to keep it free. You have an “F1-micro”…</p></div></a></div><div class="zr zs zt zu zv l"><div class="o u"><div class="o ao oz"><div class="zw l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/tag/phoenix?source=post_page-----911730f84d3b---------------phoenix-----------------" rel="noopener follow"><div class="zx do gg zy zz aba bm b gp bo gh abb">Phoenix</div></a></div><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Post Preview Reading Time" rel="noopener follow" href="https://damonvjanis.medium.com/optimizing-for-free-hosting-elixir-deployments-6bfc119a1f44?source=post_page-----911730f84d3b----0----------------------------"><p class="bm b gp bo cn"><span>27 min read</span></p></a></div></div><div class="o"><div class="ga l"><div><div class="ci" aria-hidden="false" aria-describedby="190" aria-labelledby="190"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F6bfc119a1f44&amp;operation=register&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Foptimizing-for-free-hosting-elixir-deployments-6bfc119a1f44&amp;source=-----911730f84d3b----0-----------------bookmark_preview-----------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="xs"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="#292929"></path></svg></a></span></div></div></div></div></div></div></div><div class="abc abd abe abf abg l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Post Preview Image" rel="noopener follow" href="https://damonvjanis.medium.com/optimizing-for-free-hosting-elixir-deployments-6bfc119a1f44?source=post_page-----911730f84d3b----0----------------------------"><div class="h k aj ak cu"><img alt="Optimizing for Free Hosting — Elixir Deployments" class="" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_bVu7g4dHlgtGYO78RWMi9g(1).jpeg" width="112" height="112" loading="lazy"></div><div class="ah ai j i d"><img alt="Optimizing for Free Hosting — Elixir Deployments" class="" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_bVu7g4dHlgtGYO78RWMi9g(2).jpeg" width="56" height="56" loading="lazy"></div></a></div></div></div></div></div></div><div class="yz za vv or op"></div></div></div></div></div></div></div></div></article><div class="o dx"><div class="em ce ey ez fa fb fc fd fe ff fg"><hr class="dr ds dt bc" aria-hidden="true"></div></div></span><span><div class="od hr l bl"><div class="o dx"><div class="rh ri rj rk rl jm em ce"><div class="ah rm ai rn gn ro go rp py rq"><p class="bm b dm dn gh">Share your ideas with millions of readers.</p></div><div class="rr ah rs ai rt gn ru go rv py"><a class="bm b bn bo gq bq gs rw rx ry rz bd bz ca cb cc cd cf cg ch ci cj" href="https://medium.com/new-story?source=post_page_footer_cta_write-------------------------------------" rel="noopener follow">Write on Medium</a></div></div></div></div><article><div class="fm fn ow l"><div class="o dx"><div class="em ce ey ez fa fb fc fd fe ff fg"><hr class="dr ds dt bc" aria-hidden="true"><div class="ce ag"><div class="hl l"><div class="ao o"><div></div><div class="ce o yy"><div class="o"></div><div class="l hg"><span class="bm b bn bo cn"><div class="o ao"><a class="" rel="noopener follow" href="https://damonvjanis.medium.com/elixir-genservers-for-web-developers-255d37a3699c?source=post_page-----911730f84d3b----1----------------------------"><p class="bm b bn bo cn"><span>Mar 26, 2020</span></p></a></div></span></div></div></div><div class="vh l"><div class="l"><div class="l do"><div class="we"><div class="l"><div><div class="o"><div class="l en hz"><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Post Preview Title" rel="noopener follow" href="https://damonvjanis.medium.com/elixir-genservers-for-web-developers-255d37a3699c?source=post_page-----911730f84d3b----1----------------------------"><div class="zb zc zd ze zf l"><h2 class="bm ih jv jx zg zh jy jz kb zi zj kc nl nn zk zl kg no nq zm zn kk nr nt zo zp ko op qr qs qu qw gh">Elixir GenServers for Web Developers</h2></div><div class="h k aj ak cu"><p class="ks b dm dn op zq qr qs tw qu qw if gh">I want to share some thoughts and opinions about Elixir GenServers for developers writing web applications (probably with Phoenix). This isn’t a technical deep dive on GenServers, it’s just some of my thoughts about them from writing web apps in Elixir / Phoenix over the last couple years. There’s really…</p></div></a></div><div class="zr zs zt zu zv l"><div class="o u"><div class="o ao oz"><div class="zw l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/tag/elixir?source=post_page-----911730f84d3b---------------elixir-----------------" rel="noopener follow"><div class="zx do gg zy zz aba bm b gp bo gh abb">Elixir</div></a></div><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Post Preview Reading Time" rel="noopener follow" href="https://damonvjanis.medium.com/elixir-genservers-for-web-developers-255d37a3699c?source=post_page-----911730f84d3b----1----------------------------"><p class="bm b gp bo cn"><span>4 min read</span></p></a></div></div><div class="o"><div class="ga l"><div><div class="ci" aria-hidden="false" aria-describedby="191" aria-labelledby="191"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F255d37a3699c&amp;operation=register&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Felixir-genservers-for-web-developers-255d37a3699c&amp;source=-----911730f84d3b----1-----------------bookmark_preview-----------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="xs"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="#292929"></path></svg></a></span></div></div></div></div></div></div></div><div class="abc abd abe abf abg l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Post Preview Image" rel="noopener follow" href="https://damonvjanis.medium.com/elixir-genservers-for-web-developers-255d37a3699c?source=post_page-----911730f84d3b----1----------------------------"><div class="h k aj ak cu"><img alt="Elixir GenServers for Web Developers" class="" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_uIAU98TRbF4f3oW5du17Uw.jpeg" width="112" height="112" loading="lazy"></div><div class="ah ai j i d"><img alt="Elixir GenServers for Web Developers" class="" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_uIAU98TRbF4f3oW5du17Uw(1).jpeg" width="56" height="56" loading="lazy"></div></a></div></div></div></div></div></div><div class="yz za vv or op"></div></div></div></div></div></div></div></div></article></span><span><article><div class="fm fn ow l"><div class="o dx"><div class="em ce ey ez fa fb fc fd fe ff fg"><hr class="dr ds dt bc" aria-hidden="true"><div class="ce ag"><div class="hl l"><div class="ao o"><div></div><div class="ce o yy"><div class="o"></div><div class="l hg"><span class="bm b bn bo cn"><div class="o ao"><a class="" rel="noopener follow" href="https://damonvjanis.medium.com/ecto-preloads-in-phoenix-contexts-167d11e5405e?source=post_page-----911730f84d3b----2----------------------------"><p class="bm b bn bo cn"><span>Oct 29, 2019</span></p></a></div></span></div></div></div><div class="vh l"><div class="l"><div class="l do"><div class="we"><div class="l"><div><div class="o"><div class="l en hz"><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Post Preview Title" rel="noopener follow" href="https://damonvjanis.medium.com/ecto-preloads-in-phoenix-contexts-167d11e5405e?source=post_page-----911730f84d3b----2----------------------------"><div class="zb zc zd ze zf l"><h2 class="bm ih jv jx zg zh jy jz kb zi zj kc nl nn zk zl kg no nq zm zn kk nr nt zo zp ko op qr qs qu qw gh">Ecto Preloads in Phoenix Contexts</h2></div><div class="h k aj ak cu"><p class="ks b dm dn op zq qr qs tw qu qw if gh">Are not as difficult as they seem When I’m working with a new Phoenix app (written in Elixir), I often come across the following situation. I happened to run into it last night on a side-project I’m building called Remind Me (which you should definitely check out, it’s free and…</p></div></a></div><div class="zr zs zt zu zv l"><div class="o u"><div class="o ao oz"><div class="zw l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/tag/elixir?source=post_page-----911730f84d3b---------------elixir-----------------" rel="noopener follow"><div class="zx do gg zy zz aba bm b gp bo gh abb">Elixir</div></a></div><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Post Preview Reading Time" rel="noopener follow" href="https://damonvjanis.medium.com/ecto-preloads-in-phoenix-contexts-167d11e5405e?source=post_page-----911730f84d3b----2----------------------------"><p class="bm b gp bo cn"><span>4 min read</span></p></a></div></div><div class="o"><div class="ga l"><div><div class="ci" aria-hidden="false" aria-describedby="192" aria-labelledby="192"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F167d11e5405e&amp;operation=register&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Fecto-preloads-in-phoenix-contexts-167d11e5405e&amp;source=-----911730f84d3b----2-----------------bookmark_preview-----------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="xs"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="#292929"></path></svg></a></span></div></div></div></div></div></div></div><div class="abc abd abe abf abg l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Post Preview Image" rel="noopener follow" href="https://damonvjanis.medium.com/ecto-preloads-in-phoenix-contexts-167d11e5405e?source=post_page-----911730f84d3b----2----------------------------"><div class="h k aj ak cu"><img alt="Ecto Preloads in Phoenix Contexts" class="" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_4rLZLabTjOxxq30Q_aJiIA.jpeg" width="112" height="112" loading="lazy"></div><div class="ah ai j i d"><img alt="Ecto Preloads in Phoenix Contexts" class="" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_4rLZLabTjOxxq30Q_aJiIA(1).jpeg" width="56" height="56" loading="lazy"></div></a></div></div></div></div></div></div><div class="yz za vv or op"></div></div></div></div></div></div></div></div></article></span><span><article><div class="fm fn ow l"><div class="o dx"><div class="em ce ey ez fa fb fc fd fe ff fg"><hr class="dr ds dt bc" aria-hidden="true"><div class="ce ag"><div class="hl l"><div class="ao o"><div></div><div class="ce o yy"><div class="o"></div><div class="l hg"><span class="bm b bn bo cn"><div class="o ao"><a class="" rel="noopener follow" href="https://damonvjanis.medium.com/recursive-functions-in-elixir-93a118c69db7?source=post_page-----911730f84d3b----3----------------------------"><p class="bm b bn bo cn"><span>Apr 27, 2019</span></p></a></div></span></div></div></div><div class="vh l"><div class="l"><div class="l do"><div class="we"><div class="l"><div><div class="o"><div class="l en hz"><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Post Preview Title" rel="noopener follow" href="https://damonvjanis.medium.com/recursive-functions-in-elixir-93a118c69db7?source=post_page-----911730f84d3b----3----------------------------"><div class="zb zc zd ze zf l"><h2 class="bm ih jv jx zg zh jy jz kb zi zj kc nl nn zk zl kg no nq zm zn kk nr nt zo zp ko op qr qs qu qw gh">Recursive Functions in Elixir</h2></div><div class="h k aj ak cu"><p class="ks b dm dn op zq qr qs tw qu qw if gh">I want to take some of the intimidation out of recursive functions. The word “recursive” used to make my mind shut off the way that math terms in highschool did like “quadradic functions” or “polynomials”. Any time I was reading something that involved recursion, I went looking somewhere else for…</p></div></a></div><div class="zr zs zt zu zv l"><div class="o u"><div class="o ao oz"><div class="zw l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/tag/programming?source=post_page-----911730f84d3b---------------programming-----------------" rel="noopener follow"><div class="zx do gg zy zz aba bm b gp bo gh abb">Programming</div></a></div><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Post Preview Reading Time" rel="noopener follow" href="https://damonvjanis.medium.com/recursive-functions-in-elixir-93a118c69db7?source=post_page-----911730f84d3b----3----------------------------"><p class="bm b gp bo cn"><span>4 min read</span></p></a></div></div><div class="o"><div class="ga l"><div><div class="ci" aria-hidden="false" aria-describedby="193" aria-labelledby="193"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F93a118c69db7&amp;operation=register&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Frecursive-functions-in-elixir-93a118c69db7&amp;source=-----911730f84d3b----3-----------------bookmark_preview-----------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="xs"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="#292929"></path></svg></a></span></div></div></div></div></div></div></div></div></div></div></div></div><div class="yz za vv or op"></div></div></div></div></div></div></div></div></article></span><span><article><div class="fm fn ow l"><div class="o dx"><div class="em ce ey ez fa fb fc fd fe ff fg"><hr class="dr ds dt bc" aria-hidden="true"><div class="ce ag"><div class="hl l"><div class="ao o"><div></div><div class="ce o yy"><div class="o"></div><div class="l hg"><span class="bm b bn bo cn"><div class="o ao"><a class="" rel="noopener follow" href="https://damonvjanis.medium.com/working-with-assigns-in-phoenix-77e0ec2b9d10?source=post_page-----911730f84d3b----4----------------------------"><p class="bm b bn bo cn"><span>Apr 8, 2019</span></p></a></div></span></div></div></div><div class="vh l"><div class="l"><div class="l do"><div class="we"><div class="l"><div><div class="o"><div class="l en hz"><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Post Preview Title" rel="noopener follow" href="https://damonvjanis.medium.com/working-with-assigns-in-phoenix-77e0ec2b9d10?source=post_page-----911730f84d3b----4----------------------------"><div class="zb zc zd ze zf l"><h2 class="bm ih jv jx zg zh jy jz kb zi zj kc nl nn zk zl kg no nq zm zn kk nr nt zo zp ko op qr qs qu qw gh">Working with Assigns in Phoenix</h2></div><div class="h k aj ak cu"><p class="ks b dm dn op zq qr qs tw qu qw if gh">Cleaning up messy controller actions I build a lot of apps with Phoenix, and I sometimes run into a problem where I need to pass a lot of variables from a controller down to the view / template. When you only have one or two variables, here’s what the controller…</p></div></a></div><div class="zr zs zt zu zv l"><div class="o u"><div class="o ao oz"><div class="zw l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/tag/elixir?source=post_page-----911730f84d3b---------------elixir-----------------" rel="noopener follow"><div class="zx do gg zy zz aba bm b gp bo gh abb">Elixir</div></a></div><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Post Preview Reading Time" rel="noopener follow" href="https://damonvjanis.medium.com/working-with-assigns-in-phoenix-77e0ec2b9d10?source=post_page-----911730f84d3b----4----------------------------"><p class="bm b gp bo cn"><span>3 min read</span></p></a></div></div><div class="o"><div class="ga l"><div><div class="ci" aria-hidden="false" aria-describedby="194" aria-labelledby="194"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F77e0ec2b9d10&amp;operation=register&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Fworking-with-assigns-in-phoenix-77e0ec2b9d10&amp;source=-----911730f84d3b----4-----------------bookmark_preview-----------" rel="noopener follow"><svg width="25" height="25" viewBox="0 0 25 25" fill="none" class="xs"><path d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18V2.5zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .8.4l5.7-4.4 5.7 4.4a.5.5 0 0 0 .8-.4v-8.5a.5.5 0 0 0-1 0v7.48l-5.2-4a.5.5 0 0 0-.6 0l-5.2 4V7z" fill="#292929"></path></svg></a></span></div></div></div></div></div></div></div><div class="abc abd abe abf abg l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" aria-label="Post Preview Image" rel="noopener follow" href="https://damonvjanis.medium.com/working-with-assigns-in-phoenix-77e0ec2b9d10?source=post_page-----911730f84d3b----4----------------------------"><div class="h k aj ak cu"><img alt="Working with Assigns in Phoenix" class="" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_r0PLBay9M7XVMYq3YSqExQ.jpeg" width="112" height="112" loading="lazy"></div><div class="ah ai j i d"><img alt="Working with Assigns in Phoenix" class="" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_r0PLBay9M7XVMYq3YSqExQ(1).jpeg" width="56" height="56" loading="lazy"></div></a></div></div></div></div></div></div><div class="yz za vv or op"></div></div></div></div></div></div></div></div></article><div class="o dx"><div class="em ce ey ez fa fb fc fd fe ff fg"><hr class="dr ds dt bc" aria-hidden="true"></div></div></span><div class="rd re rf rg l"><div class="hr l bl"><div class="o dx"><div class="rh ri rj rk rl jm em ce"><div class="ah rm ai rn gn ro go rp py rq"><p class="bm b dm dn gh">Love podcasts or audiobooks? Learn on the go with our new app.</p></div><div class="rr ah rs ai rt gn ru go rv py"><a class="bm b bn bo gq bq gs rw rx ry rz bd bz ca cb cc cd cf cg ch ci cj" href="https://knowable.fyi/?utm_source=medium&amp;utm_medium=referral&amp;utm_campaign=medium-post-footer&amp;source=post_page-----911730f84d3b--------------------------------" rel="noopener follow">Try Knowable</a></div></div></div></div></div></div><div class="o dx"><div class="em ce ey ez fa fb fc fd fe ff fg"><div class="sa rf l"><section class="pw-more-medium-articles l"><div class="sb l"><h2 class="bm ql jv jx qm jy jz kb qn kc kd kf qo kg kh kj qp kk kl kn qq ko op qr qs qt qu qv qw gh">Recommended from Medium</h2></div><div class="fz o gj ha sc sd se sf sg sh si sj sk sl sm sn so sp sq"><div class="sr ss st su sv sw sx sy sz ta tb tc td te tf tg th ti tj tk tl"><div class="ce ag"><div class="tm l"><div class="tn o da dx"><div class="o gj u"><div class="to o da tp"><div class="tq o ao"><div class="tr l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://bantercode.medium.com/?source=post_internal_links---------0----------------------------" rel="noopener follow"><div class="l do"><img alt="Ryan Ferdon" class="l ch gc ts tt gg" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_BAI7qJvcydJxpKUzm2WTGw.jpeg" width="20" height="20" loading="lazy"><div class="gb gc l ts tt gf aq"></div></div></a></div><div class="hf l"><div><div class="ci" aria-hidden="false" aria-describedby="19" aria-labelledby="19"><div class="o"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://bantercode.medium.com/?source=post_internal_links---------0----------------------------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">Ryan Ferdon</p></a></div></div></div></div><div class="hf l"><p class="bm b gp bo cn">in</p></div><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://experiencestack.co/?source=post_internal_links---------0----------------------------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">Experience Stack</p></a></div></div><a href="https://bantercode.medium.com/7-reasons-to-move-your-business-to-the-cloud-18122decbf?source=post_internal_links---------0----------------------------" rel="noopener follow"><h2 class="bm ih dm bo op tv qr qs tw qu qw if gh"><div>7 Reasons to Move Your Business to the Cloud</div></h2></a></div><a href="https://bantercode.medium.com/7-reasons-to-move-your-business-to-the-cloud-18122decbf?source=post_internal_links---------0----------------------------" rel="noopener follow"><div class="tx l"><div class="m op l do gg"><div class="oq or l"><img alt="Dad and son looking at clouds. Son asks dad “what are clouds made of?” Dad replies “Linux servers, mostly”." class="ty" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/0_39SE_nUYEBGo9DOa.png" width="56" loading="lazy"></div></div></div></a></div></div></div></div></div><div class="sr ss st su sv sw sx sy sz ta tb tc td te tf tg th ti tj tk tl"><div class="ce ag"><div class="tm l"><div class="tn o da dx"><div class="o gj u"><div class="to o da tp"><div class="tq o ao"><div class="tr l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/@kamil.klasicki?source=post_internal_links---------1----------------------------" rel="noopener follow"><div class="l do"><img alt="Kamil Klasicki" class="l ch gc ts tt gg" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/0_tncYu6n-2jTltUlK.jpg" width="20" height="20" loading="lazy"><div class="gb gc l ts tt gf aq"></div></div></a></div><div class="hf l"><div><div class="ci" aria-hidden="false" aria-describedby="20" aria-labelledby="20"><div class="o"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/@kamil.klasicki?source=post_internal_links---------1----------------------------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">Kamil Klasicki</p></a></div></div></div></div><div class="hf l"><p class="bm b gp bo cn">in</p></div><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/klaviyo-developers?source=post_internal_links---------1----------------------------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">Klaviyo Developer Blog</p></a></div></div><a href="https://medium.com/@kamil.klasicki/solution-recipe-3-a-serverless-approach-to-getting-webhook-data-into-klaviyo-using-aws-508a90ff7d8a?source=post_internal_links---------1----------------------------" rel="noopener follow"><h2 class="bm ih dm bo op tv qr qs tw qu qw if gh"><div>Solution Recipe 3: A Serverless Approach to Getting Webhook Data into Klaviyo using AWS</div></h2></a></div><a href="https://medium.com/@kamil.klasicki/solution-recipe-3-a-serverless-approach-to-getting-webhook-data-into-klaviyo-using-aws-508a90ff7d8a?source=post_internal_links---------1----------------------------" rel="noopener follow"><div class="tx l"><div class="m op l do gg"><div class="oq or l"><img alt="" class="ty" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_-jgE81FuXXh3L3tZsrNS8Q.png" width="56" loading="lazy" role="presentation"></div></div></div></a></div></div></div></div></div><div class="sr ss st su sv sw sx sy sz ta tb tc td te tf tg th ti tj tk tl"><div class="ce ag"><div class="tm l"><div class="tn o da dx"><div class="o gj u"><div class="to o da tp"><div class="tq o ao"><div class="tr l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://tomparandyk.medium.com/?source=post_internal_links---------2----------------------------" rel="noopener follow"><div class="l do"><img alt="Tom Parandyk" class="l ch gc ts tt gg" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_T7VFpif5SdMso-WGG11S4g.jpeg" width="20" height="20" loading="lazy"><div class="gb gc l ts tt gf aq"></div></div></a></div><div class="hf l"><div><div class="ci" aria-hidden="false" aria-describedby="21" aria-labelledby="21"><div class="o"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://tomparandyk.medium.com/?source=post_internal_links---------2----------------------------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">Tom Parandyk</p></a></div></div></div></div><div class="hf l"><p class="bm b gp bo cn">in</p></div><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/viewstools?source=post_internal_links---------2----------------------------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">Views Tools</p></a></div></div><a href="https://tomparandyk.medium.com/is-a-radically-new-way-to-make-software-around-the-corner-8a799d98a82d?source=post_internal_links---------2----------------------------" rel="noopener follow"><h2 class="bm ih dm bo op tv qr qs tw qu qw if gh"><div>Is a radically new way to make software around the corner?</div></h2></a></div><a href="https://tomparandyk.medium.com/is-a-radically-new-way-to-make-software-around-the-corner-8a799d98a82d?source=post_internal_links---------2----------------------------" rel="noopener follow"><div class="tx l"><div class="m op l do gg"><div class="oq or l"><img alt="" class="ty" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_j32ZADzQ3h72S_jAvvJung.jpeg" width="56" loading="lazy" role="presentation"></div></div></div></a></div></div></div></div></div><div class="sr ss st su sv sw sx sy sz ta tb tc td te tf tg th ti tj tk tl"><div class="ce ag"><div class="tm l"><div class="tn o da dx"><div class="o gj u"><div class="to o da tp"><div class="tq o ao"><div class="tr l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://jonomilnes.medium.com/?source=post_internal_links---------3----------------------------" rel="noopener follow"><div class="l do"><img alt="Jono Milnes" class="l ch gc ts tt gg" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/2_DWcxcz0XZy05QKz5lLoayQ.png" width="20" height="20" loading="lazy"><div class="gb gc l ts tt gf aq"></div></div></a></div><div class="hf l"><div><div class="ci" aria-hidden="false" aria-describedby="22" aria-labelledby="22"><div class="o"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://jonomilnes.medium.com/?source=post_internal_links---------3----------------------------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">Jono Milnes</p></a></div></div></div></div><div class="hf l"><p class="bm b gp bo cn">in</p></div><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/ft-product-technology?source=post_internal_links---------3----------------------------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">FT Product &amp; Technology</p></a></div></div><a href="https://jonomilnes.medium.com/the-discovery-guild-is-driving-culture-change-at-the-ft-cf297ba58afd?source=post_internal_links---------3----------------------------" rel="noopener follow"><h2 class="bm ih dm bo op tv qr qs tw qu qw if gh"><div>The Discovery Guild is driving culture change at the FT</div></h2></a></div><a href="https://jonomilnes.medium.com/the-discovery-guild-is-driving-culture-change-at-the-ft-cf297ba58afd?source=post_internal_links---------3----------------------------" rel="noopener follow"><div class="tx l"><div class="m op l do gg"><div class="oq or l"><img alt="Discovery Guild emoji image" class="ty" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_rg5U3fv19oeNhZVqzCwicQ.png" width="56" loading="lazy"></div></div></div></a></div></div></div></div></div><div class="sr ss st su sv sw sx sy sz ta tb tc td te tf tg th ti tj tk tl"><div class="ce ag"><div class="tm l"><div class="tn o da dx"><div class="o gj u"><div class="to o da tp"><div class="tq o ao"><div class="tr l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://mikejone.medium.com/?source=post_internal_links---------4----------------------------" rel="noopener follow"><div class="l do"><img alt="Mike Jones" class="l ch gc ts tt gg" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/0_Mo0kdiBVUSf25wqD" width="20" height="20" loading="lazy"><div class="gb gc l ts tt gf aq"></div></div></a></div><div class="hf l"><div><div class="ci" aria-hidden="false" aria-describedby="23" aria-labelledby="23"><div class="o"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://mikejone.medium.com/?source=post_internal_links---------4----------------------------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">Mike Jones</p></a></div></div></div></div></div><a href="https://mikejone.medium.com/how-to-build-a-high-performing-software-development-team-e59a3492c7ed?source=post_internal_links---------4----------------------------" rel="noopener follow"><h2 class="bm ih dm bo op tv qr qs tw qu qw if gh"><div>How to build a high performing software development team</div></h2></a></div><a href="https://mikejone.medium.com/how-to-build-a-high-performing-software-development-team-e59a3492c7ed?source=post_internal_links---------4----------------------------" rel="noopener follow"><div class="tx l"><div class="m op l do gg"><div class="oq or l"><img alt="" class="ty" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_AgYYGLkPaL0Gbanm9AjGCA.jpeg" width="56" loading="lazy" role="presentation"></div></div></div></a></div></div></div></div></div><div class="sr ss st su sv sw sx sy sz ta tb tc td te tf tg th ti tj tk tl"><div class="ce ag"><div class="tm l"><div class="tn o da dx"><div class="o gj u"><div class="to o da tp"><div class="tq o ao"><div class="tr l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/@ben_longstaff?source=post_internal_links---------5----------------------------" rel="noopener follow"><div class="l do"><img alt="Ben Longstaff" class="l ch gc ts tt gg" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_Coug7hedanA98DiK_lt_qg.jpeg" width="20" height="20" loading="lazy"><div class="gb gc l ts tt gf aq"></div></div></a></div><div class="hf l"><div><div class="ci" aria-hidden="false" aria-describedby="24" aria-labelledby="24"><div class="o"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/@ben_longstaff?source=post_internal_links---------5----------------------------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">Ben Longstaff</p></a></div></div></div></div><div class="hf l"><p class="bm b gp bo cn">in</p></div><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/swlh?source=post_internal_links---------5----------------------------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">The Startup</p></a></div></div><a href="https://medium.com/@ben_longstaff/stop-building-car-boats-tech-debt-101-bc0b08312fa?source=post_internal_links---------5----------------------------" rel="noopener follow"><h2 class="bm ih dm bo op tv qr qs tw qu qw if gh"><div>Stop building car boats — tech debt 101</div></h2></a></div><a href="https://medium.com/@ben_longstaff/stop-building-car-boats-tech-debt-101-bc0b08312fa?source=post_internal_links---------5----------------------------" rel="noopener follow"><div class="tx l"><div class="m op l do gg"><div class="oq or l"><img alt="" class="ty" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_YG5AZUr_DSR0w4gGh7fa8A.jpeg" width="56" loading="lazy" role="presentation"></div></div></div></a></div></div></div></div></div><div class="sr ss st su sv sw sx sy sz ta tb tc td te tf tg th ti tj tk tl"><div class="ce ag"><div class="tm l"><div class="tn o da dx"><div class="o gj u"><div class="to o da tp"><div class="tq o ao"><div class="tr l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://ashchk.medium.com/?source=post_internal_links---------6----------------------------" rel="noopener follow"><div class="l do"><img alt="Ashis Chakraborty" class="l ch gc ts tt gg" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/2_5A3oDiRJiYP4mODhVe2sYg.jpeg" width="20" height="20" loading="lazy"><div class="gb gc l ts tt gf aq"></div></div></a></div><div class="hf l"><div><div class="ci" aria-hidden="false" aria-describedby="25" aria-labelledby="25"><div class="o"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://ashchk.medium.com/?source=post_internal_links---------6----------------------------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">Ashis Chakraborty</p></a></div></div></div></div><div class="hf l"><p class="bm b gp bo cn">in</p></div><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://codeburst.io/?source=post_internal_links---------6----------------------------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">codeburst</p></a></div></div><a href="https://ashchk.medium.com/system-design-basics-load-balancer-101-adc4f602d08f?source=post_internal_links---------6----------------------------" rel="noopener follow"><h2 class="bm ih dm bo op tv qr qs tw qu qw if gh"><div>System Design Basics: Load balancer 101</div></h2></a></div><a href="https://ashchk.medium.com/system-design-basics-load-balancer-101-adc4f602d08f?source=post_internal_links---------6----------------------------" rel="noopener follow"><div class="tx l"><div class="m op l do gg"><div class="oq or l"><img alt="" class="ty" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/0_YIuEDe-yXagGc-bo" width="56" loading="lazy" role="presentation"></div></div></div></a></div></div></div></div></div><div class="sr ss st su sv sw sx sy sz ta tb tc td te tf tg th ti tj tk tl"><div class="ce ag"><div class="tm l"><div class="tn o da dx"><div class="o gj u"><div class="to o da tp"><div class="tq o ao"><div class="tr l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/@ponchovaldescarrales?source=post_internal_links---------7----------------------------" rel="noopener follow"><div class="l do"><img alt="Alfonso Valdes Carrales" class="l ch gc ts tt gg" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/0_Llt9WyozUgPmWYPk.jpg" width="20" height="20" loading="lazy"><div class="gb gc l ts tt gf aq"></div></div></a></div><div class="hf l"><div><div class="ci" aria-hidden="false" aria-describedby="26" aria-labelledby="26"><div class="o"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/@ponchovaldescarrales?source=post_internal_links---------7----------------------------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">Alfonso Valdes Carrales</p></a></div></div></div></div><div class="hf l"><p class="bm b gp bo cn">in</p></div><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://betterprogramming.pub/?source=post_internal_links---------7----------------------------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">Better Programming</p></a></div></div><a href="https://medium.com/@ponchovaldescarrales/how-to-create-a-ci-cd-pipeline-with-jenkins-containers-and-amazon-ecs-af4eaec75b8b?source=post_internal_links---------7----------------------------" rel="noopener follow"><h2 class="bm ih dm bo op tv qr qs tw qu qw if gh"><div>How to Create a CI/CD Pipeline With Jenkins, Containers, and Amazon ECS</div></h2></a></div><a href="https://medium.com/@ponchovaldescarrales/how-to-create-a-ci-cd-pipeline-with-jenkins-containers-and-amazon-ecs-af4eaec75b8b?source=post_internal_links---------7----------------------------" rel="noopener follow"><div class="tx l"><div class="m op l do gg"><div class="oq or l"><img alt="" class="ty" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_84RiLa8LNGJq2bGJBtFSvQ.jpeg" width="56" loading="lazy" role="presentation"></div></div></div></a></div></div></div></div></div></div></section></div></div></div></div></div><div class="d"><div class="tz ua ub l ox ar ed as uc ud"><div class="o dx"><div class="ey ez ue uf ug uh em ce"><a class="au av aw ax ay az ba bb bc bd ui uj bg uk ul" aria-label="Go to homepage" href="https://medium.com/?source=post_page-----911730f84d3b--------------------------------" rel="noopener follow"><svg viewBox="0 0 3940 610" class="gs um"><path d="M594.79 308.2c0 163.76-131.85 296.52-294.5 296.52S5.8 472 5.8 308.2 137.65 11.69 300.29 11.69s294.5 132.75 294.5 296.51M917.86 308.2c0 154.16-65.93 279.12-147.25 279.12s-147.25-125-147.25-279.12S689.29 29.08 770.61 29.08s147.25 125 147.25 279.12M1050 308.2c0 138.12-23.19 250.08-51.79 250.08s-51.79-112-51.79-250.08 23.19-250.08 51.8-250.08S1050 170.09 1050 308.2M1862.77 37.4l.82-.18v-6.35h-167.48l-155.51 365.5-155.51-365.5h-180.48v6.35l.81.18c30.57 6.9 46.09 17.19 46.09 54.3v434.45c0 37.11-15.58 47.4-46.15 54.3l-.81.18V587H1327v-6.35l-.81-.18c-30.57-6.9-46.09-17.19-46.09-54.3V116.9L1479.87 587h11.33l205.59-483.21V536.9c-2.62 29.31-18 38.36-45.68 44.61l-.82.19v6.3h213.3v-6.3l-.82-.19c-27.71-6.25-43.46-15.3-46.08-44.61l-.14-445.2h.14c0-37.11 15.52-47.4 46.08-54.3m97.43 287.8c3.49-78.06 31.52-134.4 78.56-135.37 14.51.24 26.68 5 36.14 14.16 20.1 19.51 29.55 60.28 28.09 121.21zm-2.11 22h250v-1.05c-.71-59.69-18-106.12-51.34-138-28.82-27.55-71.49-42.71-116.31-42.71h-1c-23.26 0-51.79 5.64-72.09 15.86-23.11 10.7-43.49 26.7-60.45 47.7-27.3 33.83-43.84 79.55-47.86 130.93-.13 1.54-.24 3.08-.35 4.62s-.18 2.92-.25 4.39a332.64 332.64 0 0 0-.36 21.69C1860.79 507 1923.65 600 2035.3 600c98 0 155.07-71.64 169.3-167.8l-7.19-2.53c-25 51.68-69.9 83-121 79.18-69.76-5.22-123.2-75.95-118.35-161.63m532.69 157.68c-8.2 19.45-25.31 30.15-48.24 30.15s-43.89-15.74-58.78-44.34c-16-30.7-24.42-74.1-24.42-125.51 0-107 33.28-176.21 84.79-176.21 21.57 0 38.55 10.7 46.65 29.37zm165.84 76.28c-30.57-7.23-46.09-18-46.09-57V5.28L2424.77 60v6.7l1.14-.09c25.62-2.07 43 1.47 53.09 10.79 7.9 7.3 11.75 18.5 11.75 34.26v71.14c-18.31-11.69-40.09-17.38-66.52-17.38-53.6 0-102.59 22.57-137.92 63.56-36.83 42.72-56.3 101.1-56.3 168.81C2230 518.72 2289.53 600 2378.13 600c51.83 0 93.53-28.4 112.62-76.3V588h166.65v-6.66zm159.29-505.33c0-37.76-28.47-66.24-66.24-66.24-37.59 0-67 29.1-67 66.24s29.44 66.24 67 66.24c37.77 0 66.24-28.48 66.24-66.24m43.84 505.33c-30.57-7.23-46.09-18-46.09-57h-.13V166.65l-166.66 47.85v6.5l1 .09c36.06 3.21 45.93 15.63 45.93 57.77V588h166.8v-6.66zm427.05 0c-30.57-7.23-46.09-18-46.09-57V166.65L3082 212.92v6.52l.94.1c29.48 3.1 38 16.23 38 58.56v226c-9.83 19.45-28.27 31-50.61 31.78-36.23 0-56.18-24.47-56.18-68.9V166.66l-166.66 47.85V221l1 .09c36.06 3.2 45.94 15.62 45.94 57.77v191.27a214.48 214.48 0 0 0 3.47 39.82l3 13.05c14.11 50.56 51.08 77 109 77 49.06 0 92.06-30.37 111-77.89v66h166.66v-6.66zM3934.2 588v-6.67l-.81-.19c-33.17-7.65-46.09-22.07-46.09-51.43v-243.2c0-75.83-42.59-121.09-113.93-121.09-52 0-95.85 30.05-112.73 76.86-13.41-49.6-52-76.86-109.06-76.86-50.12 0-89.4 26.45-106.25 71.13v-69.87l-166.66 45.89v6.54l1 .09c35.63 3.16 45.93 15.94 45.93 57V588h155.5v-6.66l-.82-.2c-26.46-6.22-35-17.56-35-46.66V255.72c7-16.35 21.11-35.72 49-35.72 34.64 0 52.2 24 52.2 71.28V588h155.54v-6.66l-.82-.2c-26.46-6.22-35-17.56-35-46.66v-248a160.45 160.45 0 0 0-2.2-27.68c7.42-17.77 22.34-38.8 51.37-38.8 35.13 0 52.2 23.31 52.2 71.28V588z"></path></svg></a><div class="un l"><p class="bm b gp bo uo"><a class="au av aw ax ay az ba bb bc bd up bg uk ul uq" href="https://medium.com/about?autoplay=1&amp;source=post_page-----911730f84d3b--------------------------------" rel="noopener follow">About</a><a class="au av aw ax ay az ba bb bc bd up bg uk ul uq" href="https://help.medium.com/hc/en-us?source=post_page-----911730f84d3b--------------------------------" rel="noopener follow">Help</a><a class="au av aw ax ay az ba bb bc bd up bg uk ul uq" href="https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----911730f84d3b--------------------------------" rel="noopener follow">Terms</a><a class="au av aw ax ay az ba bb bc bd up bg uk ul" href="https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----911730f84d3b--------------------------------" rel="noopener follow">Privacy</a></p></div><div class="j i d"><hr class="dr ds ur us" aria-hidden="true"><h2 class="bm ql dm bo if uo">Get the Medium app</h2><div class="un o"><div class="ga l"><a class="au av aw ax ay az ba bb bc bd ui uj bg uk ul" href="https://itunes.apple.com/app/medium-everyones-stories/id828256236?pt=698524&amp;mt=8&amp;ct=post_page&amp;source=post_page-----911730f84d3b--------------------------------" rel="noopener follow"><img alt="A button that says &#39;Download on the App Store&#39;, and if clicked it will lead you to the iOS App store" class="" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_Crl55Tm6yDNMoucPo1tvDg.png" width="135" height="41" loading="lazy"></a></div><a class="au av aw ax ay az ba bb bc bd ui uj bg uk ul" href="https://play.google.com/store/apps/details?id=com.medium.reader&amp;source=post_page-----911730f84d3b--------------------------------" rel="noopener follow"><img alt="A button that says &#39;Get it on, Google Play&#39;, and if clicked it will lead you to the Google Play store" class="" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_W_RAPQ62h0em559zluJLdQ.png" width="135" height="41" loading="lazy"></a></div></div></div></div></div></div></div></main><div class="eo ch c ep h k j i cu eq er es"><div class="ag ce ci do"><div class="l db aq" style="position: relative; top: 0px; margin-top: 3526px;"><div class="eq o da"><div class="l oz"><div class="ut uu uv l"><div class="l"><div class="o ao"><div class="pw-susi-button l oz"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b&amp;source=post_page---three_column_layout_sidebar-----------------------three_column_layout_nav-----------" rel="noopener follow"><button class="bm b bn bo gq bq gs rw rx ry rz bd bz ca cb cc cd ce cf cg ch ci cj" aria-label="sign up">Get started</button></a></span></div><div class="pw-sign-in-button pz l"><p class="bm b bn bo co"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b&amp;source=post_page---three_column_layout_sidebar-----------------------three_column_layout_nav-----------" rel="noopener follow">Sign In</a></span></p></div></div></div></div><div class="ut uu uv l"><div class="o hq uw ux"><div class="ci" aria-hidden="false" aria-describedby="searchResults" aria-labelledby="searchResults"></div><span class="vc l"><svg width="25" height="25" viewBox="0 0 25 25" fill="rgba(8, 8, 8, 1)"><path d="M20.07 18.93l-4.16-4.15a6 6 0 1 0-.88.88l4.15 4.16a.62.62 0 1 0 .89-.89zM6.5 11a4.75 4.75 0 1 1 9.5 0 4.75 4.75 0 0 1-9.5 0z"></path></svg></span><input role="combobox" aria-controls="searchResults" aria-expanded="false" aria-label="search" tabindex="0" class="dz uy bm bn bo ce uz va gh vb" placeholder="Search" value=""></div></div><div class="ut uu uv l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener follow" href="https://damonvjanis.medium.com/?source=---three_column_layout_sidebar----------------------------------"><div class="l do"><img alt="Damon Janis" class="l ch gc vd ve gg" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_gDcDYew1ntSXqHIkMQs4Dw(1).jpeg" width="88" height="88" loading="lazy"><div class="gb gc l vd ve gf aq"></div></div></a><div class="vf l"></div><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" rel="noopener follow" href="https://damonvjanis.medium.com/?source=---three_column_layout_sidebar----------------------------------"><h2 class="pw-author-name bm ql dm bo if gh">Damon Janis</h2></a><div class="vg l"></div><span class="pw-follower-count bm b dm dn cn"><button class="au av aw ax ay az ba bb bc bd be bf bg bh bi">74 Followers</button></span><div class="vh l"></div><p class="bm b bn bo cn">Elixir dev building for the web with Phoenix</p><div class="vi l"></div><div class="vj o"><span><button class="bm b bn bo gq bq gs gt gu gv gw bd bz gx gy gz cd vk cf cg ch ci cj">Follow</button></span><div class="qx l"><div><div><div class="ci" aria-hidden="false" aria-describedby="184" aria-labelledby="184"><div class="l"><span><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F415029f5502a&amp;operation=register&amp;redirect=https%3A%2F%2Fdamonvjanis.medium.com%2Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b&amp;newsletterV3=43709c76c449&amp;newsletterV3Id=415029f5502a&amp;user=Damon+Janis&amp;userId=43709c76c449&amp;source=---three_column_layout_sidebar-----------------------subscribe_user-----------" rel="noopener follow"><button class="bm b bn bo gq bb gs gt gu gv gw bd bz gx gy gz cd cf cg ch ci cj" aria-label="Subscribe"><svg width="38" height="38" viewBox="0 0 38 38" fill="none" class="ym qz ra"><rect x="26.25" y="9.25" width="0.5" height="6.5" rx="0.25"></rect><rect x="29.75" y="12.25" width="0.5" height="6.5" rx="0.25" transform="rotate(90 29.75 12.25)"></rect><path d="M19.5 12.5h-7a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1v-5"></path><path d="M11.5 14.5L19 20l4-3"></path></svg></button></a></span></div></div></div></div></div></div></div><div class="ut uu uv l"><div class="l"><div class="tn uv l"><h2 class="bm ql dm bo if gh">More from Medium</h2></div><div class="l"><div class="ce ag"><div class="tn o da dx"><div class="o gj u"><div class="to o da tp"><div class="tq o ao"><div class="tr l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/@mike_tyson_cloud?source=read_next_recirc---three_column_layout_sidebar------0---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><div class="l do"><img alt="Mike Tyson" class="l ch gc ts tt gg" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_-1A_S_gOiCzloPHSzWvooQ.jpeg" width="20" height="20" loading="lazy"><div class="gb gc l ts tt gf aq"></div></div></a></div><div class="hf l"><div><div class="ci" aria-hidden="false" aria-describedby="185" aria-labelledby="185"><div class="o"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/@mike_tyson_cloud?source=read_next_recirc---three_column_layout_sidebar------0---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">Mike Tyson</p></a></div></div></div></div></div><a href="https://medium.com/@mike_tyson_cloud/top-20-alternatives-to-draw-io-diagrams-net-for-cloud-architecture-ccaf0a6edd97?source=read_next_recirc---three_column_layout_sidebar------0---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><h2 class="bm ih dm bo op tv qr qs tw qu qw if gh"><div>Top 20 Alternatives to Draw.io / Diagrams.net for Cloud Architecture</div></h2></a></div><a href="https://medium.com/@mike_tyson_cloud/top-20-alternatives-to-draw-io-diagrams-net-for-cloud-architecture-ccaf0a6edd97?source=read_next_recirc---three_column_layout_sidebar------0---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><div class="tx l"><div class="m op l do gg"><div class="oq or l"><img alt="" class="ty" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/0_iEL-1UdVQP6Nilps.png" width="56" loading="lazy" role="presentation"></div></div></div></a></div></div></div><div class="ce ag"><div class="tn o da dx"><div class="o gj u"><div class="to o da tp"><div class="tq o ao"><div class="tr l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/@barekliton?source=read_next_recirc---three_column_layout_sidebar------1---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><div class="l do"><img alt="Kliton Bare" class="l ch gc ts tt gg" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_cLM62E25vrJmES1djbACUA.jpeg" width="20" height="20" loading="lazy"><div class="gb gc l ts tt gf aq"></div></div></a></div><div class="hf l"><div><div class="ci" aria-hidden="false" aria-describedby="186" aria-labelledby="186"><div class="o"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/@barekliton?source=read_next_recirc---three_column_layout_sidebar------1---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">Kliton Bare</p></a></div></div></div></div><div class="hf l"><p class="bm b gp bo cn">in</p></div><div class="l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://itnext.io/?source=read_next_recirc---three_column_layout_sidebar------1---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">ITNEXT</p></a></div></div><a href="https://medium.com/@barekliton/why-our-company-replaced-golang-graphql-with-typescript-prisma-trpc-ef56aaaa1c8c?source=read_next_recirc---three_column_layout_sidebar------1---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><h2 class="bm ih dm bo op tv qr qs tw qu qw if gh"><div>Why our company replaced Golang+GraphQL with TypeScript+Prisma+tRPC</div></h2></a></div><a href="https://medium.com/@barekliton/why-our-company-replaced-golang-graphql-with-typescript-prisma-trpc-ef56aaaa1c8c?source=read_next_recirc---three_column_layout_sidebar------1---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><div class="tx l"><div class="m op l do gg"><div class="oq or l"><img alt="" class="ty" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/0_HqeALH_PvzYGmBOQ" width="56" loading="lazy" role="presentation"></div></div></div></a></div></div></div><div class="ce ag"><div class="tn o da dx"><div class="o gj u"><div class="to o da tp"><div class="tq o ao"><div class="tr l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://danielgafni.medium.com/?source=read_next_recirc---three_column_layout_sidebar------2---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><div class="l do"><img alt="Daniel Gafni" class="l ch gc ts tt gg" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_DR2TM2DwTgVxAoOwKOW_-A.jpeg" width="20" height="20" loading="lazy"><div class="gb gc l ts tt gf aq"></div></div></a></div><div class="hf l"><div><div class="ci" aria-hidden="false" aria-describedby="187" aria-labelledby="187"><div class="o"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://danielgafni.medium.com/?source=read_next_recirc---three_column_layout_sidebar------2---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">Daniel Gafni</p></a></div></div></div></div></div><a href="https://danielgafni.medium.com/the-modern-linux-cli-stack-46253688b53d?source=read_next_recirc---three_column_layout_sidebar------2---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><h2 class="bm ih dm bo op tv qr qs tw qu qw if gh"><div>The modern Linux CLI stack</div></h2></a></div><a href="https://danielgafni.medium.com/the-modern-linux-cli-stack-46253688b53d?source=read_next_recirc---three_column_layout_sidebar------2---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><div class="tx l"><div class="m op l do gg"><div class="oq or l"><img alt="" class="ty" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_kT4BTDUNvr-fCV4GzpgMjg.png" width="56" loading="lazy" role="presentation"></div></div></div></a></div></div></div><div class="ce ag"><div class="tn o da dx"><div class="o gj u"><div class="to o da tp"><div class="tq o ao"><div class="tr l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://artiya4u.medium.com/?source=read_next_recirc---three_column_layout_sidebar------3---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><div class="l do"><img alt="Artiya" class="l ch gc ts tt gg" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_H_67PmRpvfCBB_46ZvvVjA.jpeg" width="20" height="20" loading="lazy"><div class="gb gc l ts tt gf aq"></div></div></a></div><div class="hf l"><div><div class="ci" aria-hidden="false" aria-describedby="188" aria-labelledby="188"><div class="o"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://artiya4u.medium.com/?source=read_next_recirc---three_column_layout_sidebar------3---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><p class="bm b gp bo op tu qr qs qt qu qv qw gh">Artiya</p></a></div></div></div></div></div><a href="https://artiya4u.medium.com/what-is-the-cheapest-cloud-server-for-my-personal-use-de9f3626e56b?source=read_next_recirc---three_column_layout_sidebar------3---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><h2 class="bm ih dm bo op tv qr qs tw qu qw if gh"><div>What is the cheapest cloud server for my personal use?</div></h2></a></div><a href="https://artiya4u.medium.com/what-is-the-cheapest-cloud-server-for-my-personal-use-de9f3626e56b?source=read_next_recirc---three_column_layout_sidebar------3---------------------c5c7ea47_1fce_4869_a36d_438113a2aee0-------" rel="noopener follow"><div class="tx l"><div class="m op l do gg"><div class="oq or l"><img alt="" class="ty" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1_4d5lWvV7InvzrQ38Cjtsvg.jpeg" width="56" loading="lazy" role="presentation"></div></div></div></a></div></div></div></div></div></div></div><div class="vl o gj ha"><div class="vm l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://help.medium.com/hc/en-us?source=---three_column_layout_sidebar----------------------------------" rel="noopener follow"><p class="bm b vn vo cn">Help</p></a></div><div class="vm l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.statuspage.io/?source=---three_column_layout_sidebar----------------------------------" rel="noopener follow"><p class="bm b vn vo cn">Status</p></a></div><div class="vm l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://about.medium.com/creators/?source=---three_column_layout_sidebar----------------------------------" rel="noopener follow"><p class="bm b vn vo cn">Writers</p></a></div><div class="vm l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://blog.medium.com/?source=---three_column_layout_sidebar----------------------------------" rel="noopener follow"><p class="bm b vn vo cn">Blog</p></a></div><div class="vm l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=---three_column_layout_sidebar----------------------------------" rel="noopener follow"><p class="bm b vn vo cn">Careers</p></a></div><div class="vm l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=---three_column_layout_sidebar----------------------------------" rel="noopener follow"><p class="bm b vn vo cn">Privacy</p></a></div><div class="vm l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=---three_column_layout_sidebar----------------------------------" rel="noopener follow"><p class="bm b vn vo cn">Terms</p></a></div><div class="vm l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://medium.com/about?autoplay=1&amp;source=---three_column_layout_sidebar----------------------------------" rel="noopener follow"><p class="bm b vn vo cn">About</p></a></div><div class="vm l"><a class="au av aw ax ay az ba bb bc bd be bf bg bh bi" href="https://knowable.fyi/?source=---three_column_layout_sidebar----------------------------------" rel="noopener follow"><p class="bm b vn vo cn">Knowable</p></a></div></div></div></div></div></div></div></div></div></div></div><script>window.__BUILD_ID__="main-20221014-203148-5234145f86"</script><script>window.__GRAPHQL_URI__ = "https://damonvjanis.medium.com/_/graphql"</script><script>window.__PRELOADED_STATE__ = {"algolia":{"queries":{}},"auroraPage":{"isAuroraPageEnabled":false},"cache":{"experimentGroupSet":true,"reason":"","group":"enabled","tags":["group-edgeCachePosts","post-911730f84d3b","user-43709c76c449"],"serverVariantState":"44136fa355b3678a1146ad16f7e8649e94fb4fc21fe77e8310c060f61caaff8a","middlewareEnabled":true,"cacheStatus":"DYNAMIC","shouldUseCache":true,"vary":[],"inDisabledExperiment":false,"zenEnabled":false},"client":{"hydrated":false,"isUs":false,"isNativeMedium":false,"isSafariMobile":false,"isSafari":false,"isFirefox":false,"routingEntity":{"type":"USER","id":"43709c76c449","explicit":true},"viewerIsBot":false},"debug":{"requestId":"f1b4c2db-7dcd-48fe-8155-f66bf6f75acd","hybridDevServices":[],"originalSpanCarrier":{"ot-tracer-spanid":"6d4fb5834906af83","ot-tracer-traceid":"4e43cc287ec03d31","ot-tracer-sampled":"true"}},"meter":{},"multiVote":{"clapsPerPost":{}},"navigation":{"branch":{"show":null,"hasRendered":null,"blockedByCTA":false},"hideGoogleOneTap":false,"hasRenderedAlternateUserBanner":null,"currentLocation":"https:\u002F\u002Fdamonvjanis.medium.com\u002Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b","host":"damonvjanis.medium.com","hostname":"damonvjanis.medium.com","referrer":"","hasSetReferrer":false,"susiModal":{"step":null,"operation":"register"},"postRead":false,"queryString":"","currentHash":""},"config":{"nodeEnv":"production","version":"main-20221014-203148-5234145f86","target":"production","productName":"Medium","publicUrl":"https:\u002F\u002Fcdn-client.medium.com\u002Flite","authDomain":"medium.com","authGoogleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","favicon":"production","glyphUrl":"https:\u002F\u002Fglyph.medium.com","branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","algolia":{"appId":"MQ57UUUQZ2","apiKeySearch":"394474ced050e3911ae2249ecc774921","indexPrefix":"medium_","host":"-dsn.algolia.net"},"recaptchaKey":"6Lfc37IUAAAAAKGGtC6rLS13R1Hrw_BqADfS1LRk","recaptcha3Key":"6Lf8R9wUAAAAABMI_85Wb8melS7Zj6ziuf99Yot5","datadog":{"applicationId":"6702d87d-a7e0-42fe-bbcb-95b469547ea0","clientToken":"pub853ea8d17ad6821d9f8f11861d23dfed","rumToken":"pubf9cc52896502b9413b68ba36fc0c7162","context":{"deployment":{"target":"production","tag":"main-20221014-203148-5234145f86","commit":"5234145f86e52c8afe1cdef543b7b5476ac253ba"}},"datacenter":"us"},"googleAnalyticsCode":"UA-24232453-2","googlePay":{"apiVersion":"2","apiVersionMinor":"0","merchantId":"BCR2DN6TV7EMTGBM","merchantName":"Medium","instanceMerchantId":"13685562959212738550"},"applePay":{"version":3},"signInWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"mediumOwnedAndOperatedCollectionIds":["8a9336e5bb4","b7e45b22fec3","193b68bd4fba","8d6b8a439e32","54c98c43354d","3f6ecf56618","d944778ce714","92d2092dc598","ae2a65f35510","1285ba81cada","544c7006046e","fc8964313712","40187e704f1c","88d9857e584e","7b6769f2748b","bcc38c8f6edf","cef6983b292","cb8577c9149e","444d13b52878","713d7dbc99b0","ef8e90590e66","191186aaafa0","55760f21cdc5","9dc80918cc93","bdc4052bbdba","8ccfed20cbb2"],"tierOneDomains":["medium.com","thebolditalic.com","arcdigital.media","towardsdatascience.com","uxdesign.cc","codeburst.io","psiloveyou.xyz","writingcooperative.com","entrepreneurshandbook.co","prototypr.io","betterhumans.coach.me","theascent.pub"],"topicsToFollow":["d61cf867d93f","8a146bc21b28","1eca0103fff3","4d562ee63426","aef1078a3ef5","e15e46793f8d","6158eb913466","55f1c20aba7a","3d18b94f6858","4861fee224fd","63c6f1f93ee","1d98b3a9a871","decb52b64abf","ae5d4995e225","830cded25262"],"topicToTagMappings":{"accessibility":"accessibility","addiction":"addiction","android-development":"android-development","art":"art","artificial-intelligence":"artificial-intelligence","astrology":"astrology","basic-income":"basic-income","beauty":"beauty","biotech":"biotech","blockchain":"blockchain","books":"books","business":"business","cannabis":"cannabis","cities":"cities","climate-change":"climate-change","comics":"comics","coronavirus":"coronavirus","creativity":"creativity","cryptocurrency":"cryptocurrency","culture":"culture","cybersecurity":"cybersecurity","data-science":"data-science","design":"design","digital-life":"digital-life","disability":"disability","economy":"economy","education":"education","equality":"equality","family":"family","feminism":"feminism","fiction":"fiction","film":"film","fitness":"fitness","food":"food","freelancing":"freelancing","future":"future","gadgets":"gadgets","gaming":"gaming","gun-control":"gun-control","health":"health","history":"history","humor":"humor","immigration":"immigration","ios-development":"ios-development","javascript":"javascript","justice":"justice","language":"language","leadership":"leadership","lgbtqia":"lgbtqia","lifestyle":"lifestyle","machine-learning":"machine-learning","makers":"makers","marketing":"marketing","math":"math","media":"media","mental-health":"mental-health","mindfulness":"mindfulness","money":"money","music":"music","neuroscience":"neuroscience","nonfiction":"nonfiction","outdoors":"outdoors","parenting":"parenting","pets":"pets","philosophy":"philosophy","photography":"photography","podcasts":"podcast","poetry":"poetry","politics":"politics","privacy":"privacy","product-management":"product-management","productivity":"productivity","programming":"programming","psychedelics":"psychedelics","psychology":"psychology","race":"race","relationships":"relationships","religion":"religion","remote-work":"remote-work","san-francisco":"san-francisco","science":"science","self":"self","self-driving-cars":"self-driving-cars","sexuality":"sexuality","social-media":"social-media","society":"society","software-engineering":"software-engineering","space":"space","spirituality":"spirituality","sports":"sports","startups":"startup","style":"style","technology":"technology","transportation":"transportation","travel":"travel","true-crime":"true-crime","tv":"tv","ux":"ux","venture-capital":"venture-capital","visual-design":"visual-design","work":"work","world":"world","writing":"writing"},"defaultImages":{"avatar":{"imageId":"1*dmbNkD5D-u45r44go_cf0g.png","height":150,"width":150},"orgLogo":{"imageId":"1*OMF3fSqH8t4xBJ9-6oZDZw.png","height":106,"width":545},"postLogo":{"imageId":"1*kFrc4tBFM_tCis-2Ic87WA.png","height":810,"width":1440},"postPreviewImage":{"imageId":"1*hn4v1tCaJy7cWMyb0bpNpQ.png","height":386,"width":579}},"collectionStructuredData":{"8d6b8a439e32":{"name":"Elemental","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F980\u002F1*9ygdqoKprhwuTVKUM0DLPA@2x.png","width":980,"height":159}}},"3f6ecf56618":{"name":"Forge","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F596\u002F1*uULpIlImcO5TDuBZ6lm7Lg@2x.png","width":596,"height":183}}},"ae2a65f35510":{"name":"GEN","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F264\u002F1*RdVZMdvfV3YiZTw6mX7yWA.png","width":264,"height":140}}},"88d9857e584e":{"name":"LEVEL","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*JqYMhNX6KNNb2UlqGqO2WQ.png","width":540,"height":108}}},"7b6769f2748b":{"name":"Marker","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F383\u002F1*haCUs0wF6TgOOvfoY-jEoQ@2x.png","width":383,"height":92}}},"444d13b52878":{"name":"OneZero","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*cw32fIqCbRWzwJaoQw6BUg.png","width":540,"height":123}}},"8ccfed20cbb2":{"name":"Zora","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*tZUQqRcCCZDXjjiZ4bDvgQ.png","width":540,"height":106}}}},"embeddedPostIds":{"coronavirus":"cd3010f9d81f"},"sharedCdcMessaging":{"COVID_APPLICABLE_TAG_SLUGS":[],"COVID_APPLICABLE_TOPIC_NAMES":[],"COVID_APPLICABLE_TOPIC_NAMES_FOR_TOPIC_PAGE":[],"COVID_MESSAGES":{"tierA":{"text":"For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":66,"end":73,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"tierB":{"text":"Anyone can publish on Medium per our Policies, but we don’t fact-check every story. For more info about the coronavirus, see cdc.gov.","markups":[{"start":37,"end":45,"href":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Fcategories\u002F201931128-Policies-Safety"},{"start":125,"end":132,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"paywall":{"text":"This article has been made free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":56,"end":70,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":138,"end":145,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"unbound":{"text":"This article is free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":45,"end":59,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":127,"end":134,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]}},"COVID_BANNER_POST_ID_OVERRIDE_WHITELIST":["3b31a67bff4a"]},"sharedVoteMessaging":{"TAGS":["politics","election-2020","government","us-politics","election","2020-presidential-race","trump","donald-trump","democrats","republicans","congress","republican-party","democratic-party","biden","joe-biden","maga"],"TOPICS":["politics","election"],"MESSAGE":{"text":"Find out more about the U.S. election results here.","markups":[{"start":46,"end":50,"href":"https:\u002F\u002Fcookpolitical.com\u002F2020-national-popular-vote-tracker"}]},"EXCLUDE_POSTS":["397ef29e3ca5"]},"embedPostRules":[],"recircOptions":{"v1":{"limit":3},"v2":{"limit":8}},"braintreeClientKey":"production_zjkj96jm_m56f8fqpf7ngnrd4","braintree":{"enabled":true,"merchantId":"m56f8fqpf7ngnrd4","merchantAccountId":{"usd":"AMediumCorporation_instant","eur":"amediumcorporation_EUR","cad":"amediumcorporation_CAD"},"publicKey":"ds2nn34bg2z7j5gd","braintreeEnvironment":"production","dashboardUrl":"https:\u002F\u002Fwww.braintreegateway.com\u002Fmerchants","gracePeriodDurationInDays":14,"mediumMembershipPlanId":{"monthly":"ce105f8c57a3","monthlyWithTrial":"d5ee3dbe3db8","yearly":"a40ad4a43185","yearlyStaff":"d74fb811198a","yearlyWithTrial":"b3bc7350e5c7","monthlyCad":"p52orjkaceei","yearlyCad":"h4q9g2up9ktt"},"braintreeDiscountId":{"oneMonthFree":"MONTHS_FREE_01","threeMonthsFree":"MONTHS_FREE_03","sixMonthsFree":"MONTHS_FREE_06"},"3DSecureVersion":"2","defaultCurrency":"usd","providerPlanIdCurrency":{"4ycw":"usd","rz3b":"usd","3kqm":"usd","jzw6":"usd","c2q2":"usd","nnsw":"usd","fx7w":"cad","nwf2":"cad"}},"paypalClientId":"AXj1G4fotC2GE8KzWX9mSxCH1wmPE3nJglf4Z2ig_amnhvlMVX87otaq58niAg9iuLktVNF_1WCMnN7v","paypal":{"host":"https:\u002F\u002Fapi.paypal.com:443","clientMode":"production","serverMode":"live","webhookId":"4G466076A0294510S","monthlyPlan":{"planId":"P-9WR0658853113943TMU5FDQA","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlan":{"planId":"P-7N8963881P8875835MU5JOPQ","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oneYearGift":{"name":"Medium Membership (1 Year, Digital Gift Code)","description":"Unlimited access to the best and brightest stories on Medium. Gift codes can be redeemed at medium.com\u002Fredeem.","price":"50.00","currency":"USD","sku":"membership-gift-1-yr"},"oldMonthlyPlan":{"planId":"P-96U02458LM656772MJZUVH2Y","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlan":{"planId":"P-59P80963JF186412JJZU3SMI","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"monthlyPlanWithTrial":{"planId":"P-66C21969LR178604GJPVKUKY","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlanWithTrial":{"planId":"P-6XW32684EX226940VKCT2MFA","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oldMonthlyPlanNoSetupFee":{"planId":"P-4N046520HR188054PCJC7LJI","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlanNoSetupFee":{"planId":"P-7A4913502Y5181304CJEJMXQ","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"sdkUrl":"https:\u002F\u002Fwww.paypal.com\u002Fsdk\u002Fjs"},"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","log":{"json":true,"level":"info"},"webpRamp":[]},"session":{"xsrf":""}}</script><script>window.__APOLLO_STATE__ = {"ROOT_QUERY":{"__typename":"Query","collectionByDomainOrSlug({\"domainOrSlug\":\"damonvjanis.medium.com\"})":null,"user({\"id\":\"43709c76c449\"})":{"__ref":"User:43709c76c449"},"userResult({\"id\":\"43709c76c449\"})":{"__ref":"User:43709c76c449"},"postResult({\"id\":\"911730f84d3b\"})":{"__ref":"Post:911730f84d3b"}},"User:43709c76c449":{"__typename":"User","id":"43709c76c449","customStyleSheet":null,"name":"Damon Janis","username":"damonvjanis","newsletterV3":{"__ref":"NewsletterV3:415029f5502a"},"imageId":"1*gDcDYew1ntSXqHIkMQs4Dw.jpeg","socialStats":{"__typename":"SocialStats","followerCount":74,"followingCount":16,"collectionFollowingCount":4},"bio":"Elixir dev building for the web with Phoenix","isPartnerProgramEnrolled":false,"viewerEdge":{"__ref":"UserViewerEdge:userId:43709c76c449-viewerId:d9ff562eba7e"},"viewerIsUser":false,"postSubscribeMembershipUpsellShownAt":0,"customDomainState":{"__typename":"CustomDomainState","live":{"__typename":"CustomDomain","domain":"damonvjanis.medium.com","status":"ACTIVE","isSubdomain":true}},"hasSubdomain":true,"mediumMemberAt":0,"about":"","homepagePostsConnection:{\"paging\":{\"limit\":1}}":{"__typename":"PostConnection","posts":[{"__ref":"Post:911730f84d3b"}]},"isSuspended":false,"allowNotes":true,"isAuroraVisible":true,"twitterScreenName":"","atsQualifiedAt":1622643722212},"UserViewerEdge:userId:43709c76c449-viewerId:d9ff562eba7e":{"__typename":"UserViewerEdge","id":"userId:43709c76c449-viewerId:d9ff562eba7e","isFollowing":false,"isUser":false},"NewsletterV3:415029f5502a":{"__typename":"NewsletterV3","id":"415029f5502a","type":"NEWSLETTER_TYPE_AUTHOR","slug":"43709c76c449","name":"43709c76c449","collection":null,"user":{"__ref":"User:43709c76c449"},"description":"","promoHeadline":"","promoBody":"","showPromo":false,"subscribersCount":1},"Post:911730f84d3b":{"__typename":"Post","id":"911730f84d3b","firstPublishedAt":1622637683325,"visibility":"PUBLIC","creator":{"__ref":"User:43709c76c449"},"canonicalUrl":"","collection":null,"content({\"postMeteringOptions\":{\"forceTruncation\":false}})":{"__typename":"PostContent","isLockedPreviewOnly":false,"validatedShareKey":"","bodyModel":{"__typename":"RichText","sections":[{"__typename":"Section","name":"75f2","startIndex":0,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null}],"paragraphs":[{"__ref":"Paragraph:7e76286c3322_0"},{"__ref":"Paragraph:7e76286c3322_1"},{"__ref":"Paragraph:7e76286c3322_2"},{"__ref":"Paragraph:7e76286c3322_3"},{"__ref":"Paragraph:7e76286c3322_4"},{"__ref":"Paragraph:7e76286c3322_5"},{"__ref":"Paragraph:7e76286c3322_6"},{"__ref":"Paragraph:7e76286c3322_7"},{"__ref":"Paragraph:7e76286c3322_8"},{"__ref":"Paragraph:7e76286c3322_9"},{"__ref":"Paragraph:7e76286c3322_10"},{"__ref":"Paragraph:7e76286c3322_11"},{"__ref":"Paragraph:7e76286c3322_12"},{"__ref":"Paragraph:7e76286c3322_13"},{"__ref":"Paragraph:7e76286c3322_14"},{"__ref":"Paragraph:7e76286c3322_15"},{"__ref":"Paragraph:7e76286c3322_16"},{"__ref":"Paragraph:7e76286c3322_17"},{"__ref":"Paragraph:7e76286c3322_18"},{"__ref":"Paragraph:7e76286c3322_19"},{"__ref":"Paragraph:7e76286c3322_20"},{"__ref":"Paragraph:7e76286c3322_21"},{"__ref":"Paragraph:7e76286c3322_22"},{"__ref":"Paragraph:7e76286c3322_23"},{"__ref":"Paragraph:7e76286c3322_24"},{"__ref":"Paragraph:7e76286c3322_25"},{"__ref":"Paragraph:7e76286c3322_26"},{"__ref":"Paragraph:7e76286c3322_27"},{"__ref":"Paragraph:7e76286c3322_28"},{"__ref":"Paragraph:7e76286c3322_29"},{"__ref":"Paragraph:7e76286c3322_30"},{"__ref":"Paragraph:7e76286c3322_31"},{"__ref":"Paragraph:7e76286c3322_32"},{"__ref":"Paragraph:7e76286c3322_33"},{"__ref":"Paragraph:7e76286c3322_34"},{"__ref":"Paragraph:7e76286c3322_35"},{"__ref":"Paragraph:7e76286c3322_36"},{"__ref":"Paragraph:7e76286c3322_37"},{"__ref":"Paragraph:7e76286c3322_38"},{"__ref":"Paragraph:7e76286c3322_39"},{"__ref":"Paragraph:7e76286c3322_40"},{"__ref":"Paragraph:7e76286c3322_41"},{"__ref":"Paragraph:7e76286c3322_42"},{"__ref":"Paragraph:7e76286c3322_43"},{"__ref":"Paragraph:7e76286c3322_44"},{"__ref":"Paragraph:7e76286c3322_45"},{"__ref":"Paragraph:7e76286c3322_46"},{"__ref":"Paragraph:7e76286c3322_47"},{"__ref":"Paragraph:7e76286c3322_48"},{"__ref":"Paragraph:7e76286c3322_49"},{"__ref":"Paragraph:7e76286c3322_50"},{"__ref":"Paragraph:7e76286c3322_51"},{"__ref":"Paragraph:7e76286c3322_52"},{"__ref":"Paragraph:7e76286c3322_53"},{"__ref":"Paragraph:7e76286c3322_54"},{"__ref":"Paragraph:7e76286c3322_55"},{"__ref":"Paragraph:7e76286c3322_56"},{"__ref":"Paragraph:7e76286c3322_57"},{"__ref":"Paragraph:7e76286c3322_58"},{"__ref":"Paragraph:7e76286c3322_59"},{"__ref":"Paragraph:7e76286c3322_60"},{"__ref":"Paragraph:7e76286c3322_61"},{"__ref":"Paragraph:7e76286c3322_62"},{"__ref":"Paragraph:7e76286c3322_63"},{"__ref":"Paragraph:7e76286c3322_64"},{"__ref":"Paragraph:7e76286c3322_65"},{"__ref":"Paragraph:7e76286c3322_66"},{"__ref":"Paragraph:7e76286c3322_67"},{"__ref":"Paragraph:7e76286c3322_68"},{"__ref":"Paragraph:7e76286c3322_69"},{"__ref":"Paragraph:7e76286c3322_70"},{"__ref":"Paragraph:7e76286c3322_71"},{"__ref":"Paragraph:7e76286c3322_72"},{"__ref":"Paragraph:7e76286c3322_73"},{"__ref":"Paragraph:7e76286c3322_74"},{"__ref":"Paragraph:7e76286c3322_75"},{"__ref":"Paragraph:7e76286c3322_76"},{"__ref":"Paragraph:7e76286c3322_77"},{"__ref":"Paragraph:7e76286c3322_78"},{"__ref":"Paragraph:7e76286c3322_79"},{"__ref":"Paragraph:7e76286c3322_80"},{"__ref":"Paragraph:7e76286c3322_81"},{"__ref":"Paragraph:7e76286c3322_82"},{"__ref":"Paragraph:7e76286c3322_83"},{"__ref":"Paragraph:7e76286c3322_84"},{"__ref":"Paragraph:7e76286c3322_85"},{"__ref":"Paragraph:7e76286c3322_86"},{"__ref":"Paragraph:7e76286c3322_87"},{"__ref":"Paragraph:7e76286c3322_88"},{"__ref":"Paragraph:7e76286c3322_89"},{"__ref":"Paragraph:7e76286c3322_90"},{"__ref":"Paragraph:7e76286c3322_91"},{"__ref":"Paragraph:7e76286c3322_92"},{"__ref":"Paragraph:7e76286c3322_93"},{"__ref":"Paragraph:7e76286c3322_94"},{"__ref":"Paragraph:7e76286c3322_95"},{"__ref":"Paragraph:7e76286c3322_96"},{"__ref":"Paragraph:7e76286c3322_97"},{"__ref":"Paragraph:7e76286c3322_98"},{"__ref":"Paragraph:7e76286c3322_99"},{"__ref":"Paragraph:7e76286c3322_100"},{"__ref":"Paragraph:7e76286c3322_101"},{"__ref":"Paragraph:7e76286c3322_102"},{"__ref":"Paragraph:7e76286c3322_103"},{"__ref":"Paragraph:7e76286c3322_104"},{"__ref":"Paragraph:7e76286c3322_105"},{"__ref":"Paragraph:7e76286c3322_106"},{"__ref":"Paragraph:7e76286c3322_107"},{"__ref":"Paragraph:7e76286c3322_108"},{"__ref":"Paragraph:7e76286c3322_109"},{"__ref":"Paragraph:7e76286c3322_110"},{"__ref":"Paragraph:7e76286c3322_111"},{"__ref":"Paragraph:7e76286c3322_112"},{"__ref":"Paragraph:7e76286c3322_113"},{"__ref":"Paragraph:7e76286c3322_114"},{"__ref":"Paragraph:7e76286c3322_115"},{"__ref":"Paragraph:7e76286c3322_116"},{"__ref":"Paragraph:7e76286c3322_117"},{"__ref":"Paragraph:7e76286c3322_118"},{"__ref":"Paragraph:7e76286c3322_119"},{"__ref":"Paragraph:7e76286c3322_120"},{"__ref":"Paragraph:7e76286c3322_121"},{"__ref":"Paragraph:7e76286c3322_122"},{"__ref":"Paragraph:7e76286c3322_123"},{"__ref":"Paragraph:7e76286c3322_124"},{"__ref":"Paragraph:7e76286c3322_125"},{"__ref":"Paragraph:7e76286c3322_126"},{"__ref":"Paragraph:7e76286c3322_127"},{"__ref":"Paragraph:7e76286c3322_128"},{"__ref":"Paragraph:7e76286c3322_129"},{"__ref":"Paragraph:7e76286c3322_130"},{"__ref":"Paragraph:7e76286c3322_131"},{"__ref":"Paragraph:7e76286c3322_132"},{"__ref":"Paragraph:7e76286c3322_133"},{"__ref":"Paragraph:7e76286c3322_134"},{"__ref":"Paragraph:7e76286c3322_135"},{"__ref":"Paragraph:7e76286c3322_136"},{"__ref":"Paragraph:7e76286c3322_137"},{"__ref":"Paragraph:7e76286c3322_138"},{"__ref":"Paragraph:7e76286c3322_139"},{"__ref":"Paragraph:7e76286c3322_140"},{"__ref":"Paragraph:7e76286c3322_141"},{"__ref":"Paragraph:7e76286c3322_142"},{"__ref":"Paragraph:7e76286c3322_143"},{"__ref":"Paragraph:7e76286c3322_144"},{"__ref":"Paragraph:7e76286c3322_145"},{"__ref":"Paragraph:7e76286c3322_146"},{"__ref":"Paragraph:7e76286c3322_147"},{"__ref":"Paragraph:7e76286c3322_148"},{"__ref":"Paragraph:7e76286c3322_149"},{"__ref":"Paragraph:7e76286c3322_150"},{"__ref":"Paragraph:7e76286c3322_151"},{"__ref":"Paragraph:7e76286c3322_152"},{"__ref":"Paragraph:7e76286c3322_153"},{"__ref":"Paragraph:7e76286c3322_154"},{"__ref":"Paragraph:7e76286c3322_155"},{"__ref":"Paragraph:7e76286c3322_156"},{"__ref":"Paragraph:7e76286c3322_157"},{"__ref":"Paragraph:7e76286c3322_158"},{"__ref":"Paragraph:7e76286c3322_159"},{"__ref":"Paragraph:7e76286c3322_160"},{"__ref":"Paragraph:7e76286c3322_161"},{"__ref":"Paragraph:7e76286c3322_162"},{"__ref":"Paragraph:7e76286c3322_163"},{"__ref":"Paragraph:7e76286c3322_164"},{"__ref":"Paragraph:7e76286c3322_165"},{"__ref":"Paragraph:7e76286c3322_166"},{"__ref":"Paragraph:7e76286c3322_167"},{"__ref":"Paragraph:7e76286c3322_168"},{"__ref":"Paragraph:7e76286c3322_169"},{"__ref":"Paragraph:7e76286c3322_170"},{"__ref":"Paragraph:7e76286c3322_171"},{"__ref":"Paragraph:7e76286c3322_172"},{"__ref":"Paragraph:7e76286c3322_173"},{"__ref":"Paragraph:7e76286c3322_174"},{"__ref":"Paragraph:7e76286c3322_175"},{"__ref":"Paragraph:7e76286c3322_176"},{"__ref":"Paragraph:7e76286c3322_177"},{"__ref":"Paragraph:7e76286c3322_178"},{"__ref":"Paragraph:7e76286c3322_179"},{"__ref":"Paragraph:7e76286c3322_180"},{"__ref":"Paragraph:7e76286c3322_181"},{"__ref":"Paragraph:7e76286c3322_182"},{"__ref":"Paragraph:7e76286c3322_183"},{"__ref":"Paragraph:7e76286c3322_184"},{"__ref":"Paragraph:7e76286c3322_185"},{"__ref":"Paragraph:7e76286c3322_186"},{"__ref":"Paragraph:7e76286c3322_187"},{"__ref":"Paragraph:7e76286c3322_188"},{"__ref":"Paragraph:7e76286c3322_189"},{"__ref":"Paragraph:7e76286c3322_190"},{"__ref":"Paragraph:7e76286c3322_191"},{"__ref":"Paragraph:7e76286c3322_192"},{"__ref":"Paragraph:7e76286c3322_193"},{"__ref":"Paragraph:7e76286c3322_194"},{"__ref":"Paragraph:7e76286c3322_195"},{"__ref":"Paragraph:7e76286c3322_196"},{"__ref":"Paragraph:7e76286c3322_197"},{"__ref":"Paragraph:7e76286c3322_198"},{"__ref":"Paragraph:7e76286c3322_199"},{"__ref":"Paragraph:7e76286c3322_200"},{"__ref":"Paragraph:7e76286c3322_201"},{"__ref":"Paragraph:7e76286c3322_202"},{"__ref":"Paragraph:7e76286c3322_203"},{"__ref":"Paragraph:7e76286c3322_204"},{"__ref":"Paragraph:7e76286c3322_205"},{"__ref":"Paragraph:7e76286c3322_206"},{"__ref":"Paragraph:7e76286c3322_207"},{"__ref":"Paragraph:7e76286c3322_208"},{"__ref":"Paragraph:7e76286c3322_209"},{"__ref":"Paragraph:7e76286c3322_210"},{"__ref":"Paragraph:7e76286c3322_211"},{"__ref":"Paragraph:7e76286c3322_212"},{"__ref":"Paragraph:7e76286c3322_213"},{"__ref":"Paragraph:7e76286c3322_214"},{"__ref":"Paragraph:7e76286c3322_215"},{"__ref":"Paragraph:7e76286c3322_216"},{"__ref":"Paragraph:7e76286c3322_217"},{"__ref":"Paragraph:7e76286c3322_218"},{"__ref":"Paragraph:7e76286c3322_219"},{"__ref":"Paragraph:7e76286c3322_220"},{"__ref":"Paragraph:7e76286c3322_221"},{"__ref":"Paragraph:7e76286c3322_222"},{"__ref":"Paragraph:7e76286c3322_223"},{"__ref":"Paragraph:7e76286c3322_224"},{"__ref":"Paragraph:7e76286c3322_225"},{"__ref":"Paragraph:7e76286c3322_226"},{"__ref":"Paragraph:7e76286c3322_227"},{"__ref":"Paragraph:7e76286c3322_228"},{"__ref":"Paragraph:7e76286c3322_229"},{"__ref":"Paragraph:7e76286c3322_230"},{"__ref":"Paragraph:7e76286c3322_231"},{"__ref":"Paragraph:7e76286c3322_232"},{"__ref":"Paragraph:7e76286c3322_233"},{"__ref":"Paragraph:7e76286c3322_234"},{"__ref":"Paragraph:7e76286c3322_235"},{"__ref":"Paragraph:7e76286c3322_236"},{"__ref":"Paragraph:7e76286c3322_237"},{"__ref":"Paragraph:7e76286c3322_238"},{"__ref":"Paragraph:7e76286c3322_239"},{"__ref":"Paragraph:7e76286c3322_240"},{"__ref":"Paragraph:7e76286c3322_241"},{"__ref":"Paragraph:7e76286c3322_242"},{"__ref":"Paragraph:7e76286c3322_243"},{"__ref":"Paragraph:7e76286c3322_244"},{"__ref":"Paragraph:7e76286c3322_245"},{"__ref":"Paragraph:7e76286c3322_246"},{"__ref":"Paragraph:7e76286c3322_247"},{"__ref":"Paragraph:7e76286c3322_248"},{"__ref":"Paragraph:7e76286c3322_249"},{"__ref":"Paragraph:7e76286c3322_250"},{"__ref":"Paragraph:7e76286c3322_251"},{"__ref":"Paragraph:7e76286c3322_252"},{"__ref":"Paragraph:7e76286c3322_253"},{"__ref":"Paragraph:7e76286c3322_254"},{"__ref":"Paragraph:7e76286c3322_255"},{"__ref":"Paragraph:7e76286c3322_256"},{"__ref":"Paragraph:7e76286c3322_257"},{"__ref":"Paragraph:7e76286c3322_258"},{"__ref":"Paragraph:7e76286c3322_259"},{"__ref":"Paragraph:7e76286c3322_260"},{"__ref":"Paragraph:7e76286c3322_261"},{"__ref":"Paragraph:7e76286c3322_262"},{"__ref":"Paragraph:7e76286c3322_263"},{"__ref":"Paragraph:7e76286c3322_264"},{"__ref":"Paragraph:7e76286c3322_265"},{"__ref":"Paragraph:7e76286c3322_266"},{"__ref":"Paragraph:7e76286c3322_267"},{"__ref":"Paragraph:7e76286c3322_268"},{"__ref":"Paragraph:7e76286c3322_269"},{"__ref":"Paragraph:7e76286c3322_270"}]}},"customStyleSheet":null,"isPublished":true,"isLocked":false,"license":"ALL_RIGHTS_RESERVED","collaborators":[],"isMarkedPaywallOnly":false,"lockedSource":"LOCKED_POST_SOURCE_NONE","mediumUrl":"https:\u002F\u002Fdamonvjanis.medium.com\u002Farchive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b","primaryTopic":{"__ref":"Topic:55f1c20aba7a"},"topics":[{"__typename":"Topic","slug":"software-engineering","name":"Software Engineering"},{"__typename":"Topic","slug":"programming","name":"Programming"}],"latestPublishedVersion":"7e76286c3322","postResponses":{"__typename":"PostResponses","count":0},"allowResponses":true,"isLimitedState":false,"voterCount":5,"recommenders":[],"title":"(Archive) Phoenix Deployments on GCP with Nginx","clapCount":52,"statusForCollection":null,"pinnedAt":0,"pinnedByCreatorAt":0,"curationEligibleAt":0,"responseDistribution":"NOT_DISTRIBUTED","inResponseToPostResult":null,"inResponseToCatalogResult":null,"pendingCollection":null,"isNewsletter":false,"isAuthorNewsletter":false,"layerCake":3,"tags":[{"__ref":"Tag:elixir"},{"__ref":"Tag:phoenix-framework"},{"__ref":"Tag:software-development"},{"__ref":"Tag:deployment"}],"sequence":null,"readingTime":24.987106918238993,"inResponseToEntityType":null,"isSeries":false,"uniqueSlug":"archive-phoenix-deployments-on-gcp-with-nginx-911730f84d3b","socialTitle":"","socialDek":"","noIndex":null,"curationStatus":"CURATION_STATUS_DISTRIBUTED","metaDescription":"","latestPublishedAt":1623501220779,"previewContent":{"__typename":"PreviewContent","subtitle":"Another way to deploy Elixir apps"},"previewImage":{"__ref":"ImageMetadata:1*bVu7g4dHlgtGYO78RWMi9g.jpeg"},"isShortform":false,"seoTitle":"","updatedAt":1653429247377,"shortformType":"SHORTFORM_TYPE_LINK","seoDescription":"","isIndexable":true,"isSuspended":false,"responseRootPost":{"__typename":"ResponseRootPost","post":{"__ref":"Post:911730f84d3b"}},"internalLinks({\"paging\":{\"limit\":8}})":{"__typename":"InternalLinksConnection","items":[{"__ref":"Post:18122decbf"},{"__ref":"Post:508a90ff7d8a"},{"__ref":"Post:8a799d98a82d"},{"__ref":"Post:cf297ba58afd"},{"__ref":"Post:e59a3492c7ed"},{"__ref":"Post:bc0b08312fa"},{"__ref":"Post:adc4f602d08f"},{"__ref":"Post:af4eaec75b8b"}]},"awards:countToShowAwardBadge(type:STAFF_PICK,limit:1)":{"__typename":"AwardConnection","totalCount":0,"awards":[]}},"Topic:55f1c20aba7a":{"__typename":"Topic","slug":"software-engineering","id":"55f1c20aba7a","name":"Software Engineering"},"Paragraph:7e76286c3322_0":{"__typename":"Paragraph","id":"7e76286c3322_0","name":"2e9b","type":"H3","href":null,"layout":null,"metadata":null,"text":"(Archive) Phoenix Deployments on GCP with Nginx","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*bVu7g4dHlgtGYO78RWMi9g.jpeg":{"__typename":"ImageMetadata","id":"1*bVu7g4dHlgtGYO78RWMi9g.jpeg","originalHeight":3648,"originalWidth":5472,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:7e76286c3322_1":{"__typename":"Paragraph","id":"7e76286c3322_1","name":"9b64","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*bVu7g4dHlgtGYO78RWMi9g.jpeg"},"text":"Kubernetes (kidding) — Photo credit Jp Valery on Unsplash","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":36,"end":45,"href":"https:\u002F\u002Funsplash.com\u002F@jpvalery?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":49,"end":57,"href":"https:\u002F\u002Funsplash.com\u002Fs\u002Fphotos\u002Fburning-cash?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_2":{"__typename":"Paragraph","id":"7e76286c3322_2","name":"2dcc","type":"H4","href":null,"layout":null,"metadata":null,"text":"Another way to deploy Elixir apps","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_3":{"__typename":"Paragraph","id":"7e76286c3322_3","name":"4dba","type":"P","href":null,"layout":null,"metadata":null,"text":"There are A LOT of different ways to deploy Elixir\u002FPhoenix applications. I want to fill a gap in the current literature: how do you deploy a Phoenix web app to a single Linux server optimizing for cost effectiveness, control, and simplicity, while using modern Elixir tools like releases to achieve zero-downtime deploys without hot code upgrading?","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":10,"end":11,"href":"https:\u002F\u002Falchemist.camp\u002Farticles\u002Felixir-releases-deployment-render","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":12,"end":15,"href":"https:\u002F\u002Fwww.cogini.com\u002Fblog\u002Fbest-practices-for-deploying-elixir-apps\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":16,"end":18,"href":"https:\u002F\u002Fhashrocket.com\u002Fblog\u002Fposts\u002Fautomate-your-elixir-deployments-part-1-ansible","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":19,"end":28,"href":"https:\u002F\u002Fhashrocket.com\u002Fblog\u002Fposts\u002Fautomate-your-elixir-deployments-part-2-distillery-edeliver","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":29,"end":33,"href":"https:\u002F\u002Fdev.to\u002Fjonlunsford\u002Fdeploying-elixir-1-of-3-building-releases-with-mix-1o4a","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":34,"end":36,"href":"https:\u002F\u002Fblog.carbonfive.com\u002Fhow-to-deploy-elixir-releases-with-ansible\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":37,"end":43,"href":"https:\u002F\u002Fblog.carbonfive.com\u002Fcross-platform-elixir-releases-with-docker\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":44,"end":58,"href":"https:\u002F\u002Fwww.digitalocean.com\u002Fcommunity\u002Ftutorials\u002Fhow-to-automate-elixir-phoenix-deployment-with-distillery-and-edeliver-on-ubuntu-16-04","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":59,"end":71,"href":"https:\u002F\u002Fcloud.google.com\u002Fcommunity\u002Ftutorials\u002Felixir-phoenix-on-kubernetes-google-container-engine","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_4":{"__typename":"Paragraph","id":"7e76286c3322_4","name":"47b3","type":"PQ","href":null,"layout":null,"metadata":null,"text":"I’m going to walk through a deployment strategy that can take you start-to-finish with a full-featured Phoenix web app running on a free-forever Google Cloud Platform Compute Engine instance.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":145,"end":190,"href":"https:\u002F\u002Fcloud.google.com\u002Ffree","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_5":{"__typename":"Paragraph","id":"7e76286c3322_5","name":"356f","type":"P","href":null,"layout":null,"metadata":null,"text":"This setup is completely free, and when you have more traffic the cost of scaling on raw GCP instances is a lot cheaper than on platform-as-a-service offerings (Heroku, Gigalixir, Render, etc). And, you’re in full control of the system so you don’t have to work around any fixed limitations. Scaling can be as simple as upgrading the specs of the instance when it can’t keep up anymore.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":161,"end":167,"href":"https:\u002F\u002Fhexdocs.pm\u002Fphoenix\u002Fheroku.html#content","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":169,"end":178,"href":"https:\u002F\u002Fhexdocs.pm\u002Fphoenix\u002Fgigalixir.html#content","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":180,"end":186,"href":"https:\u002F\u002Frender.com\u002Fdocs\u002Fdeploy-phoenix","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_6":{"__typename":"Paragraph","id":"7e76286c3322_6","name":"af5a","type":"BQ","href":null,"layout":null,"metadata":null,"text":"My heretical belief is that the biggest risk to the reliability \u002F availability of your app is developers changing code and running tasks, NOT the remote chance of hardware failure. Don’t be dumb — back up your database. But otherwise, the biggest way to reduce infrastructure-related downtime is keeping your server environment and deployment processes dead simple and fast so that devs won’t make mistakes and can restore things quickly when they do.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":369,"end":373,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_7":{"__typename":"Paragraph","id":"7e76286c3322_7","name":"5475","type":"P","href":null,"layout":null,"metadata":null,"text":"One of the great things about Elixir and Phoenix is that you can get a LOT of milage out of very limited hardware, so there’s a good chance that your hosting with this strategy will stay free for a very long time, and incredibly cheap for even longer. And it will be wicked fast, reliable, and observable.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":69,"end":113,"href":"https:\u002F\u002Fwww.cogini.com\u002Fblog\u002Fbenchmarking-phoenix-on-digital-ocean\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_8":{"__typename":"Paragraph","id":"7e76286c3322_8","name":"6769","type":"H4","href":null,"layout":null,"metadata":null,"text":"What we’re optimizing for","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_9":{"__typename":"Paragraph","id":"7e76286c3322_9","name":"5778","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Absolutely 100% free to start, cheap to scale","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_10":{"__typename":"Paragraph","id":"7e76286c3322_10","name":"48d9","type":"ULI","href":null,"layout":null,"metadata":null,"text":"No Docker, Ansible, Distillery, or other build\u002Fdeploy tools","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_11":{"__typename":"Paragraph","id":"7e76286c3322_11","name":"f346","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Single server setup","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_12":{"__typename":"Paragraph","id":"7e76286c3322_12","name":"d7c2","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Fault-tolerant at server level, e.g. if the server crashes or restarts the app will come back up automatically","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_13":{"__typename":"Paragraph","id":"7e76286c3322_13","name":"142d","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Secure (enough, this can be an infinite rabbit hole)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_14":{"__typename":"Paragraph","id":"7e76286c3322_14","name":"a9cd","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Fast no-downtime deployments and rollbacks, without hot code reloading","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":0,"end":4,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_15":{"__typename":"Paragraph","id":"7e76286c3322_15","name":"e5e0","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Full control and visibility, leveraging raw Linux built-in tools","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_16":{"__typename":"Paragraph","id":"7e76286c3322_16","name":"b5c5","type":"H4","href":null,"layout":null,"metadata":null,"text":"Free without the compromises (except your time of course)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_17":{"__typename":"Paragraph","id":"7e76286c3322_17","name":"f574","type":"P","href":null,"layout":null,"metadata":null,"text":"I really like the level of control and flexibility that this approach provides. You’ll end up feeling a lot more comfortable with the raw basics of how your server runs and how to hook in and introspect when there are problems. It takes some time to set up, and there might be some new Linux skills that you’ll need to pick up along the way. This is a long guide, but stick with me and I think you’ll be really happy with the result! (or bookmark it and come back the next time you need to spin up a side project)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_18":{"__typename":"Paragraph","id":"7e76286c3322_18","name":"0d29","type":"H4","href":null,"layout":null,"metadata":null,"text":"Overview","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_19":{"__typename":"Paragraph","id":"7e76286c3322_19","name":"bb2d","type":"BQ","href":null,"layout":null,"metadata":null,"text":"This is a quick outline of what we’ll be doing, so you can decide whether it looks interesting before we get into the weeds.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_20":{"__typename":"Paragraph","id":"7e76286c3322_20","name":"619f","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Get a domain","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_21":{"__typename":"Paragraph","id":"7e76286c3322_21","name":"706c","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Log into Google Cloud Platform and provision an F1-Micro Compute Engine instance","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_22":{"__typename":"Paragraph","id":"7e76286c3322_22","name":"6439","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Make the IP address of the instance static","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_23":{"__typename":"Paragraph","id":"7e76286c3322_23","name":"1ec2","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Add your SSH key to metadata in Compute Engine settings so you can connect to the instance","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_24":{"__typename":"Paragraph","id":"7e76286c3322_24","name":"8495","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Set up an ssh alias on your dev machine so it’s easy to access the server","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_25":{"__typename":"Paragraph","id":"7e76286c3322_25","name":"ae77","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Enable swap memory on the instance","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_26":{"__typename":"Paragraph","id":"7e76286c3322_26","name":"85a7","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Install Erlang, Elixir, Node, and Postgres","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_27":{"__typename":"Paragraph","id":"7e76286c3322_27","name":"932d","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Set a secure password for Postgres","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_28":{"__typename":"Paragraph","id":"7e76286c3322_28","name":"171c","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Configure Postgres to allow remote connections","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_29":{"__typename":"Paragraph","id":"7e76286c3322_29","name":"8cd0","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Connect to your remote Git repo where your project lives","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_30":{"__typename":"Paragraph","id":"7e76286c3322_30","name":"1778","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Get your app secrets onto the server","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_31":{"__typename":"Paragraph","id":"7e76286c3322_31","name":"c7cb","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Install Nginx + Certbot for SSL","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_32":{"__typename":"Paragraph","id":"7e76286c3322_32","name":"9b5a","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Configure Nginx to reverse proxy requests to your app","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_33":{"__typename":"Paragraph","id":"7e76286c3322_33","name":"8d8e","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Build a deployment shell script for some basic CI checks and allowing incremental release versions and no-downtime deployments","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_34":{"__typename":"Paragraph","id":"7e76286c3322_34","name":"4ee8","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Create systemd services to ensure app starts up if server crashes and resets","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_35":{"__typename":"Paragraph","id":"7e76286c3322_35","name":"14a3","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Commit and push a change. Then deploy using a single command on your dev machine!","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_36":{"__typename":"Paragraph","id":"7e76286c3322_36","name":"e8d7","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Attach to journald to watch logs","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_37":{"__typename":"Paragraph","id":"7e76286c3322_37","name":"2961","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Bonus 1: Secure your data against the possibility of eventual hardware failure by creating another Google account with a free instance and set up automated backups using cron","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_38":{"__typename":"Paragraph","id":"7e76286c3322_38","name":"c831","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Bonus 2: Rollback script","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_39":{"__typename":"Paragraph","id":"7e76286c3322_39","name":"a79a","type":"H3","href":null,"layout":null,"metadata":null,"text":"The Details!","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_40":{"__typename":"Paragraph","id":"7e76286c3322_40","name":"5a19","type":"H4","href":null,"layout":null,"metadata":null,"text":"1 — Get a domain","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_41":{"__typename":"Paragraph","id":"7e76286c3322_41","name":"d645","type":"P","href":null,"layout":null,"metadata":null,"text":"If you want this whole thing to be super free, you can get a domain from https:\u002F\u002Ffreenom.com and get a full-fledged domain with DNS and the works for free. The downside is that you’re limited to one of five super random top level domains (.ml, .gq etc), but it’s a great way to get the name you want before committing the cash to buy the .com version. Once you have a domain, go to the DNS settings page — we’ll be adding some records later on.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":239,"end":242,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":244,"end":247,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":338,"end":342,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":73,"end":92,"href":"https:\u002F\u002Ffreenom.com","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":35,"end":45,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_42":{"__typename":"Paragraph","id":"7e76286c3322_42","name":"449f","type":"H4","href":null,"layout":null,"metadata":null,"text":"2 — Provision an F1-Micro Compute Engine instance","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_43":{"__typename":"Paragraph","id":"7e76286c3322_43","name":"4e0b","type":"P","href":null,"layout":null,"metadata":null,"text":"You can access the Google Cloud Platform console using any Google account you own (typically a Gmail address). For the sake of separation (and security), I like to create a new gmail address with the name of my project in it so that the account is fully isolated (e.g. damon.my.app@gmail.com).","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":269,"end":291,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":19,"end":48,"href":"https:\u002F\u002Fconsole.cloud.google.com\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_44":{"__typename":"Paragraph","id":"7e76286c3322_44","name":"e225","type":"P","href":null,"layout":null,"metadata":null,"text":"If you access the console with a new account, you may need to activate the free trial before it will let you do much. Go ahead and activate it, and put in a card if prompted. Don’t worry — you won’t be charged for this server even after the trial runs out.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_45":{"__typename":"Paragraph","id":"7e76286c3322_45","name":"5eca","type":"P","href":null,"layout":null,"metadata":null,"text":"Once you’re in the console, click on the top-left menu icon and then select Compute Engine -\u003E VM Instances. If it’s your first time, it may take a minute to start. When it’s ready, click the “Create” button. Configure with the following options and then create:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":76,"end":106,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_46":{"__typename":"Paragraph","id":"7e76286c3322_46","name":"0df8","type":"PRE","href":null,"layout":null,"metadata":null,"text":"Name: whatever you want\nRegion: double check https:\u002F\u002Fcloud.google.com\u002Ffree to make sure the region you want is listed in the Compute Engine section\nSeries: N1\nMachine Type: f1-micro\nBoot Disk: \n  Operating System: Ubuntu\n  Version: 20.04 LTS\n  Boot Disk Type: Standard persistent disk, 30GB\nFirewall: allow both HTTP and HTTPS traffic","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":45,"end":74,"href":"https:\u002F\u002Fcloud.google.com\u002Ffree","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":5,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":24,"end":31,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":148,"end":155,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":158,"end":172,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":182,"end":192,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":196,"end":213,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":223,"end":231,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":244,"end":259,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":291,"end":300,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_47":{"__typename":"Paragraph","id":"7e76286c3322_47","name":"2a39","type":"H4","href":null,"layout":null,"metadata":null,"text":"3 — Make the IP address of the instance static","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_48":{"__typename":"Paragraph","id":"7e76286c3322_48","name":"79de","type":"P","href":null,"layout":null,"metadata":null,"text":"Click the triple lines icon in the top left to bring up the menu, then go to VPC Network -\u003E External IP addresses. There should be a single row, belonging to the instance you just created. Change the Type from “ephemeral” to “static” and give it a name of your choosing. Copy the IP address (should look something like 34.69.61.31), since you’ll need it in the next steps.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":319,"end":330,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":200,"end":204,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":77,"end":113,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_49":{"__typename":"Paragraph","id":"7e76286c3322_49","name":"aae7","type":"P","href":null,"layout":null,"metadata":null,"text":"In the DNS settings for your domain, create A records for both \u003Cyour_domain\u003E.com and www.\u003Cyour_domain\u003E.com that point to that IP address.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":44,"end":45,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":63,"end":80,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":85,"end":106,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_50":{"__typename":"Paragraph","id":"7e76286c3322_50","name":"c63d","type":"H4","href":null,"layout":null,"metadata":null,"text":"4 — Add your SSH key","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_51":{"__typename":"Paragraph","id":"7e76286c3322_51","name":"21fe","type":"P","href":null,"layout":null,"metadata":null,"text":"Click the triple lines icon again in the top left and go to Compute Engine -\u003E Metadata. Click on the tab SSH Keys. Then click the “Add SSH Keys” button.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":105,"end":113,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":60,"end":86,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_52":{"__typename":"Paragraph","id":"7e76286c3322_52","name":"e01e","type":"P","href":null,"layout":null,"metadata":null,"text":"To get an SSH key from your dev machine to paste into the field, run cat ~\u002F.ssh\u002Fid_rsa.pub in your local terminal. If you don’t get output, create an ssh key by following these instructions and then run the command again and paste the result into the field in GCP and hit “Save”.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":69,"end":90,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":171,"end":189,"href":"https:\u002F\u002Fwww.digitalocean.com\u002Fdocs\u002Fdroplets\u002Fhow-to\u002Fadd-ssh-keys\u002Fcreate-with-openssh\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_53":{"__typename":"Paragraph","id":"7e76286c3322_53","name":"45e8","type":"H4","href":null,"layout":null,"metadata":null,"text":"5 — Set up SSH alias","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_54":{"__typename":"Paragraph","id":"7e76286c3322_54","name":"ebc8","type":"P","href":null,"layout":null,"metadata":null,"text":"To connect to the server, we could run ssh \u003CIP Address from step 3\u003E, but it’s going to get tiresome to type in the IP all the time (especially if you have lots of these servers). So instead, we’ll set up an alias so that we can type in ssh my_app and have it connect automatically.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":39,"end":67,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":236,"end":246,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_55":{"__typename":"Paragraph","id":"7e76286c3322_55","name":"a3ce","type":"P","href":null,"layout":null,"metadata":null,"text":"On your dev machine, enter vim ~\u002F.ssh\u002Fconfig (which will create or open the file). Put the following code in the file, making sure that the first block goes at the very top before anything else already in there, and that the second block goes at the very bottom below anything else:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":27,"end":44,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_56":{"__typename":"Paragraph","id":"7e76286c3322_56","name":"543e","type":"PRE","href":null,"layout":null,"metadata":null,"text":"Host my_app\n Hostname \u003CIP address from step 3\u003E\n User \u003Cyour local user name\u003E","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":22,"end":46,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_57":{"__typename":"Paragraph","id":"7e76286c3322_57","name":"f010","type":"PRE","href":null,"layout":null,"metadata":null,"text":"Host *\n AddKeysToAgent yes\n UseKeychain yes\n IdentityFile ~\u002F.ssh\u002Fid_rsa","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_58":{"__typename":"Paragraph","id":"7e76286c3322_58","name":"7049","type":"BQ","href":null,"layout":null,"metadata":null,"text":"Note: if you aren’t familiar with vim, just use the arrow keys to navigate and learn how to switch between insert mode and command mode, and saving and exiting.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":34,"end":37,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":79,"end":159,"href":"https:\u002F\u002Fcoderwall.com\u002Fp\u002Fadv71w\u002Fbasic-vim-commands-for-getting-started","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":34,"end":37,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_59":{"__typename":"Paragraph","id":"7e76286c3322_59","name":"48a8","type":"P","href":null,"layout":null,"metadata":null,"text":"Replace the IP and user with your info and remove the comments. Save and quit, and now you should be able to connect to your server with the command ssh my_app. Nice! If you connect successfully to the instance, congrats! You’re now connected and in full control of your free server. If you didn’t connect successfully, you may need to look up how to add your ssh key to ssh-agent.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":149,"end":159,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":371,"end":380,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_60":{"__typename":"Paragraph","id":"7e76286c3322_60","name":"a831","type":"P","href":null,"layout":null,"metadata":null,"text":"When you added your key to the metadata, a Linux user account was created on the server that matches the name of your local user account. This user has sudo privileges, isn’t the root user, and is passwordless (can only be accessed with the SSH keys in metadata), all of which make this user a pretty good choice for the user account responsible for deploying the app. Assuming you’re the only developer deploying code for now this setup is plenty secure, but as you add developers and complexity you might think about creating a dedicated user for deployment with more restricted permissions.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":152,"end":156,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_61":{"__typename":"Paragraph","id":"7e76286c3322_61","name":"dac5","type":"H4","href":null,"layout":null,"metadata":null,"text":"6 — Enable swap memory on the instance","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_62":{"__typename":"Paragraph","id":"7e76286c3322_62","name":"1164","type":"P","href":null,"layout":null,"metadata":null,"text":"This server is TINY — it only has .6GB of RAM. When you compile a Phoenix application on it for the first time on it, there’s a good chance that it will freeze up on you by running out of resources. But, since we get a 30GB spinner for free along with it, we can safely enable swap memory which will allow the server to push past the limit (albeit with slower memory) once it exceeds available RAM. To create 1GB of swap space, run the following on the server:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":263,"end":288,"href":"https:\u002F\u002Fwww.digitalocean.com\u002Fcommunity\u002Ftutorials\u002Fhow-to-add-swap-space-on-ubuntu-20-04","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_63":{"__typename":"Paragraph","id":"7e76286c3322_63","name":"b856","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo fallocate -l 1G \u002Fswapfile","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_64":{"__typename":"Paragraph","id":"7e76286c3322_64","name":"386c","type":"P","href":null,"layout":null,"metadata":null,"text":"Next make sure the file can only be read by the root user:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_65":{"__typename":"Paragraph","id":"7e76286c3322_65","name":"a7ea","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo chmod 600 \u002Fswapfile","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_66":{"__typename":"Paragraph","id":"7e76286c3322_66","name":"880a","type":"P","href":null,"layout":null,"metadata":null,"text":"Next we’ll mark the file as swap:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_67":{"__typename":"Paragraph","id":"7e76286c3322_67","name":"0446","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo mkswap \u002Fswapfile","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_68":{"__typename":"Paragraph","id":"7e76286c3322_68","name":"145b","type":"P","href":null,"layout":null,"metadata":null,"text":"And enable it:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_69":{"__typename":"Paragraph","id":"7e76286c3322_69","name":"0f43","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo swapon \u002Fswapfile","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_70":{"__typename":"Paragraph","id":"7e76286c3322_70","name":"c1b8","type":"P","href":null,"layout":null,"metadata":null,"text":"And make it permanent to survive restarts:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_71":{"__typename":"Paragraph","id":"7e76286c3322_71","name":"5a0c","type":"PRE","href":null,"layout":null,"metadata":null,"text":"echo ‘\u002Fswapfile none swap sw 0 0’ | sudo tee -a \u002Fetc\u002Ffstab","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_72":{"__typename":"Paragraph","id":"7e76286c3322_72","name":"c411","type":"P","href":null,"layout":null,"metadata":null,"text":"To verify that it worked, run the handy command top which will give you a little dashboard of the resource consumption on the server. You should see a line like the following: MiB Swap: 1024.0 total. Press ctrl+c to exit.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":48,"end":51,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":176,"end":198,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_73":{"__typename":"Paragraph","id":"7e76286c3322_73","name":"6c56","type":"P","href":null,"layout":null,"metadata":null,"text":"There is a lot to learn about swap, and if you want to read more you can start here. These commands and the default configuration that comes with them are fine for our purposes here.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":73,"end":83,"href":"https:\u002F\u002Fwww.digitalocean.com\u002Fcommunity\u002Ftutorials\u002Fhow-to-add-swap-space-on-ubuntu-20-04","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_74":{"__typename":"Paragraph","id":"7e76286c3322_74","name":"f84e","type":"H4","href":null,"layout":null,"metadata":null,"text":"7 — Install Erlang, Elixir, Node, and Postgres","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_75":{"__typename":"Paragraph","id":"7e76286c3322_75","name":"c3b0","type":"P","href":null,"layout":null,"metadata":null,"text":"In case these instructions get stale, follow the official Elixir install guide for Ubuntu here. Install Erlang and Elixir using the following:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":49,"end":94,"href":"https:\u002F\u002Felixir-lang.org\u002Finstall.html","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_76":{"__typename":"Paragraph","id":"7e76286c3322_76","name":"bc87","type":"PRE","href":null,"layout":null,"metadata":null,"text":"wget https:\u002F\u002Fpackages.erlang-solutions.com\u002Ferlang-solutions_2.0_all.deb && sudo dpkg -i erlang-solutions_2.0_all.deb","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":5,"end":71,"href":"https:\u002F\u002Fpackages.erlang-solutions.com\u002Ferlang-solutions_2.0_all.deb","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_77":{"__typename":"Paragraph","id":"7e76286c3322_77","name":"7342","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo apt update","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_78":{"__typename":"Paragraph","id":"7e76286c3322_78","name":"db5a","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo apt install esl-erlang","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_79":{"__typename":"Paragraph","id":"7e76286c3322_79","name":"6496","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo apt install elixir","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_80":{"__typename":"Paragraph","id":"7e76286c3322_80","name":"cc1f","type":"P","href":null,"layout":null,"metadata":null,"text":"Now let’s get Node and NPM:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_81":{"__typename":"Paragraph","id":"7e76286c3322_81","name":"a89d","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo apt install nodejs npm","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_82":{"__typename":"Paragraph","id":"7e76286c3322_82","name":"08e4","type":"P","href":null,"layout":null,"metadata":null,"text":"And now Postgres:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_83":{"__typename":"Paragraph","id":"7e76286c3322_83","name":"b9b7","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo apt install postgresql postgresql-contrib","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_84":{"__typename":"Paragraph","id":"7e76286c3322_84","name":"951d","type":"H4","href":null,"layout":null,"metadata":null,"text":"8 — Set a secure password for Postgres","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_85":{"__typename":"Paragraph","id":"7e76286c3322_85","name":"3f5d","type":"P","href":null,"layout":null,"metadata":null,"text":"Now that Postgres is installed, we’ll want to change the password to something secure. Later, we’ll be opening the database port on the server to the web (alert: security tradeoff!), so the password has to be rock solid. Generate a random password with a tool like https:\u002F\u002Fpasswordsgenerator.net and paste it into a safe place. Log into Postgres with the default postgres user:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":264,"end":295,"href":"https:\u002F\u002Fpasswordsgenerator.net","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_86":{"__typename":"Paragraph","id":"7e76286c3322_86","name":"3851","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo -u postgres psql","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_87":{"__typename":"Paragraph","id":"7e76286c3322_87","name":"53c6","type":"P","href":null,"layout":null,"metadata":null,"text":"And update the password:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_88":{"__typename":"Paragraph","id":"7e76286c3322_88","name":"bff2","type":"PRE","href":null,"layout":null,"metadata":null,"text":"\\password postgres","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_89":{"__typename":"Paragraph","id":"7e76286c3322_89","name":"d61a","type":"PRE","href":null,"layout":null,"metadata":null,"text":"(paste the password you generated and hit enter)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_90":{"__typename":"Paragraph","id":"7e76286c3322_90","name":"feb6","type":"PRE","href":null,"layout":null,"metadata":null,"text":"(now put \\q and hit enter to quit)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_91":{"__typename":"Paragraph","id":"7e76286c3322_91","name":"a53b","type":"H4","href":null,"layout":null,"metadata":null,"text":"9 — Configure Postgres to allow remote connections","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_92":{"__typename":"Paragraph","id":"7e76286c3322_92","name":"4d3d","type":"P","href":null,"layout":null,"metadata":null,"text":"It’s often helpful to be able to access your database with a GUI on your development machine. I use Postico, but TablePlus and pgAdmin work great too. But before you can use one of these to connect to your database, you’ll need to adjust the firewall in GCP and alter some Postgres settings to open the database port (5432) to the outside world.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":318,"end":322,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":100,"end":107,"href":"https:\u002F\u002Feggerapps.at\u002Fpostico\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":113,"end":122,"href":"https:\u002F\u002Ftableplus.com","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":127,"end":134,"href":"https:\u002F\u002Fwww.pgadmin.org","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_93":{"__typename":"Paragraph","id":"7e76286c3322_93","name":"b64e","type":"P","href":null,"layout":null,"metadata":null,"text":"Back in the GCP console, open the navigation menu and go to VPC network -\u003E Firewall. Click the “Create Firewall Rule” button up top. Alter the following settings and click “Create”:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":60,"end":83,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_94":{"__typename":"Paragraph","id":"7e76286c3322_94","name":"1bdc","type":"PRE","href":null,"layout":null,"metadata":null,"text":"Name: whatever you want, something like \"database\"\nTargets: All instances in the network\nSource IP Ranges: 0.0.0.0\u002F0\ntcp: Check box, and enter 5432 in field","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":5,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":50,"end":59,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":89,"end":106,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":117,"end":121,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_95":{"__typename":"Paragraph","id":"7e76286c3322_95","name":"29ec","type":"P","href":null,"layout":null,"metadata":null,"text":"Security note: the more secure way to open the firewall is to restrict the Targets to just your instance so you don’t add instances later without remembering the port is open by default on all of them now. Also you could restrict the Source IP Ranges to just your own IP or the IP of a VPN that you can access, so that the port is only open to you (instead of the whole internet). However, if your Postgres password is secure and your database doesn’t hold extremely sensitive data, this configuration will probably be fine till you’re ready to really tighten security as you scale.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":75,"end":82,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":234,"end":250,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_96":{"__typename":"Paragraph","id":"7e76286c3322_96","name":"68be","type":"P","href":null,"layout":null,"metadata":null,"text":"Now we’ll open up the Postgres server itself to allow connections beyondlocalhost. Find your postgresql.conf file by running:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":72,"end":81,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":93,"end":108,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_97":{"__typename":"Paragraph","id":"7e76286c3322_97","name":"330f","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo find \u002F -name \"postgresql.conf\"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_98":{"__typename":"Paragraph","id":"7e76286c3322_98","name":"4597","type":"P","href":null,"layout":null,"metadata":null,"text":"Mine is at \u002Fetc\u002Fpostgresql\u002F12\u002Fmain\u002Fpostgresql.conf","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":11,"end":50,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_99":{"__typename":"Paragraph","id":"7e76286c3322_99","name":"7cc3","type":"P","href":null,"layout":null,"metadata":null,"text":"Open the file to edit it:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_100":{"__typename":"Paragraph","id":"7e76286c3322_100","name":"c94a","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo vim \u003Cthe file path you found\u003E","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_101":{"__typename":"Paragraph","id":"7e76286c3322_101","name":"c06f","type":"P","href":null,"layout":null,"metadata":null,"text":"Replace the line listen_addresses = 'localhost' with listen_addresses = '*'.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":17,"end":47,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":53,"end":75,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_102":{"__typename":"Paragraph","id":"7e76286c3322_102","name":"a99b","type":"P","href":null,"layout":null,"metadata":null,"text":"Find your pg_hba.conf file using sudo find \u002F -name \"pg_hba.conf\" (mine is \u002Fetc\u002Fpostgresql\u002F12\u002Fmain\u002Fpg_hba.conf) and open to edit:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":10,"end":21,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":33,"end":64,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":74,"end":109,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_103":{"__typename":"Paragraph","id":"7e76286c3322_103","name":"644b","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo vim \u003Cthe file path you found\u003E","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_104":{"__typename":"Paragraph","id":"7e76286c3322_104","name":"d774","type":"P","href":null,"layout":null,"metadata":null,"text":"Add the following lines at the very end of the file:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_105":{"__typename":"Paragraph","id":"7e76286c3322_105","name":"2a22","type":"PRE","href":null,"layout":null,"metadata":null,"text":"host    all             all             0.0.0.0\u002F0               md5\nhost    all             all             ::\u002F0                    md5","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_106":{"__typename":"Paragraph","id":"7e76286c3322_106","name":"8fba","type":"P","href":null,"layout":null,"metadata":null,"text":"Now, restart postgres: sudo systemctl restart postgresql","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":23,"end":56,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_107":{"__typename":"Paragraph","id":"7e76286c3322_107","name":"74b0","type":"P","href":null,"layout":null,"metadata":null,"text":"Verify that you can connect with Postico or whatever app you use. Here’s an example of what it should look like. This will connect you to the postgres database which doesn’t have anything in it which is fine. Later, we’ll run MIX_ENV=prod mix ecto.create to actually create the DB for our app, and we’ll tweak these settings in Postico so we can connect to that specific database.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":142,"end":150,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":226,"end":254,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*X9zic5p0-EzZCw-tJmPPtA.png":{"__typename":"ImageMetadata","id":"1*X9zic5p0-EzZCw-tJmPPtA.png","originalHeight":416,"originalWidth":766,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:7e76286c3322_108":{"__typename":"Paragraph","id":"7e76286c3322_108","name":"90de","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*X9zic5p0-EzZCw-tJmPPtA.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_109":{"__typename":"Paragraph","id":"7e76286c3322_109","name":"2c37","type":"H4","href":null,"layout":null,"metadata":null,"text":"10 — Connect to your remote Git repo where your project lives","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_110":{"__typename":"Paragraph","id":"7e76286c3322_110","name":"4dc2","type":"P","href":null,"layout":null,"metadata":null,"text":"Finally, we’re ready to put some code on this server! I’ve created an empty Phoenix repository on GitHub that you’re welcome to fork and follow along. There are only a few changes I made to the default stuff that mix phx.new generated, and you can see all of those changes in this tiny pull request. It’s just a couple of tweaks to config, and ignoring secrets files. We’ll be creating some secrets files locally on our development machine, adding prod secrets to them, and then copying them up to our server in subsequent steps. Once you’ve forked the project, on your server run the following:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":213,"end":224,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":70,"end":94,"href":"https:\u002F\u002Fgithub.com\u002Fdamonvjanis\u002Foptimized_nginx\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":286,"end":298,"href":"https:\u002F\u002Fgithub.com\u002Fdamonvjanis\u002Foptimized_nginx\u002Fpull\u002F1\u002Ffiles","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_111":{"__typename":"Paragraph","id":"7e76286c3322_111","name":"ce1f","type":"PRE","href":null,"layout":null,"metadata":null,"text":"git clone https:\u002F\u002Fgithub.com\u002F\u003CYOUR_GITHUB_USERNAME\u002Foptimized_nginx","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_112":{"__typename":"Paragraph","id":"7e76286c3322_112","name":"e88f","type":"BQ","href":null,"layout":null,"metadata":null,"text":"Note: your fork will be a public repo so there aren’t any authentication considerations, but if you’re using a private repo you’ll want to generate an SSH key on the server and add it to your user account in GitHub, BitBucket, or wherever the repo lives. Then, make sure to run the git clone command using ssh, otherwise you’ll be prompted for account credentials every time you deploy and it’ll interrupt the smooth deployment process we’ll be setting up later.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":282,"end":291,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":139,"end":158,"href":"https:\u002F\u002Fwww.digitalocean.com\u002Fdocs\u002Fdroplets\u002Fhow-to\u002Fadd-ssh-keys\u002Fcreate-with-openssh\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":282,"end":291,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_113":{"__typename":"Paragraph","id":"7e76286c3322_113","name":"e8b9","type":"P","href":null,"layout":null,"metadata":null,"text":"Now, on your dev machine, open up the project (if you’re using the example repo fork just clone it locally) and create config\u002Fprod.secret.exs. We need some database credentials and some endpoint instructions to start the server with a dynamic port. You can use the following, but be sure to generate a secret_key_base and paste in your prod database password that you generated in step 8.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":119,"end":141,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":302,"end":317,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"MediaResource:78c581d1acf9d36e528f0bfd6d11b5f1":{"__typename":"MediaResource","id":"78c581d1acf9d36e528f0bfd6d11b5f1","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"prod.secret.exs"},"Paragraph:7e76286c3322_114":{"__typename":"Paragraph","id":"7e76286c3322_114","name":"33fb","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:78c581d1acf9d36e528f0bfd6d11b5f1"}},"mixtapeMetadata":null},"Paragraph:7e76286c3322_115":{"__typename":"Paragraph","id":"7e76286c3322_115","name":"f310","type":"H4","href":null,"layout":null,"metadata":null,"text":"11 — Get your app secrets onto the server","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_116":{"__typename":"Paragraph","id":"7e76286c3322_116","name":"6593","type":"P","href":null,"layout":null,"metadata":null,"text":"The next step is to move the prod.secret.exs file that you just created up to the server, using scp (which stands for “secure copy”). It works just like the ssh my_app command that we use to connect to the server, but you specify a local path and a remote path and it will transfer files up to the server (or down from the server). Close the SSH session to the server by typing exit, and enter the following in your local shell:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":29,"end":44,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":96,"end":99,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":157,"end":167,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":378,"end":382,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":314,"end":318,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_117":{"__typename":"Paragraph","id":"7e76286c3322_117","name":"14a2","type":"PRE","href":null,"layout":null,"metadata":null,"text":"scp config\u002Fprod.secret.exs my_app:~\u002Foptimized_nginx\u002Fconfig\u002F","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_118":{"__typename":"Paragraph","id":"7e76286c3322_118","name":"0fc9","type":"P","href":null,"layout":null,"metadata":null,"text":"Now connect to the server again with ssh my_app, and cd into the optimized_nginx directory. Let’s make sure that our config between the app and database is successful by running the following:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":37,"end":47,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":65,"end":80,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_119":{"__typename":"Paragraph","id":"7e76286c3322_119","name":"a7bd","type":"PRE","href":null,"layout":null,"metadata":null,"text":"MIX_ENV=prod mix deps.get","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_120":{"__typename":"Paragraph","id":"7e76286c3322_120","name":"759c","type":"PRE","href":null,"layout":null,"metadata":null,"text":"MIX_ENV=prod mix ecto.create","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_121":{"__typename":"Paragraph","id":"7e76286c3322_121","name":"c5b7","type":"P","href":null,"layout":null,"metadata":null,"text":"It may take a few minutes to compile this first time, the VM is not very powerful. Once it’s done though, sweet! You’ve got a database. Make sure to update your Postico config with the database name, my_app in this case and make sure you can connect.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":200,"end":206,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_122":{"__typename":"Paragraph","id":"7e76286c3322_122","name":"b2f2","type":"H4","href":null,"layout":null,"metadata":null,"text":"12 — Install Nginx + Certbot for SSL","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_123":{"__typename":"Paragraph","id":"7e76286c3322_123","name":"29b0","type":"P","href":null,"layout":null,"metadata":null,"text":"You absolutely need to secure your website, using SSL. And, the LetsEncrypt project makes it free and painless to set up with the Certbot package.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_124":{"__typename":"Paragraph","id":"7e76286c3322_124","name":"d5af","type":"P","href":null,"layout":null,"metadata":null,"text":"It’s possible to get a LetsEncrypt cert using only Elixir, eliminating the need to set up a web server to reverse proxy requests to the built-in Cowboy web server that Phoenix uses. I really love this concept of Elixir-only, but using that approach I couldn’t find a way to achieve zero downtime deployments on a single-server setup so we’ll fudge here and go the reverse proxy route.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":23,"end":57,"href":"https:\u002F\u002Fwww.theerlangelist.com\u002Farticle\u002Foperating_via_development","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_125":{"__typename":"Paragraph","id":"7e76286c3322_125","name":"20cf","type":"BQ","href":null,"layout":null,"metadata":null,"text":"Our zero downtime deployment strategy is to spin up our app with the new version of the code, while the old version of the code is still running but on a separate port (4000 or 4001). Then, we reload the reverse proxy so that it starts directing requests to the port where the new code is running.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":169,"end":173,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":177,"end":181,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":169,"end":173,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":177,"end":181,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_126":{"__typename":"Paragraph","id":"7e76286c3322_126","name":"a727","type":"P","href":null,"layout":null,"metadata":null,"text":"So instead of the pure Elixir approach, we’re going to use the extremely-fast web server Nginx to listen on port 80 and 443 and handle SSL concerns. Nginx will reverse-proxy requests to Cowboy on port 4000 and 4001 where our app will be listening. As a bonus, the Certbot package for LetsEncrypt makes it super easy to set up an SSL cert when you’re using Nginx. On your server, run the following:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":201,"end":205,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":210,"end":214,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_127":{"__typename":"Paragraph","id":"7e76286c3322_127","name":"1ee2","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo apt install nginx","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_128":{"__typename":"Paragraph","id":"7e76286c3322_128","name":"011d","type":"P","href":null,"layout":null,"metadata":null,"text":"This command installs Nginx and starts the server. If you visit http:\u002F\u002F\u003Cyour_domain\u003E.com, you should now see the default Nginx page. Nice! Now let’s open the Nginx site configuration:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":64,"end":88,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_129":{"__typename":"Paragraph","id":"7e76286c3322_129","name":"fd35","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo vim \u002Fetc\u002Fnginx\u002Fsites-available\u002Fdefault","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_130":{"__typename":"Paragraph","id":"7e76286c3322_130","name":"a592","type":"P","href":null,"layout":null,"metadata":null,"text":"Find the line server_name: _; and replace it with server_name \u003Cyour_domain\u003E.com www.\u003Cyour_domain\u003E.com;. Save and quit. This change allows Certbot to identify the correct domain when it attempts to create a certificate.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":14,"end":29,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":50,"end":102,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_131":{"__typename":"Paragraph","id":"7e76286c3322_131","name":"7988","type":"P","href":null,"layout":null,"metadata":null,"text":"Next, let’s install Certbot (and the nginx extension for it):","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_132":{"__typename":"Paragraph","id":"7e76286c3322_132","name":"098e","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo apt install certbot python3-certbot-nginx","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_133":{"__typename":"Paragraph","id":"7e76286c3322_133","name":"1c4e","type":"P","href":null,"layout":null,"metadata":null,"text":"And now let’s run it to create our SSL certificate:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_134":{"__typename":"Paragraph","id":"7e76286c3322_134","name":"13ea","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo certbot --nginx -d \u003Cyour_domain\u003E.com -d www.\u003Cyour_domain\u003E.com","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":24,"end":66,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_135":{"__typename":"Paragraph","id":"7e76286c3322_135","name":"4894","type":"P","href":null,"layout":null,"metadata":null,"text":"You’ll be prompted to enter your email address, agree to some terms, and share your email address (you don’t have to). If everything is successful, it’ll ask you to enter 1or 2 to choose whether to redirect to HTTPS. Unless you have a reason not to, choose 2 👍. Next, let’s test to make sure the auto-renew works:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":171,"end":172,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":175,"end":176,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_136":{"__typename":"Paragraph","id":"7e76286c3322_136","name":"bdc7","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo certbot renew --dry-run","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_137":{"__typename":"Paragraph","id":"7e76286c3322_137","name":"8856","type":"BQ","href":null,"layout":null,"metadata":null,"text":"If it works, it means that your certificate will renew automatically in the background every 90 days without any intervention, staying free and up-to-date forever without thought. Beautiful!","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_138":{"__typename":"Paragraph","id":"7e76286c3322_138","name":"9ff0","type":"H4","href":null,"layout":null,"metadata":null,"text":"13 — Configure Nginx to reverse proxy requests to your app","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_139":{"__typename":"Paragraph","id":"7e76286c3322_139","name":"3944","type":"P","href":null,"layout":null,"metadata":null,"text":"As exciting as it is to see the Nginx default static page, what we really want is to see the *Phoenix* default static page 😉. Let’s instruct Nginx to forward requests to port 4000, get Phoenix running, and make sure it all works. Open the Nginx site config file again:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":67,"end":73,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_140":{"__typename":"Paragraph","id":"7e76286c3322_140","name":"a9dd","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo vim \u002Fetc\u002Fnginx\u002Fsites-available\u002Fdefault","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_141":{"__typename":"Paragraph","id":"7e76286c3322_141","name":"70d6","type":"P","href":null,"layout":null,"metadata":null,"text":"Above the first server { ... block, put the following:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":16,"end":28,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_142":{"__typename":"Paragraph","id":"7e76286c3322_142","name":"9fe9","type":"PRE","href":null,"layout":null,"metadata":null,"text":"upstream phoenix {\n    server 127.0.0.1:4000;\n}","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":0,"end":47,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_143":{"__typename":"Paragraph","id":"7e76286c3322_143","name":"a449","type":"P","href":null,"layout":null,"metadata":null,"text":"And then within the first server { ... block, find the location \u002F { ... block and replace it completely with the following:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":26,"end":38,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":55,"end":71,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_144":{"__typename":"Paragraph","id":"7e76286c3322_144","name":"6cd3","type":"PRE","href":null,"layout":null,"metadata":null,"text":"if ($host = www.\u003Cyour_domain\u003E.com) {\n  return 301 $scheme:\u002F\u002F\u003Cyour_domain\u003E.com$request_uri;\n}","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_145":{"__typename":"Paragraph","id":"7e76286c3322_145","name":"16d7","type":"PRE","href":null,"layout":null,"metadata":null,"text":"location \u002F.well-known {\n  alias \u002Fvar\u002Fwww\u002F.well-known;\n}","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_146":{"__typename":"Paragraph","id":"7e76286c3322_146","name":"5212","type":"PRE","href":null,"layout":null,"metadata":null,"text":"location \u002F {\n  allow all;","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":0,"end":25,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_147":{"__typename":"Paragraph","id":"7e76286c3322_147","name":"4cf9","type":"PRE","href":null,"layout":null,"metadata":null,"text":"  # Proxy Headers\n  proxy_http_version 1.1;\n  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n  proxy_set_header Host $http_host;\n  proxy_set_header X-Cluster-Client-Ip $remote_addr;","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":0,"end":195,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_148":{"__typename":"Paragraph","id":"7e76286c3322_148","name":"7be2","type":"PRE","href":null,"layout":null,"metadata":null,"text":"  # WebSockets\n  proxy_set_header Upgrade $http_upgrade;\n  proxy_set_header Connection \"upgrade\";","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":0,"end":97,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_149":{"__typename":"Paragraph","id":"7e76286c3322_149","name":"d93c","type":"PRE","href":null,"layout":null,"metadata":null,"text":"# Proxies to whatever you set in the 'upstream phoenix {...' block\n  proxy_pass http:\u002F\u002Fphoenix;\n}","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":0,"end":97,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_150":{"__typename":"Paragraph","id":"7e76286c3322_150","name":"df8e","type":"P","href":null,"layout":null,"metadata":null,"text":"Most of this reverse proxy config comes from step 9 of this fantastic Digital Ocean guide, and if you want more details you can explore them there. Let’s reload Nginx to update the config:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":45,"end":89,"href":"https:\u002F\u002Fwww.digitalocean.com\u002Fcommunity\u002Ftutorials\u002Fhow-to-automate-elixir-phoenix-deployment-with-distillery-and-edeliver-on-ubuntu-16-04#step-9-—-setting-up-a-reverse-proxy-on-the-production-server","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_151":{"__typename":"Paragraph","id":"7e76286c3322_151","name":"b091","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo systemctl reload nginx","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_152":{"__typename":"Paragraph","id":"7e76286c3322_152","name":"6fd0","type":"P","href":null,"layout":null,"metadata":null,"text":"Now, let’s get Phoenix up and running (don’t worry, more robust deployment is coming) and make sure that requests are proxying to it successfully:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_153":{"__typename":"Paragraph","id":"7e76286c3322_153","name":"c6e4","type":"PRE","href":null,"layout":null,"metadata":null,"text":"# get the assets ready\ncd assets && npm install && cd ..\u002F\nnpm run deploy --prefix .\u002Fassets\nMIX_ENV=prod mix phx.digest","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_154":{"__typename":"Paragraph","id":"7e76286c3322_154","name":"fe6f","type":"PRE","href":null,"layout":null,"metadata":null,"text":"# run the app on port 4000\nPORT=4000 MIX_ENV=prod mix phx.server","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_155":{"__typename":"Paragraph","id":"7e76286c3322_155","name":"9af9","type":"P","href":null,"layout":null,"metadata":null,"text":"Now visit \u003Cyour_domain\u003E.com and you should see the Phoenix page. Cool!","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":10,"end":27,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_156":{"__typename":"Paragraph","id":"7e76286c3322_156","name":"ffd7","type":"H4","href":null,"layout":null,"metadata":null,"text":"14 — Build a deployment shell script","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_157":{"__typename":"Paragraph","id":"7e76286c3322_157","name":"30c1","type":"P","href":null,"layout":null,"metadata":null,"text":"Now that you have an app running on your custom domain, with a database and SSL, you could decide that it’s good enough and find a quick hack to keep it running, like running Phoenix in the background or manually deploying releases.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_158":{"__typename":"Paragraph","id":"7e76286c3322_158","name":"7d68","type":"BQ","href":null,"layout":null,"metadata":null,"text":"I’m begging you though to stay with me and not try to take a shortcut, because you’ll end up wasting a lot of time fiddling with things. You’ll have to manually start and stop the system, think about database migrations, and you won’t get zero downtime deployments. It’s brittle and if the server ever restarts for required maintenance, your app won’t come back up by itself.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_159":{"__typename":"Paragraph","id":"7e76286c3322_159","name":"94b6","type":"P","href":null,"layout":null,"metadata":null,"text":"We’re going to use a simple but powerful tool as the main way to automate and streamline most of the deployment process: a lowly bash script. On the server, cd to your home directory (cd ~\u002F or even just cd), and then create a deploy.sh file:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":157,"end":159,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":184,"end":189,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":203,"end":205,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":226,"end":235,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_160":{"__typename":"Paragraph","id":"7e76286c3322_160","name":"f7bc","type":"PRE","href":null,"layout":null,"metadata":null,"text":"vim deploy.sh","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_161":{"__typename":"Paragraph","id":"7e76286c3322_161","name":"bd80","type":"BQ","href":null,"layout":null,"metadata":null,"text":"We’ll build this file section by section to explain what’s going on, and then I’ll drop the full thing at the end so it’s easy to copy, paste, and modify.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_162":{"__typename":"Paragraph","id":"7e76286c3322_162","name":"6151","type":"P","href":null,"layout":null,"metadata":null,"text":"First, we’ll add a shebang and the set -e directive. The shebang tells the system to use the bash language to process the script, and the set -e directive tells the script to immediately exit if any of the commands in it fail (return a non-zero status).","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":35,"end":41,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":93,"end":97,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":138,"end":144,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":19,"end":26,"href":"https:\u002F\u002Flinuxize.com\u002Fpost\u002Fbash-shebang\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":30,"end":51,"href":"https:\u002F\u002Fwww.gnu.org\u002Fsoftware\u002Fbash\u002Fmanual\u002Fhtml_node\u002FThe-Set-Builtin.html","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_163":{"__typename":"Paragraph","id":"7e76286c3322_163","name":"5428","type":"PRE","href":null,"layout":null,"metadata":null,"text":"#!\u002Fbin\u002Fbash\nset -e","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":15,"end":16,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_164":{"__typename":"Paragraph","id":"7e76286c3322_164","name":"613b","type":"P","href":null,"layout":null,"metadata":null,"text":"Next, we’re going to add commands to navigate to the app project, get the latest version, and make sure dependencies are up to date:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_165":{"__typename":"Paragraph","id":"7e76286c3322_165","name":"f8d1","type":"PRE","href":null,"layout":null,"metadata":null,"text":"# Update to latest version of code\ncd \u002Fhome\u002F\u003CYOUR_USERNAME\u003E\u002Foptimized_nginx\ngit fetch\ngit reset --hard origin\u002Fmaster\nMIX_ENV=prod mix deps.get","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_166":{"__typename":"Paragraph","id":"7e76286c3322_166","name":"af84","type":"P","href":null,"layout":null,"metadata":null,"text":"Next, we’ll add a couple of optional CI steps, like running tests or enforcing code style with Credo. Even though it makes the build process a little slower, we’ll include the tests at least to make sure we can’t deploy code that’s breaking tests:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":95,"end":100,"href":"https:\u002F\u002Fgithub.com\u002Frrrene\u002Fcredo","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_167":{"__typename":"Paragraph","id":"7e76286c3322_167","name":"b6ac","type":"PRE","href":null,"layout":null,"metadata":null,"text":"# Optional CI steps\nmix test\n# mix credo --strict (credo is not in example repo, commented out)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_168":{"__typename":"Paragraph","id":"7e76286c3322_168","name":"41e2","type":"P","href":null,"layout":null,"metadata":null,"text":"We’ve got a little problem though: with our secure database password in place on the server, mix test will fail because it won’t be able to connect. To fix this, let’s update the mix test line to say CI=true mix test, and then save and quit so we can get out of the server and back to our local environment. We need to make a couple of code changes locally to support running tests on the server with the prod DB password. First, we’ll create a file config\u002Ftest.secret.exs with the following content:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":93,"end":101,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":179,"end":187,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":200,"end":216,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":450,"end":472,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"MediaResource:1c28264f1b790d32e3afc8b7aab1cc93":{"__typename":"MediaResource","id":"1c28264f1b790d32e3afc8b7aab1cc93","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"test.secret.exs"},"Paragraph:7e76286c3322_169":{"__typename":"Paragraph","id":"7e76286c3322_169","name":"b344","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:1c28264f1b790d32e3afc8b7aab1cc93"}},"mixtapeMetadata":null},"Paragraph:7e76286c3322_170":{"__typename":"Paragraph","id":"7e76286c3322_170","name":"2c7a","type":"P","href":null,"layout":null,"metadata":null,"text":"Use scp to copy the test.secret.exs file up to the server like we did with the prod secrets file in step 11.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":4,"end":7,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":20,"end":35,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_171":{"__typename":"Paragraph","id":"7e76286c3322_171","name":"57ee","type":"BQ","href":null,"layout":null,"metadata":null,"text":"If you’re using the example repo, this next code change has already been made so you can skip the next three paragraphs and get back to editing deploy.sh.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":144,"end":153,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":144,"end":153,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_172":{"__typename":"Paragraph","id":"7e76286c3322_172","name":"6ae1","type":"P","href":null,"layout":null,"metadata":null,"text":"Otherwise, in your config\u002Ftest.exs file, put the following at the very bottom, so that it pulls in the secret file only if the CI environment variable exists (like it does when the deploy script runs CI=true mix test):","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":19,"end":34,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":127,"end":129,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":200,"end":216,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_173":{"__typename":"Paragraph","id":"7e76286c3322_173","name":"933a","type":"PRE","href":null,"layout":null,"metadata":null,"text":"if System.get_env(\"CI\") do\n  import_config \"test.secret.exs\"\nend","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_174":{"__typename":"Paragraph","id":"7e76286c3322_174","name":"c776","type":"P","href":null,"layout":null,"metadata":null,"text":"Commit and push the change locally, and then get back on the server with ssh my_app. You’ll need to run git pull in the optimized_nginx directory to get the change.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":73,"end":83,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":104,"end":112,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":120,"end":135,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_175":{"__typename":"Paragraph","id":"7e76286c3322_175","name":"af3f","type":"BQ","href":null,"layout":null,"metadata":null,"text":"Alright, run vim deploy.sh in the home directory on the server and we’ll keep going.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":13,"end":26,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":13,"end":26,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_176":{"__typename":"Paragraph","id":"7e76286c3322_176","name":"7f2d","type":"P","href":null,"layout":null,"metadata":null,"text":"Next, we’ll add instructions to compile the app and static assets, setting the MIX_ENV variable to prod so we don’t have to specify it on the rest of the mix commands in the script:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":79,"end":86,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":99,"end":103,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_177":{"__typename":"Paragraph","id":"7e76286c3322_177","name":"1bd0","type":"PRE","href":null,"layout":null,"metadata":null,"text":"# Build phase\nexport MIX_ENV=prod\nmix compile\nnpm install --prefix .\u002Fassets\nnpm run deploy --prefix .\u002Fassets\nmix phx.digest","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_178":{"__typename":"Paragraph","id":"7e76286c3322_178","name":"af1b","type":"P","href":null,"layout":null,"metadata":null,"text":"Next, the script will create the release, and place it in a folder named with the current time in unix. That way, each release will be timestamped which makes it easier for us to have an automated rollback script:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_179":{"__typename":"Paragraph","id":"7e76286c3322_179","name":"59e3","type":"PRE","href":null,"layout":null,"metadata":null,"text":"# Create release\nnow_in_unix_seconds=$(date +'%s')\nmix release --path ..\u002Freleases\u002F${now_in_unix_seconds}","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_180":{"__typename":"Paragraph","id":"7e76286c3322_180","name":"991a","type":"P","href":null,"layout":null,"metadata":null,"text":"Next, the script will replace some text in a file (that we’ll create in a minute) called env_vars that will store the latest release name. In the next section, we’ll be writing a systemd service responsible for starting and stopping our app, and it will look in this env_vars file to know which release to boot up. Let’s add instructions to replace the LATEST_RELEASE value in env_vars using sed:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":89,"end":97,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":179,"end":186,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":267,"end":275,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":353,"end":367,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":377,"end":385,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":392,"end":395,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_181":{"__typename":"Paragraph","id":"7e76286c3322_181","name":"e5b3","type":"PRE","href":null,"layout":null,"metadata":null,"text":"# Update env var file with latest release name\nsed -i 's\u002FLATEST_RELEASE=.*\u002FLATEST_RELEASE='$now_in_unix_seconds'\u002Fg' ..\u002Fenv_vars","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_182":{"__typename":"Paragraph","id":"7e76286c3322_182","name":"d32a","type":"P","href":null,"layout":null,"metadata":null,"text":"Next, we’ll grab the current value of the PORT , which is the port number the currently running app is using, and then deduce which port is available (either 4000 or 4001):","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":42,"end":46,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":158,"end":162,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":166,"end":170,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_183":{"__typename":"Paragraph","id":"7e76286c3322_183","name":"55b9","type":"PRE","href":null,"layout":null,"metadata":null,"text":"# Find the port in use, and the available port\nif $(curl --output \u002Fdev\u002Fnull --silent --head --fail localhost:4000)\nthen\n  port_in_use=4000\n  open_port=4001\nelse\n  port_in_use=4001\n  open_port=4000\nfi","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_184":{"__typename":"Paragraph","id":"7e76286c3322_184","name":"a69e","type":"P","href":null,"layout":null,"metadata":null,"text":"Next, we need to update the env.sh file located deep in the folder structure of the release. When the release boots, any calls to System.get_env and similar won’t find the variables set in the shell like they normally would if you started the app with mix phx.server, so we can’t just say PORT=4001 bin\u002Fmy_app start because it won’t pick up the PORT variable. But, if we shovel the environment variables into the \u003Crelease_name\u003E\u002Freleases\u002F\u003Cversion_number\u003E\u002Fenv.sh file, the release will pick them up when it starts:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":28,"end":34,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":130,"end":144,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":252,"end":266,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":289,"end":315,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":345,"end":349,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":413,"end":460,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":371,"end":377,"href":"https:\u002F\u002Flinuxize.com\u002Fpost\u002Fbash-append-to-file\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_185":{"__typename":"Paragraph","id":"7e76286c3322_185","name":"6f4a","type":"PRE","href":null,"layout":null,"metadata":null,"text":"# Put env vars with new port and set non-conflicting node name\necho \"export PORT=${open_port}\" \u003E\u003E ..\u002Freleases\u002F${now_in_unix_seconds}\u002Freleases\u002F0.1.0\u002Fenv.sh","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_186":{"__typename":"Paragraph","id":"7e76286c3322_186","name":"fc1a","type":"PRE","href":null,"layout":null,"metadata":null,"text":"echo \"export RELEASE_NAME=${open_port}\" \u003E\u003E ..\u002Freleases\u002F${now_in_unix_seconds}\u002Freleases\u002F0.1.0\u002Fenv.sh","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_187":{"__typename":"Paragraph","id":"7e76286c3322_187","name":"2f18","type":"BQ","href":null,"layout":null,"metadata":null,"text":"In the section above, we’re also setting a RELEASE_NAME environment variable which sets the name of the node when Erlang boots up. We can’t have two nodes with the same name running simultaneously, so we just set the node name to the same value as the open port to avoid conflicts.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":43,"end":55,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":43,"end":55,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_188":{"__typename":"Paragraph","id":"7e76286c3322_188","name":"5d9b","type":"P","href":null,"layout":null,"metadata":null,"text":"Next, the script will use systemctl to start the app on the open port, and then it will use curl to ping the port every second till it’s alive before the script will continue:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":26,"end":35,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":92,"end":96,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_189":{"__typename":"Paragraph","id":"7e76286c3322_189","name":"7564","type":"PRE","href":null,"layout":null,"metadata":null,"text":"# Start app on open port\nsudo systemctl start my_app@${open_port}","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_190":{"__typename":"Paragraph","id":"7e76286c3322_190","name":"0ee8","type":"PRE","href":null,"layout":null,"metadata":null,"text":"# Pause script till app is fully up\nuntil $(curl --output \u002Fdev\u002Fnull --silent --head --fail localhost:$open_port); do\n  printf 'Waiting for app to boot...\\n'\n  sleep 1\ndone","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_191":{"__typename":"Paragraph","id":"7e76286c3322_191","name":"7aad","type":"P","href":null,"layout":null,"metadata":null,"text":"Next, the script will run the database migrations:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_192":{"__typename":"Paragraph","id":"7e76286c3322_192","name":"cb4d","type":"PRE","href":null,"layout":null,"metadata":null,"text":"# Run migrations\nmix ecto.migrate","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_193":{"__typename":"Paragraph","id":"7e76286c3322_193","name":"03dc","type":"P","href":null,"layout":null,"metadata":null,"text":"Finally, the script will clean up a bit by telling Nginx to start routing requests to the new port, and then it will stop the old version of the app. It all happens gracefully — requests in flight will finish before the old version is fully down:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_194":{"__typename":"Paragraph","id":"7e76286c3322_194","name":"9ebc","type":"PRE","href":null,"layout":null,"metadata":null,"text":"# Update Nginx config to direct requests to app on open port\nsudo sed -i 's\u002Fserver 127\\.0\\.0\\.1\\:.*\u002Fserver 127.0.0.1:'$open_port\\;'\u002Fg' \u002Fetc\u002Fnginx\u002Fsites-available\u002Fdefault","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_195":{"__typename":"Paragraph","id":"7e76286c3322_195","name":"6e47","type":"PRE","href":null,"layout":null,"metadata":null,"text":"# Reload Nginx so it gracefully starts routing to new app version\nsudo systemctl reload nginx","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_196":{"__typename":"Paragraph","id":"7e76286c3322_196","name":"36dc","type":"PRE","href":null,"layout":null,"metadata":null,"text":"# Stop previous version of app\nsudo systemctl stop my_app@${port_in_use}","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_197":{"__typename":"Paragraph","id":"7e76286c3322_197","name":"d525","type":"P","href":null,"layout":null,"metadata":null,"text":"Whew, we made it!! Lots of command line tools in there like sed, controlling systemd services with systemctl, and some bash concepts like variables and conditionals. Read more about sed here, systemd here, and bash scripts here if you want to get a little more context on these tools. Here’s the file all together:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":60,"end":63,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":77,"end":84,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":99,"end":108,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":119,"end":123,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":182,"end":185,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":192,"end":199,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":210,"end":214,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":186,"end":190,"href":"https:\u002F\u002Flinuxize.com\u002Fpost\u002Fhow-to-use-sed-to-find-and-replace-string-in-files\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":200,"end":204,"href":"https:\u002F\u002Fwww.digitalocean.com\u002Fcommunity\u002Ftutorials\u002Fhow-to-use-systemctl-to-manage-systemd-services-and-units","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":223,"end":227,"href":"https:\u002F\u002Fryanstutorials.net\u002Fbash-scripting-tutorial\u002Fbash-variables.php","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"MediaResource:345fa7ea134dbf2a3f754bcd71cb0ee8":{"__typename":"MediaResource","id":"345fa7ea134dbf2a3f754bcd71cb0ee8","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"deploy.sh"},"Paragraph:7e76286c3322_198":{"__typename":"Paragraph","id":"7e76286c3322_198","name":"6813","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:345fa7ea134dbf2a3f754bcd71cb0ee8"}},"mixtapeMetadata":null},"Paragraph:7e76286c3322_199":{"__typename":"Paragraph","id":"7e76286c3322_199","name":"c322","type":"BQ","href":null,"layout":null,"metadata":null,"text":"This file might feel long or intimidating, but there’s a lot of power and flexibility in the approach. By using a single script to deploy, you’ll know exactly where to go if you want to add any custom steps or adjust things. Want to add more robust logic so that if the app doesn’t start up within some number of seconds, it kills the deploy? Just tweak the pause section. Want to add some static analysis? Great, add it to the CI section. Want to run it without migrations or without tests\u002FCI? Just make a copy with a different name, take out the sections that don’t need to run and voilá! You’re working with the raw tools, so you won’t need to learn a framework or hack around constraints when you do need something custom.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_200":{"__typename":"Paragraph","id":"7e76286c3322_200","name":"d14f","type":"P","href":null,"layout":null,"metadata":null,"text":"Save and quit, then make the file executable:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_201":{"__typename":"Paragraph","id":"7e76286c3322_201","name":"9d3b","type":"PRE","href":null,"layout":null,"metadata":null,"text":"chmod u+x deploy.sh","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_202":{"__typename":"Paragraph","id":"7e76286c3322_202","name":"5336","type":"P","href":null,"layout":null,"metadata":null,"text":"And one last thing, let’s create the env_vars file that our script references, and populate it with initial data. Run vim env_vars and put the following in it:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":37,"end":45,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":118,"end":130,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_203":{"__typename":"Paragraph","id":"7e76286c3322_203","name":"e69a","type":"PRE","href":null,"layout":null,"metadata":null,"text":"LATEST_RELEASE=","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_204":{"__typename":"Paragraph","id":"7e76286c3322_204","name":"d6a3","type":"H4","href":null,"layout":null,"metadata":null,"text":"15 — Create systemd services","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_205":{"__typename":"Paragraph","id":"7e76286c3322_205","name":"4c6e","type":"P","href":null,"layout":null,"metadata":null,"text":"Before we can actually run our deploy script, we need to create a systemd service that starts up the app (basically, to run \u003Crelease_name\u003E\u002Fbin\u002Fmy_app start). deploy.sh expects this service to be available — it calls it when it says sudo systemctl start my_app@${open_port}.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":66,"end":73,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":124,"end":155,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":158,"end":167,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":232,"end":272,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_206":{"__typename":"Paragraph","id":"7e76286c3322_206","name":"d7fb","type":"P","href":null,"layout":null,"metadata":null,"text":"The reason we need a systemd service to run that command, instead of just having the deploy script run it, is so that if the app ever exits unexpectedly (for example, if your app runs out of memory or atoms and the BEAM crashes), systemd will notice and boot the app again in a clean state.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":21,"end":28,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":230,"end":237,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_207":{"__typename":"Paragraph","id":"7e76286c3322_207","name":"3e7b","type":"BQ","href":null,"layout":null,"metadata":null,"text":"Within your Elixir app, you have a supervision tree to manage and monitor when processes crash and reset them — you can think about systemd like it’s the supervisor for your supervision tree.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":132,"end":139,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":132,"end":139,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_208":{"__typename":"Paragraph","id":"7e76286c3322_208","name":"2d41","type":"P","href":null,"layout":null,"metadata":null,"text":"There’s another bonus — by having a systemd service start the app, the logs that the app produces will be piped out to journald automatically, which makes it easy to attach to the stream when you want to and it’s also a very standard log interface so it’s easy to connect to third-party logging services.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":36,"end":43,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":119,"end":127,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_209":{"__typename":"Paragraph","id":"7e76286c3322_209","name":"c113","type":"P","href":null,"layout":null,"metadata":null,"text":"Let’s go ahead and create a new systemd service:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":32,"end":39,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_210":{"__typename":"Paragraph","id":"7e76286c3322_210","name":"8a93","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo vim \u002Fetc\u002Fsystemd\u002Fsystem\u002Fmy_app@.service","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_211":{"__typename":"Paragraph","id":"7e76286c3322_211","name":"8458","type":"P","href":null,"layout":null,"metadata":null,"text":"Add the following contents:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"MediaResource:a62c61dddda7ef1dc94a1d1d3a3808de":{"__typename":"MediaResource","id":"a62c61dddda7ef1dc94a1d1d3a3808de","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"my_app.service"},"Paragraph:7e76286c3322_212":{"__typename":"Paragraph","id":"7e76286c3322_212","name":"5b43","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:a62c61dddda7ef1dc94a1d1d3a3808de"}},"mixtapeMetadata":null},"Paragraph:7e76286c3322_213":{"__typename":"Paragraph","id":"7e76286c3322_213","name":"3b48","type":"P","href":null,"layout":null,"metadata":null,"text":"The most significant lines for us are 12 and 14. First, we pull in the env_vars file we created in the last step, which tells the service what folder the latest release is in, and then on line 14 we actually start the release.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":71,"end":79,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":208,"end":213,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_214":{"__typename":"Paragraph","id":"7e76286c3322_214","name":"efe7","type":"BQ","href":null,"layout":null,"metadata":null,"text":"The name of this service file is important: adding the @ makes it a “template”, which means that we can run it multiple times with different values after the @ which in our case will be 4000 and 4001. This enables us to have two instances of the app running at the same time so that Nginx can gracefully switch routing requests from one to the other, before the old one is shut down. You can read more about running multiple instances of a systemd service here.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":55,"end":56,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":158,"end":159,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":186,"end":190,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":195,"end":199,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":440,"end":447,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":456,"end":460,"href":"https:\u002F\u002Fwww.stevenrombauts.be\u002F2019\u002F01\u002Frun-multiple-instances-of-the-same-systemd-unit\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":55,"end":56,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":158,"end":159,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":186,"end":190,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":195,"end":199,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":440,"end":447,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_215":{"__typename":"Paragraph","id":"7e76286c3322_215","name":"b176","type":"P","href":null,"layout":null,"metadata":null,"text":"We’re going to create one more systemd service, which will be responsible for running our deploy script automatically (which will bring the app back online) if the server ever restarts unexpectedly. The file for this one is smaller because it doesn’t have to deal with monitoring and restarting the app if it goes down. Run sudo vim \u002Fetc\u002Fsystemd\u002Fsystem\u002Fmy_app_start_on_boot.service and add the following contents:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":31,"end":38,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":324,"end":381,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"MediaResource:993d46f84e0c394e04151acb88de6833":{"__typename":"MediaResource","id":"993d46f84e0c394e04151acb88de6833","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"my_app_start_on_boot.service"},"Paragraph:7e76286c3322_216":{"__typename":"Paragraph","id":"7e76286c3322_216","name":"1f2f","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:993d46f84e0c394e04151acb88de6833"}},"mixtapeMetadata":null},"Paragraph:7e76286c3322_217":{"__typename":"Paragraph","id":"7e76286c3322_217","name":"00ee","type":"P","href":null,"layout":null,"metadata":null,"text":"Now, let’s enable the service so that it knows to run when the server boots:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":11,"end":29,"href":"https:\u002F\u002Fwww.linode.com\u002Fdocs\u002Fguides\u002Fstart-service-at-boot\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_218":{"__typename":"Paragraph","id":"7e76286c3322_218","name":"c708","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo systemctl enable my_app_start_on_boot","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_219":{"__typename":"Paragraph","id":"7e76286c3322_219","name":"9e4e","type":"P","href":null,"layout":null,"metadata":null,"text":"One last thing before we’re done here: we need a way for our app to know at runtime which port to use, but at the point in our deploy script where the available port is discovered, the release has already been built and all of the config has been set at compile time. Release runtime configuration to the rescue! If you’re using the example app, you’ll already have this file so feel free to skip to the next step. Otherwise, locally in your project, create the file config\u002Freleases.exs:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":467,"end":486,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":268,"end":297,"href":"https:\u002F\u002Fhexdocs.pm\u002Fmix\u002FMix.Tasks.Release.html#module-runtime-configuration","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":76,"end":83,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":254,"end":261,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"MediaResource:81e527e7dc70cca847b1ef1e076bb837":{"__typename":"MediaResource","id":"81e527e7dc70cca847b1ef1e076bb837","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"runtime.exs"},"Paragraph:7e76286c3322_220":{"__typename":"Paragraph","id":"7e76286c3322_220","name":"6227","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:81e527e7dc70cca847b1ef1e076bb837"}},"mixtapeMetadata":null},"Paragraph:7e76286c3322_221":{"__typename":"Paragraph","id":"7e76286c3322_221","name":"2f90","type":"P","href":null,"layout":null,"metadata":null,"text":"Commit and push that change so it’s available on your server as well.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_222":{"__typename":"Paragraph","id":"7e76286c3322_222","name":"53c3","type":"H4","href":null,"layout":null,"metadata":null,"text":"16 — Deploy the app","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_223":{"__typename":"Paragraph","id":"7e76286c3322_223","name":"99cb","type":"P","href":null,"layout":null,"metadata":null,"text":"We’ve come a long way and done a lot of work! We’re finally ready for that sweet sweet payout: running the deploy script and watching the app come to life.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_224":{"__typename":"Paragraph","id":"7e76286c3322_224","name":"1b03","type":"BQ","href":null,"layout":null,"metadata":null,"text":"One of the cool things about ssh is that you can use it to run a command in your local terminal, but have it execute on the server. Let’s do that. In your local terminal, run the following command:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":29,"end":32,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":29,"end":32,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_225":{"__typename":"Paragraph","id":"7e76286c3322_225","name":"f95a","type":"PRE","href":null,"layout":null,"metadata":null,"text":"ssh my_app .\u002Fdeploy.sh","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_226":{"__typename":"Paragraph","id":"7e76286c3322_226","name":"9f3d","type":"P","href":null,"layout":null,"metadata":null,"text":"You’ll see some output as the script works through the various build, CI, release, and booting steps. If all goes well, you should be able to visit https:\u002F\u002F\u003Cyour_domain\u003E.com and see the app running!","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":148,"end":173,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_227":{"__typename":"Paragraph","id":"7e76286c3322_227","name":"b977","type":"PQ","href":null,"layout":null,"metadata":null,"text":"To really see the magic, commit and push a change locally and then run the command again, and you’ll see it gracefully swap over to the new version without any downtime 🎉🎉🎉.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_228":{"__typename":"Paragraph","id":"7e76286c3322_228","name":"caa8","type":"P","href":null,"layout":null,"metadata":null,"text":"If you used the example app, you can now visit https:\u002F\u002F\u003Cyour_domain\u003E.com\u002Fdashboard\u002Fhome to see the live dashboard. You might notice some janky stuff with the websockets, which you can resolve by updating your config\u002Fprod.exs file where it references \"example.com\" to \"\u003Cyour_domain\u003E.com\". Push that update, deploy again, and it should stabilize.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":47,"end":87,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":209,"end":224,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":250,"end":263,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":267,"end":286,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_229":{"__typename":"Paragraph","id":"7e76286c3322_229","name":"393a","type":"H4","href":null,"layout":null,"metadata":null,"text":"17 — Attach to journald to watch logs, and configure to trim","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_230":{"__typename":"Paragraph","id":"7e76286c3322_230","name":"dc6e","type":"P","href":null,"layout":null,"metadata":null,"text":"Logs aren’t the most exciting part of building an app, but you’ll be grateful for them when you’re troubleshooting tough bugs. Because the deploy script uses a systemd service to actually run the command to start the release, standard output is routed to journald which stores the logs.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":160,"end":167,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":255,"end":263,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_231":{"__typename":"Paragraph","id":"7e76286c3322_231","name":"3ced","type":"BQ","href":null,"layout":null,"metadata":null,"text":"Just like we used systemctl to start and stop systemd services, we use a utility called journalctl to query and manipulate journald logs. If you want a deep dive, you can read up here, here, or here. I’ll just show you a couple of useful commands, to help you get a window into your logs as the app is running in real time, but journalctl supports a wide variety of querying for more advanced uses.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":18,"end":27,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":46,"end":53,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":88,"end":98,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":123,"end":131,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":328,"end":338,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":179,"end":183,"href":"https:\u002F\u002Fwww.loggly.com\u002Fultimate-guide\u002Fusing-journalctl\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":185,"end":189,"href":"https:\u002F\u002Fsematext.com\u002Fblog\u002Fjournald-logging-tutorial\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":194,"end":198,"href":"https:\u002F\u002Fwww.digitalocean.com\u002Fcommunity\u002Ftutorials\u002Fhow-to-use-journalctl-to-view-and-manipulate-systemd-logs","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":18,"end":27,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":46,"end":53,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":88,"end":98,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":123,"end":131,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":328,"end":338,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_232":{"__typename":"Paragraph","id":"7e76286c3322_232","name":"8ee8","type":"P","href":null,"layout":null,"metadata":null,"text":"To attach to the journal and “follow” it (basically, as logs come in you see them update in real time), run the following command locally:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_233":{"__typename":"Paragraph","id":"7e76286c3322_233","name":"8bf5","type":"PRE","href":null,"layout":null,"metadata":null,"text":"ssh my_app journalctl -f","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_234":{"__typename":"Paragraph","id":"7e76286c3322_234","name":"1e16","type":"P","href":null,"layout":null,"metadata":null,"text":"Now, if you visit \u003Cyour_domain\u003E.com a few times, you’ll see some logs show up in your terminal. Sweet!","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":18,"end":35,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_235":{"__typename":"Paragraph","id":"7e76286c3322_235","name":"2036","type":"P","href":null,"layout":null,"metadata":null,"text":"You can also print out the most recent n logs, with the following command:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":39,"end":40,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_236":{"__typename":"Paragraph","id":"7e76286c3322_236","name":"4617","type":"PRE","href":null,"layout":null,"metadata":null,"text":"ssh my_app journalctl -n 500","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_237":{"__typename":"Paragraph","id":"7e76286c3322_237","name":"7baf","type":"P","href":null,"layout":null,"metadata":null,"text":"You may see some logs in there that don’t have to do with your app — to limit it to just your app you can run this:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_238":{"__typename":"Paragraph","id":"7e76286c3322_238","name":"9e24","type":"PRE","href":null,"layout":null,"metadata":null,"text":"ssh my_app journalctl -n 50 -u my_app@4001","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_239":{"__typename":"Paragraph","id":"7e76286c3322_239","name":"0106","type":"P","href":null,"layout":null,"metadata":null,"text":"Adding the -u my_app@\u003C4000 or 4001\u003E limits it to just that “unit”. Your app will always be running on either 4000 or 4001, so if the most recent log for the port you picked looks like the following, try the other one to see the output for the running app.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":11,"end":35,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_240":{"__typename":"Paragraph","id":"7e76286c3322_240","name":"ad82","type":"PRE","href":null,"layout":null,"metadata":null,"text":"Nov 03 21:43:33 instance-1 systemd[1]: Stopped My App.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_241":{"__typename":"Paragraph","id":"7e76286c3322_241","name":"1ed2","type":"P","href":null,"layout":null,"metadata":null,"text":"One more thing before we stop talking about logs: let’s update the journald config so that it starts trimming logs at 4GB so that logs don’t eventually consume all available disk space. ssh my_app to get on the server, then run sudo vim \u002Fetc\u002Fsystemd\u002Fjournald.conf to edit the config file. Find the line that has SystemMaxUse, uncomment it, and add 4G to the end like this:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":67,"end":75,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":186,"end":196,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":228,"end":263,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":312,"end":324,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":348,"end":350,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_242":{"__typename":"Paragraph","id":"7e76286c3322_242","name":"628e","type":"PRE","href":null,"layout":null,"metadata":null,"text":"SystemMaxUse=4G","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_243":{"__typename":"Paragraph","id":"7e76286c3322_243","name":"e337","type":"P","href":null,"layout":null,"metadata":null,"text":"Save and quit, and then restart journald like this:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":32,"end":40,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_244":{"__typename":"Paragraph","id":"7e76286c3322_244","name":"0829","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo systemctl restart systemd-journald.service","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_245":{"__typename":"Paragraph","id":"7e76286c3322_245","name":"248e","type":"H3","href":null,"layout":null,"metadata":null,"text":"You made it! 🙌","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_246":{"__typename":"Paragraph","id":"7e76286c3322_246","name":"d9f0","type":"P","href":null,"layout":null,"metadata":null,"text":"Congratulations, you’re now armed with a fully loaded Phoenix app running on free hardware without the compromises. You can deploy new versions of your code with a single command, achieve zero-downtime deploys without hot code reloading, and tap into the database and logs from your development machine with ease.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_247":{"__typename":"Paragraph","id":"7e76286c3322_247","name":"b650","type":"P","href":null,"layout":null,"metadata":null,"text":"I’ve included a few bonus sections if any of them spark your interest. Thanks for reading, and please reach out to me at damonvjanis@gmail.com if you have any questions or comments.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_248":{"__typename":"Paragraph","id":"7e76286c3322_248","name":"125d","type":"BQ","href":null,"layout":null,"metadata":null,"text":"If any Elixir wizards want to see if you can figure out how to achieve zero-downtime deploys on a single server without hot code reloading, but also without depending on Nginx, I would love to highlight it! It would also be cool if someone could figure out a more pure Elixir way of starting the release without systemd but keeping the ability to restart on crash, and easy access to attaching to the logs of the app.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":312,"end":319,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":312,"end":319,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_249":{"__typename":"Paragraph","id":"7e76286c3322_249","name":"5e51","type":"P","href":null,"layout":null,"metadata":null,"text":"UPDATE: Ruslan Kenzhebekov emailed me and pointed me to a comment thread he’d had with Sasa Juric (the author of the Site Encrypt library) where Sasa mentioned that he used iptables switching to achieve zero-downtime deployments without nginx or a reverse proxy. That prompted me to learn (a lot!) and update the original article as a result.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":173,"end":181,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":313,"end":329,"href":"https:\u002F\u002Fdamonvjanis.medium.com\u002Foptimizing-for-free-hosting-elixir-deployments-6bfc119a1f44","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_250":{"__typename":"Paragraph","id":"7e76286c3322_250","name":"752e","type":"H4","href":null,"layout":null,"metadata":null,"text":"Bonus 1: secure your data against the possibility of eventual hardware failure by creating another Google account with a free instance and set up automated backups using cron","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_251":{"__typename":"Paragraph","id":"7e76286c3322_251","name":"ce9b","type":"P","href":null,"layout":null,"metadata":null,"text":"I’m not going to go into exhaustive detail here, and this is not a sophisticated approach, but it can be a starting point.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_252":{"__typename":"Paragraph","id":"7e76286c3322_252","name":"d629","type":"P","href":null,"layout":null,"metadata":null,"text":"Follow steps 1–5 of the guide again but with a new Google account, and instead of my_app name your alias something like backups. Now that you’ve got your server up and running and you can connect to it, install Postgres:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":82,"end":88,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":120,"end":127,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_253":{"__typename":"Paragraph","id":"7e76286c3322_253","name":"86ca","type":"PRE","href":null,"layout":null,"metadata":null,"text":"sudo apt install postgresql postgresql-contrib","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_254":{"__typename":"Paragraph","id":"7e76286c3322_254","name":"484c","type":"P","href":null,"layout":null,"metadata":null,"text":"Now hit cd to make sure you’re in the home directory, and enter vim .pgpass to create a password file for Postgres. Put the following contents in it, using the values from the server you set up for my_app:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":8,"end":10,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":64,"end":75,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":198,"end":204,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_255":{"__typename":"Paragraph","id":"7e76286c3322_255","name":"48c9","type":"PRE","href":null,"layout":null,"metadata":null,"text":"#hostname:port:database:username:password\n\u003Cserver IP address\u003E:5432:my_app:postgres:\u003Cpostgres password\u003E","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_256":{"__typename":"Paragraph","id":"7e76286c3322_256","name":"5ca9","type":"P","href":null,"layout":null,"metadata":null,"text":"Now hit chmod 600 .pgpass to give the file correct permissions.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":8,"end":25,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_257":{"__typename":"Paragraph","id":"7e76286c3322_257","name":"e095","type":"P","href":null,"layout":null,"metadata":null,"text":"Open the cron configuration file by running crontab -e, then at the bottom of the file add the following:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":9,"end":13,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":44,"end":54,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"MediaResource:568f1dda73775638fabfc673f46a5504":{"__typename":"MediaResource","id":"568f1dda73775638fabfc673f46a5504","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"chrontab"},"Paragraph:7e76286c3322_258":{"__typename":"Paragraph","id":"7e76286c3322_258","name":"4613","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:568f1dda73775638fabfc673f46a5504"}},"mixtapeMetadata":null},"Paragraph:7e76286c3322_259":{"__typename":"Paragraph","id":"7e76286c3322_259","name":"5228","type":"P","href":null,"layout":null,"metadata":null,"text":"To make sure that it actually works, instead of waiting an hour for it to run, try running the pg_dump task like in the file:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":95,"end":102,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_260":{"__typename":"Paragraph","id":"7e76286c3322_260","name":"a59b","type":"PRE","href":null,"layout":null,"metadata":null,"text":"pg_dump -U postgres -h \u003Cserver IP address\u003E -p 5432 my_app \u003E ~\u002Fmy_app\u002Fmy_app_hourly.bak","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_261":{"__typename":"Paragraph","id":"7e76286c3322_261","name":"27e7","type":"P","href":null,"layout":null,"metadata":null,"text":"If all goes well, you should see a new folder my_app\u002F with a backup inside. Sweet!","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":46,"end":53,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_262":{"__typename":"Paragraph","id":"7e76286c3322_262","name":"bf08","type":"P","href":null,"layout":null,"metadata":null,"text":"You can learn more about cron here.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":25,"end":29,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":30,"end":34,"href":"https:\u002F\u002Fphoenixnap.com\u002Fkb\u002Fset-up-cron-job-linux","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_263":{"__typename":"Paragraph","id":"7e76286c3322_263","name":"11a1","type":"H4","href":null,"layout":null,"metadata":null,"text":"Bonus 2: Rollback script","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_264":{"__typename":"Paragraph","id":"7e76286c3322_264","name":"4bd5","type":"P","href":null,"layout":null,"metadata":null,"text":"Here’s a rollback script I wrote, you can put it in your home directory next to deploy.sh and run it the same way: ssh my_app .\u002Frollback.sh.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":80,"end":89,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":115,"end":139,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"MediaResource:61f96bf1e7c359f322e9e384a014855f":{"__typename":"MediaResource","id":"61f96bf1e7c359f322e9e384a014855f","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"rollback.sh"},"Paragraph:7e76286c3322_265":{"__typename":"Paragraph","id":"7e76286c3322_265","name":"745a","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:61f96bf1e7c359f322e9e384a014855f"}},"mixtapeMetadata":null},"Paragraph:7e76286c3322_266":{"__typename":"Paragraph","id":"7e76286c3322_266","name":"bda5","type":"P","href":null,"layout":null,"metadata":null,"text":"Save and quit, then make the file executable:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_267":{"__typename":"Paragraph","id":"7e76286c3322_267","name":"6211","type":"PRE","href":null,"layout":null,"metadata":null,"text":"chmod u+x rollback.sh","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_268":{"__typename":"Paragraph","id":"7e76286c3322_268","name":"a1b1","type":"P","href":null,"layout":null,"metadata":null,"text":"Note: you’ll need to handle rolling back database migrations manually, by running MIX_ENV=prod mix ecto.rollback within the app directory on the server, if you need to roll back a migration.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":82,"end":112,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_269":{"__typename":"Paragraph","id":"7e76286c3322_269","name":"c592","type":"P","href":null,"layout":null,"metadata":null,"text":"The script will boot up the previous release, and if you need to go back more than one just keep running the script. It’s fast — it only takes a few seconds before the last release is the one running in prod!","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:7e76286c3322_270":{"__typename":"Paragraph","id":"7e76286c3322_270","name":"28e3","type":"P","href":null,"layout":null,"metadata":null,"text":"And that’s a wrap! Thanks for reading 🙏","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Tag:elixir":{"__typename":"Tag","id":"elixir"},"Tag:phoenix-framework":{"__typename":"Tag","id":"phoenix-framework"},"Tag:software-development":{"__typename":"Tag","id":"software-development"},"Tag:deployment":{"__typename":"Tag","id":"deployment"},"Collection:f54fab11bfc":{"__typename":"Collection","id":"f54fab11bfc","slug":"experience-stack","name":"Experience Stack","domain":"experiencestack.co"},"User:cb6863bffb56":{"__typename":"User","id":"cb6863bffb56","imageId":"1*BAI7qJvcydJxpKUzm2WTGw.jpeg","mediumMemberAt":1661310509000,"name":"Ryan Ferdon","username":"bantercode","customDomainState":{"__typename":"CustomDomainState","live":{"__typename":"CustomDomain","domain":"bantercode.medium.com"}},"hasSubdomain":true,"bio":"I’m a programmer, mentor, entrepreneur, and blogger. I’m excited about new technology, automation, entrepreneurship, cryptocurrency, investing, and data."},"ImageMetadata:0*39SE_nUYEBGo9DOa.png":{"__typename":"ImageMetadata","id":"0*39SE_nUYEBGo9DOa.png","alt":"Dad and son looking at clouds. Son asks dad “what are clouds made of?” Dad replies “Linux servers, mostly”.","focusPercentX":null,"focusPercentY":null},"Post:18122decbf":{"__typename":"Post","id":"18122decbf","visibility":"PUBLIC","previewContent":{"__typename":"PreviewContent","isFullContent":false,"subtitle":"Cloud computing is changing the way we do business"},"collection":{"__ref":"Collection:f54fab11bfc"},"title":"7 Reasons to Move Your Business to the Cloud","mediumUrl":"https:\u002F\u002Fexperiencestack.co\u002F7-reasons-to-move-your-business-to-the-cloud-18122decbf","creator":{"__ref":"User:cb6863bffb56"},"previewImage":{"__ref":"ImageMetadata:0*39SE_nUYEBGo9DOa.png"},"clapCount":55,"isSeries":false,"sequence":null,"uniqueSlug":"7-reasons-to-move-your-business-to-the-cloud-18122decbf"},"Collection:822e12839c6a":{"__typename":"Collection","id":"822e12839c6a","slug":"klaviyo-developers","name":"Klaviyo Developer Blog","domain":null},"User:afac5cc7f483":{"__typename":"User","id":"afac5cc7f483","imageId":"0*tncYu6n-2jTltUlK.jpg","mediumMemberAt":0,"name":"Kamil Klasicki","username":"kamil.klasicki","customDomainState":null,"hasSubdomain":false,"bio":""},"ImageMetadata:1*-jgE81FuXXh3L3tZsrNS8Q.png":{"__typename":"ImageMetadata","id":"1*-jgE81FuXXh3L3tZsrNS8Q.png","alt":null,"focusPercentX":null,"focusPercentY":null},"Post:508a90ff7d8a":{"__typename":"Post","id":"508a90ff7d8a","visibility":"PUBLIC","previewContent":{"__typename":"PreviewContent","isFullContent":false,"subtitle":"Solution Recipes are tutorials to achieve specific objectives in Klaviyo. They can also help you master Klaviyo, learn new third-party…"},"collection":{"__ref":"Collection:822e12839c6a"},"title":"Solution Recipe 3: A Serverless Approach to Getting Webhook Data into Klaviyo using AWS","mediumUrl":"https:\u002F\u002Fmedium.com\u002Fklaviyo-developers\u002Fsolution-recipe-3-a-serverless-approach-to-getting-webhook-data-into-klaviyo-using-aws-508a90ff7d8a","creator":{"__ref":"User:afac5cc7f483"},"previewImage":{"__ref":"ImageMetadata:1*-jgE81FuXXh3L3tZsrNS8Q.png"},"clapCount":114,"isSeries":false,"sequence":null,"uniqueSlug":"solution-recipe-3-a-serverless-approach-to-getting-webhook-data-into-klaviyo-using-aws-508a90ff7d8a"},"Collection:f8eb0402941f":{"__typename":"Collection","id":"f8eb0402941f","slug":"viewstools","name":"Views Tools","domain":null},"User:a118fda48492":{"__typename":"User","id":"a118fda48492","imageId":"1*T7VFpif5SdMso-WGG11S4g.jpeg","mediumMemberAt":1556371101000,"name":"Tom Parandyk","username":"tomparandyk","customDomainState":{"__typename":"CustomDomainState","live":{"__typename":"CustomDomain","domain":"tomparandyk.medium.com"}},"hasSubdomain":true,"bio":"Product designer, eager engineer, strategist, wild innovator, proud dad, creative leader, aspiring musician."},"ImageMetadata:1*j32ZADzQ3h72S_jAvvJung.jpeg":{"__typename":"ImageMetadata","id":"1*j32ZADzQ3h72S_jAvvJung.jpeg","alt":null,"focusPercentX":null,"focusPercentY":null},"Post:8a799d98a82d":{"__typename":"Post","id":"8a799d98a82d","visibility":"LOCKED","previewContent":{"__typename":"PreviewContent","isFullContent":false,"subtitle":"I have a feeling that a BIG change is coming to the product engineering, design, and management. It has very little to do with a raw-code…"},"collection":{"__ref":"Collection:f8eb0402941f"},"title":"Is a radically new way to make software around the corner?","mediumUrl":"https:\u002F\u002Fmedium.com\u002Fviewstools\u002Fis-a-radically-new-way-to-make-software-around-the-corner-8a799d98a82d","creator":{"__ref":"User:a118fda48492"},"previewImage":{"__ref":"ImageMetadata:1*j32ZADzQ3h72S_jAvvJung.jpeg"},"clapCount":78,"isSeries":false,"sequence":null,"uniqueSlug":"is-a-radically-new-way-to-make-software-around-the-corner-8a799d98a82d"},"Collection:4949a34ae285":{"__typename":"Collection","id":"4949a34ae285","slug":"ft-product-technology","name":"FT Product & Technology","domain":null},"User:51de4672a589":{"__typename":"User","id":"51de4672a589","imageId":"2*DWcxcz0XZy05QKz5lLoayQ.png","mediumMemberAt":0,"name":"Jono Milnes","username":"jonomilnes","customDomainState":{"__typename":"CustomDomainState","live":{"__typename":"CustomDomain","domain":"jonomilnes.medium.com"}},"hasSubdomain":true,"bio":"Product Designer @ Financial Times"},"ImageMetadata:1*rg5U3fv19oeNhZVqzCwicQ.png":{"__typename":"ImageMetadata","id":"1*rg5U3fv19oeNhZVqzCwicQ.png","alt":"Discovery Guild emoji image","focusPercentX":null,"focusPercentY":null},"Post:cf297ba58afd":{"__typename":"Post","id":"cf297ba58afd","visibility":"PUBLIC","previewContent":{"__typename":"PreviewContent","isFullContent":false,"subtitle":"It helps us share more often, elevates our level of conversation and pulls us closer together"},"collection":{"__ref":"Collection:4949a34ae285"},"title":"The Discovery Guild is driving culture change at the FT","mediumUrl":"https:\u002F\u002Fmedium.com\u002Fft-product-technology\u002Fthe-discovery-guild-is-driving-culture-change-at-the-ft-cf297ba58afd","creator":{"__ref":"User:51de4672a589"},"previewImage":{"__ref":"ImageMetadata:1*rg5U3fv19oeNhZVqzCwicQ.png"},"clapCount":53,"isSeries":false,"sequence":null,"uniqueSlug":"the-discovery-guild-is-driving-culture-change-at-the-ft-cf297ba58afd"},"User:e5aeb410da8f":{"__typename":"User","id":"e5aeb410da8f","imageId":"0*Mo0kdiBVUSf25wqD","mediumMemberAt":0,"name":"Mike Jones","username":"mikejone","customDomainState":{"__typename":"CustomDomainState","live":{"__typename":"CustomDomain","domain":"mikejone.medium.com"}},"hasSubdomain":true,"bio":"Software Engineer & Blockchain Developers - Discuss about new trends in software programming."},"ImageMetadata:1*AgYYGLkPaL0Gbanm9AjGCA.jpeg":{"__typename":"ImageMetadata","id":"1*AgYYGLkPaL0Gbanm9AjGCA.jpeg","alt":null,"focusPercentX":null,"focusPercentY":null},"Post:e59a3492c7ed":{"__typename":"Post","id":"e59a3492c7ed","visibility":"PUBLIC","previewContent":{"__typename":"PreviewContent","isFullContent":false,"subtitle":"There are a number of factors that are responsible for a high-performing software development team. If you need a high performing software…"},"collection":null,"title":"How to build a high performing software development team","mediumUrl":"https:\u002F\u002Fmikejone.medium.com\u002Fhow-to-build-a-high-performing-software-development-team-e59a3492c7ed","creator":{"__ref":"User:e5aeb410da8f"},"previewImage":{"__ref":"ImageMetadata:1*AgYYGLkPaL0Gbanm9AjGCA.jpeg"},"clapCount":11,"isSeries":false,"sequence":null,"uniqueSlug":"how-to-build-a-high-performing-software-development-team-e59a3492c7ed"},"Collection:f5af2b715248":{"__typename":"Collection","id":"f5af2b715248","slug":"swlh","name":"The Startup","domain":null},"User:b1f51a6243b0":{"__typename":"User","id":"b1f51a6243b0","imageId":"1*Coug7hedanA98DiK_lt_qg.jpeg","mediumMemberAt":0,"name":"Ben Longstaff","username":"ben_longstaff","customDomainState":null,"hasSubdomain":false,"bio":"Playing at the intersection of privacy and personalisation. Fascinated by the state of trust in a world with leaky data."},"ImageMetadata:1*YG5AZUr_DSR0w4gGh7fa8A.jpeg":{"__typename":"ImageMetadata","id":"1*YG5AZUr_DSR0w4gGh7fa8A.jpeg","alt":null,"focusPercentX":null,"focusPercentY":null},"Post:bc0b08312fa":{"__typename":"Post","id":"bc0b08312fa","visibility":"LOCKED","previewContent":{"__typename":"PreviewContent","isFullContent":false,"subtitle":"Why do smart developers ship bad code?"},"collection":{"__ref":"Collection:f5af2b715248"},"title":"Stop building car boats — tech debt 101","mediumUrl":"https:\u002F\u002Fmedium.com\u002Fswlh\u002Fstop-building-car-boats-tech-debt-101-bc0b08312fa","creator":{"__ref":"User:b1f51a6243b0"},"previewImage":{"__ref":"ImageMetadata:1*YG5AZUr_DSR0w4gGh7fa8A.jpeg"},"clapCount":1969,"isSeries":false,"sequence":null,"uniqueSlug":"stop-building-car-boats-tech-debt-101-bc0b08312fa"},"Collection:61061eb0c96b":{"__typename":"Collection","id":"61061eb0c96b","slug":"codeburst","name":"codeburst","domain":"codeburst.io"},"User:577e2119c7f2":{"__typename":"User","id":"577e2119c7f2","imageId":"2*5A3oDiRJiYP4mODhVe2sYg.jpeg","mediumMemberAt":0,"name":"Ashis Chakraborty","username":"ashchk","customDomainState":{"__typename":"CustomDomainState","live":{"__typename":"CustomDomain","domain":"ashchk.medium.com"}},"hasSubdomain":true,"bio":"Associate Architect, Samsung Electronics | Writer in free time, Like to read about technology & psychology | LinkedIn https:\u002F\u002Ftinyurl.com\u002Fy57d68fq"},"ImageMetadata:0*YIuEDe-yXagGc-bo":{"__typename":"ImageMetadata","id":"0*YIuEDe-yXagGc-bo","alt":null,"focusPercentX":null,"focusPercentY":null},"Post:adc4f602d08f":{"__typename":"Post","id":"adc4f602d08f","visibility":"LOCKED","previewContent":{"__typename":"PreviewContent","isFullContent":false,"subtitle":"How popular sites handle such huge amount of requests"},"collection":{"__ref":"Collection:61061eb0c96b"},"title":"System Design Basics: Load balancer 101","mediumUrl":"https:\u002F\u002Fcodeburst.io\u002Fsystem-design-basics-load-balancer-101-adc4f602d08f","creator":{"__ref":"User:577e2119c7f2"},"previewImage":{"__ref":"ImageMetadata:0*YIuEDe-yXagGc-bo"},"clapCount":459,"isSeries":false,"sequence":null,"uniqueSlug":"system-design-basics-load-balancer-101-adc4f602d08f"},"Collection:d0b105d10f0a":{"__typename":"Collection","id":"d0b105d10f0a","slug":"better-programming","name":"Better Programming","domain":"betterprogramming.pub"},"User:e110a563d5fa":{"__typename":"User","id":"e110a563d5fa","imageId":"0*Llt9WyozUgPmWYPk.jpg","mediumMemberAt":1548230400000,"name":"Alfonso Valdes Carrales","username":"ponchovaldescarrales","customDomainState":null,"hasSubdomain":false,"bio":"Nearshore DevOps, Kubernetes, Terraform and AWS Architect"},"ImageMetadata:1*84RiLa8LNGJq2bGJBtFSvQ.jpeg":{"__typename":"ImageMetadata","id":"1*84RiLa8LNGJq2bGJBtFSvQ.jpeg","alt":null,"focusPercentX":null,"focusPercentY":null},"Post:af4eaec75b8b":{"__typename":"Post","id":"af4eaec75b8b","visibility":"LOCKED","previewContent":{"__typename":"PreviewContent","isFullContent":false,"subtitle":"Learn the step-by-step process of deploying a sample Nodejs containerized application"},"collection":{"__ref":"Collection:d0b105d10f0a"},"title":"How to Create a CI\u002FCD Pipeline With Jenkins, Containers, and Amazon ECS","mediumUrl":"https:\u002F\u002Fbetterprogramming.pub\u002Fhow-to-create-a-ci-cd-pipeline-with-jenkins-containers-and-amazon-ecs-af4eaec75b8b","creator":{"__ref":"User:e110a563d5fa"},"previewImage":{"__ref":"ImageMetadata:1*84RiLa8LNGJq2bGJBtFSvQ.jpeg"},"clapCount":105,"isSeries":false,"sequence":null,"uniqueSlug":"how-to-create-a-ci-cd-pipeline-with-jenkins-containers-and-amazon-ecs-af4eaec75b8b"}}</script><script>window.__MIDDLEWARE_STATE__={"session":{"xsrf":""},"cache":{"cacheStatus":"HIT","inDisabledExperiment":false}}</script><script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/manifest.dcfbd9df.js"></script><script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1025.034ad363.js"></script><script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/main.b07ce825.js"></script><script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/instrumentation.c71f0248.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/8732.9d4e0df2.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/2837.70a1acac.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/AppLayout.33302d27.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/reporting.bbdcaa9d.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/2953.6a4984da.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1752.a348f767.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/6490.4918949d.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/5472.5f6d4371.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/4330.73510d98.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/2981.c8b67800.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/3115.5cd3d0ad.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/5758.4d052c2f.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/4869.c26b42a4.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/9401.492bc814.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/2307.b2a54ca4.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/7070.83cd757a.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/9442.5291e270.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/4483.227e0535.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/210.1b33e4a9.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/864.dc58ca67.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/9841.1bb423da.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/3610.44f23015.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1018.3d424dd7.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/9304.78e04611.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/763.fc6eec61.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/8051.10132806.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/9241.b09496de.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/5887.70c709b9.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/5754.6687b8d5.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/PostPage.MainContent.64e8175b.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/1987.e87f9d80.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/8237.1eb3b71c.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/7994.7409a9e8.chunk.js"></script>
<script src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/PostPage.RightColumnContent.d084a3d8.chunk.js"></script><script>window.main();</script><script defer="" src="./(Archive) Phoenix Deployments on GCP with Nginx _ by Damon Janis _ Medium_files/v652eace1692a40cfa3763df669d7439c1639079717194" integrity="sha512-Gi7xpJR8tSkrpF7aordPZQlW2DLtzUlZcumS8dMQjwDHEnw9I7ZLyiOj/6tZStRBGtGgN6ceN6cMH8z7etPGlw==" data-cf-beacon="{&quot;rayId&quot;:&quot;75b0f9e6989835f5&quot;,&quot;token&quot;:&quot;0b5f665943484354a59c39c6833f7078&quot;,&quot;version&quot;:&quot;2022.8.1&quot;,&quot;si&quot;:100}" crossorigin="anonymous"></script>
</body></html>